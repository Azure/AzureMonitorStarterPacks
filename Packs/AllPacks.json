{
  "$schema": "https://schema.management.azure.com/schemas/2018-05-01/subscriptionDeploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "_generator": {
      "name": "bicep",
      "version": "0.32.4.45862",
      "templateHash": "15973545561669172518"
    }
  },
  "parameters": {
    "subscriptionId": {
      "type": "string"
    },
    "resourceGroupId": {
      "type": "string"
    },
    "location": {
      "type": "string",
      "metadata": {
        "description": "location for the deployment."
      }
    },
    "useExistingAG": {
      "type": "bool",
      "metadata": {
        "description": "If set to true, a new Action group will be created"
      }
    },
    "workspaceId": {
      "type": "string",
      "metadata": {
        "description": "Full resource ID of the log analytics workspace to be used for the deployment."
      }
    },
    "solutionTag": {
      "type": "string"
    },
    "solutionVersion": {
      "type": "string"
    },
    "dceId": {
      "type": "string",
      "metadata": {
        "description": "Full resource ID of the data collection endpoint to be used for the deployment."
      }
    },
    "userManagedIdentityResourceId": {
      "type": "string",
      "metadata": {
        "description": "Full resource ID of the user managed identity to be used for the deployment"
      }
    },
    "grafanaResourceId": {
      "type": "string",
      "defaultValue": ""
    },
    "customerTags": {
      "type": "object"
    },
    "existingActionGroupResourceId": {
      "type": "string"
    },
    "deployIaaSPacks": {
      "type": "bool"
    },
    "storageAccountName": {
      "type": "string"
    },
    "imageGalleryName": {
      "type": "string"
    },
    "instanceName": {
      "type": "string"
    },
    "deployGrafana": {
      "type": "bool"
    },
    "actionGroupName": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "Name of the Action Group to be used or created."
      }
    },
    "emailreceiver": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "Email receiver names to be used for the Action Group if being created."
      }
    },
    "emailreiceversemail": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "Email addresses to be used for the Action Group if being created."
      }
    }
  },
  "variables": {
    "solutionTagComponents": "MonitorStarterPacksComponents",
    "resourceGroupName": "[split(parameters('resourceGroupId'), '/')[4]]",
    "tempTags": {
      "[format('{0}', variables('solutionTagComponents'))]": "BackendComponent",
      "solutionVersion": "[parameters('solutionVersion')]",
      "instanceName": "[parameters('instanceName')]"
    },
    "Tags": "[if(equals(parameters('customerTags'), createObject()), variables('tempTags'), union(variables('tempTags'), parameters('customerTags').All))]"
  },
  "resources": [
    {
      "condition": "[not(parameters('useExistingAG'))]",
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2022-09-01",
      "name": "[format('deployAG-new-{0}-{1}', parameters('actionGroupName'), parameters('location'))]",
      "subscriptionId": "[parameters('subscriptionId')]",
      "resourceGroup": "[variables('resourceGroupName')]",
      "properties": {
        "expressionEvaluationOptions": {
          "scope": "inner"
        },
        "mode": "Incremental",
        "parameters": {
          "emailreceiver": {
            "value": "[parameters('emailreceiver')]"
          },
          "emailreiceversemail": {
            "value": "[parameters('emailreiceversemail')]"
          },
          "Tags": {
            "value": "[variables('Tags')]"
          },
          "location": {
            "value": "global"
          },
          "groupshortname": {
            "value": "[parameters('actionGroupName')]"
          }
        },
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0.0.0",
          "metadata": {
            "_generator": {
              "name": "bicep",
              "version": "0.32.4.45862",
              "templateHash": "12883385540442311034"
            }
          },
          "parameters": {
            "location": {
              "type": "string"
            },
            "groupshortname": {
              "type": "string"
            },
            "emailreceiver": {
              "type": "string"
            },
            "emailreiceversemail": {
              "type": "string"
            },
            "Tags": {
              "type": "object"
            }
          },
          "resources": [
            {
              "type": "Microsoft.Insights/actionGroups",
              "apiVersion": "2023-01-01",
              "name": "[parameters('groupshortname')]",
              "location": "[parameters('location')]",
              "tags": "[parameters('Tags')]",
              "properties": {
                "groupShortName": "[parameters('groupshortname')]",
                "enabled": true,
                "emailReceivers": [
                  {
                    "name": "[parameters('emailreceiver')]",
                    "emailAddress": "[parameters('emailreiceversemail')]",
                    "useCommonAlertSchema": false
                  }
                ]
              }
            }
          ],
          "outputs": {
            "agGroupId": {
              "type": "string",
              "value": "[resourceId('Microsoft.Insights/actionGroups', parameters('groupshortname'))]"
            }
          }
        }
      }
    },
    {
      "condition": "[parameters('deployIaaSPacks')]",
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2022-09-01",
      "name": "[format('deployIaaSPacks-{0}-{1}', parameters('instanceName'), parameters('location'))]",
      "location": "[deployment().location]",
      "properties": {
        "expressionEvaluationOptions": {
          "scope": "inner"
        },
        "mode": "Incremental",
        "parameters": {
          "location": {
            "value": "[parameters('location')]"
          },
          "workspaceId": {
            "value": "[parameters('workspaceId')]"
          },
          "solutionTag": {
            "value": "[parameters('solutionTag')]"
          },
          "solutionVersion": {
            "value": "[parameters('solutionVersion')]"
          },
          "dceId": {
            "value": "[parameters('dceId')]"
          },
          "userManagedIdentityResourceId": {
            "value": "[parameters('userManagedIdentityResourceId')]"
          },
          "actionGroupResourceId": "[if(parameters('useExistingAG'), createObject('value', parameters('existingActionGroupResourceId')), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', parameters('subscriptionId'), variables('resourceGroupName')), 'Microsoft.Resources/deployments', format('deployAG-new-{0}-{1}', parameters('actionGroupName'), parameters('location'))), '2022-09-01').outputs.agGroupId.value))]",
          "customerTags": {
            "value": "[parameters('customerTags')]"
          },
          "resourceGroupId": {
            "value": "[parameters('resourceGroupId')]"
          },
          "subscriptionId": {
            "value": "[parameters('subscriptionId')]"
          },
          "storageAccountName": {
            "value": "[parameters('storageAccountName')]"
          },
          "imageGalleryName": {
            "value": "[parameters('imageGalleryName')]"
          },
          "instanceName": {
            "value": "[parameters('instanceName')]"
          }
        },
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2018-05-01/subscriptionDeploymentTemplate.json#",
          "contentVersion": "1.0.0.0",
          "metadata": {
            "_generator": {
              "name": "bicep",
              "version": "0.32.4.45862",
              "templateHash": "10563635281544086158"
            }
          },
          "parameters": {
            "subscriptionId": {
              "type": "string"
            },
            "resourceGroupId": {
              "type": "string"
            },
            "location": {
              "type": "string",
              "metadata": {
                "description": "location for the deployment."
              }
            },
            "workspaceId": {
              "type": "string",
              "metadata": {
                "description": "Full resource ID of the log analytics workspace to be used for the deployment."
              }
            },
            "solutionTag": {
              "type": "string"
            },
            "solutionVersion": {
              "type": "string"
            },
            "dceId": {
              "type": "string",
              "metadata": {
                "description": "Full resource ID of the data collection endpoint to be used for the deployment."
              }
            },
            "userManagedIdentityResourceId": {
              "type": "string",
              "metadata": {
                "description": "Full resource ID of the user managed identity to be used for the deployment"
              }
            },
            "customerTags": {
              "type": "object"
            },
            "actionGroupResourceId": {
              "type": "string"
            },
            "storageAccountName": {
              "type": "string"
            },
            "imageGalleryName": {
              "type": "string"
            },
            "instanceName": {
              "type": "string"
            }
          },
          "variables": {
            "solutionTagComponents": "MonitorStarterPacksComponents",
            "tempTags": {
              "[format('{0}', parameters('solutionTag'))]": "BackendComponent",
              "solutionVersion": "[parameters('solutionVersion')]",
              "instanceName": "[parameters('instanceName')]",
              "MonitoringPackType": "IaaS"
            },
            "Tags": "[if(equals(parameters('customerTags'), createObject()), variables('tempTags'), union(variables('tempTags'), parameters('customerTags').All))]",
            "resourceGroupName": "[split(parameters('resourceGroupId'), '/')[4]]"
          },
          "resources": [
            {
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2022-09-01",
              "name": "[format('ADDSPack-{0}-{1}', parameters('instanceName'), parameters('location'))]",
              "location": "[deployment().location]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "dceId": {
                    "value": "[parameters('dceId')]"
                  },
                  "location": {
                    "value": "[parameters('location')]"
                  },
                  "solutionTag": {
                    "value": "[parameters('solutionTag')]"
                  },
                  "subscriptionId": {
                    "value": "[parameters('subscriptionId')]"
                  },
                  "userManagedIdentityResourceId": {
                    "value": "[parameters('userManagedIdentityResourceId')]"
                  },
                  "imageGalleryName": {
                    "value": "[parameters('imageGalleryName')]"
                  },
                  "resourceGroupId": {
                    "value": "[parameters('resourceGroupId')]"
                  },
                  "storageAccountname": {
                    "value": "[parameters('storageAccountName')]"
                  },
                  "tableName": {
                    "value": "addsmonitoring"
                  },
                  "tags": {
                    "value": "[variables('Tags')]"
                  },
                  "actionGroupResourceId": {
                    "value": "[parameters('actionGroupResourceId')]"
                  },
                  "customerTags": {
                    "value": "[parameters('customerTags')]"
                  },
                  "workspaceId": {
                    "value": "[parameters('workspaceId')]"
                  },
                  "instanceName": {
                    "value": "[parameters('instanceName')]"
                  },
                  "solutionVersion": {
                    "value": "[parameters('solutionVersion')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2018-05-01/subscriptionDeploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.32.4.45862",
                      "templateHash": "11040957902283796920"
                    }
                  },
                  "parameters": {
                    "packtag": {
                      "type": "string",
                      "defaultValue": "ADDS",
                      "metadata": {
                        "description": "Name of the DCR rule to be created"
                      }
                    },
                    "actionGroupResourceId": {
                      "type": "string"
                    },
                    "location": {
                      "type": "string",
                      "metadata": {
                        "description": "location for the deployment."
                      }
                    },
                    "workspaceId": {
                      "type": "string",
                      "metadata": {
                        "description": "Full resource ID of the log analytics workspace to be used for the deployment."
                      }
                    },
                    "solutionTag": {
                      "type": "string",
                      "defaultValue": "MonitorStarterPacks"
                    },
                    "solutionVersion": {
                      "type": "string"
                    },
                    "dceId": {
                      "type": "string",
                      "metadata": {
                        "description": "Full resource ID of the data collection endpoint to be used for the deployment."
                      }
                    },
                    "userManagedIdentityResourceId": {
                      "type": "string",
                      "metadata": {
                        "description": "Full resource ID of the user managed identity to be used for the deployment"
                      }
                    },
                    "subscriptionId": {
                      "type": "string"
                    },
                    "resourceGroupId": {
                      "type": "string"
                    },
                    "instanceName": {
                      "type": "string"
                    },
                    "customerTags": {
                      "type": "object"
                    },
                    "storageAccountname": {
                      "type": "string"
                    },
                    "imageGalleryName": {
                      "type": "string"
                    },
                    "tableName": {
                      "type": "string"
                    },
                    "tags": {
                      "type": "object"
                    }
                  },
                  "variables": {
                    "rulename": "[format('AMP-{0}-{1}', parameters('instanceName'), parameters('packtag'))]",
                    "tempTags": {
                      "[format('{0}', parameters('solutionTag'))]": "[parameters('packtag')]",
                      "MonitoringPackType": "IaaS",
                      "solutionVersion": "[parameters('solutionVersion')]"
                    },
                    "Tags": "[if(equals(parameters('customerTags'), createObject()), variables('tempTags'), union(variables('tempTags'), parameters('customerTags').All))]",
                    "workspaceFriendlyName": "[split(parameters('workspaceId'), '/')[8]]",
                    "resourceGroupName": "[split(parameters('resourceGroupId'), '/')[4]]",
                    "kind": "Windows",
                    "ruleshortname": "[format('{0}-collection', parameters('packtag'))]",
                    "appName": "[format('{0}-collection', parameters('packtag'))]",
                    "appDescription": "[format('{0} Collection - {1}', parameters('packtag'), parameters('instanceName'))]",
                    "OS": "Windows",
                    "xPathQueries": [
                      "Directory Service!*[System[(Eventlevel=1)]]",
                      "DNS Server!*[System[(Eventlevel=1)]]",
                      "Active Directory Web Services!*[System[(Eventlevel=1)]]",
                      "DFS Replication!*[System[(Eventlevel=1)]]"
                    ],
                    "performanceCounters": [
                      "\\Memory()\\Available Bytes",
                      "\\Memory()\\Committed Bytes",
                      "\\DirectoryServices(NTDS)\\DS Search sub-operations/sec",
                      "\\Security System-Wide Statistics()\\KDC AS Requests",
                      "\\Security System-Wide Statistics()\\KDC TGS Requests",
                      "\\Security System-Wide Statistics()\\Kerberos Authentications",
                      "\\DirectoryServices(NTDS)\\LDAP Client Sessions",
                      "\\DirectoryServices(NTDS)\\LDAP Searches/sec",
                      "\\DirectoryServices(NTDS)\\LDAP UDP operations/sec",
                      "\\DirectoryServices(NTDS)\\LDAP Writes/sec",
                      "\\Process(LSASS)\\Handle Count",
                      "\\Process(LSASS)\\Private Bytes",
                      "\\Process(LSASS)\\% Processor Time",
                      "\\Security System-Wide Statistics()\\NTLM Authentications",
                      "\\Memory()\\Pages/sec",
                      "\\Processor(_Total)\\% Processor Time",
                      "\\Server()\\Server Sessions",
                      "\\System()\\System Up Time",
                      "\\TCPv4()\\Connections Established",
                      "\\TCPv6()\\Connections Established",
                      "\\DirectoryServices(NTDS)\\DRA Inbound Bytes Compressed (Between Sites, Before Compression)/sec",
                      "\\DirectoryServices(NTDS)\\DRA Inbound Bytes Compressed (Between Sites, After Compression)/sec",
                      "\\DirectoryServices(NTDS)\\DRA Inbound Bytes Not Compressed (Within Site)/sec",
                      "\\DirectoryServices(NTDS)\\DRA Inbound Bytes Total/sec",
                      "\\DirectoryServices(NTDS)\\DRA Outbound Bytes Compressed (Between Sites, After Compression)/sec",
                      "\\DirectoryServices(NTDS)\\DRA Outbound Bytes Compressed (Between Sites, Before Compression)/sec",
                      "\\DirectoryServices(NTDS)\\DRA Outbound Bytes Not Compressed (Within Site)/sec",
                      "\\DirectoryServices(NTDS)\\DRA Outbound Bytes Total/sec",
                      "\\Process(dns)\\% Processor Time",
                      "\\DNS()\\Total Query Received/sec",
                      "\\Process(dns)\\Private Bytes",
                      "\\DirectoryServices(NTDS)\\ATQ Outstanding Queued Requests",
                      "\\DirectoryServices(NTDS)\\ATQ Request Latency",
                      "\\DirectoryServices(NTDS)\\ATQ Threads Other",
                      "\\DirectoryServices(NTDS)\\ATQ Threads LDAP",
                      "\\DirectoryServices(NTDS)\\ATQ Threads Total"
                    ]
                  },
                  "resources": [
                    {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2022-09-01",
                      "name": "[format('dcrPerformance-{0}-{1}-{2}', parameters('packtag'), parameters('instanceName'), parameters('location'))]",
                      "subscriptionId": "[parameters('subscriptionId')]",
                      "resourceGroup": "[variables('resourceGroupName')]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "location": {
                            "value": "[parameters('location')]"
                          },
                          "rulename": {
                            "value": "[variables('rulename')]"
                          },
                          "workspaceId": {
                            "value": "[parameters('workspaceId')]"
                          },
                          "wsfriendlyname": {
                            "value": "[variables('workspaceFriendlyName')]"
                          },
                          "kind": {
                            "value": "[variables('kind')]"
                          },
                          "xPathQueries": {
                            "value": "[variables('xPathQueries')]"
                          },
                          "counterSpecifiers": {
                            "value": "[variables('performanceCounters')]"
                          },
                          "Tags": {
                            "value": "[variables('Tags')]"
                          },
                          "dceId": {
                            "value": "[parameters('dceId')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.32.4.45862",
                              "templateHash": "15691414683408659274"
                            }
                          },
                          "parameters": {
                            "location": {
                              "type": "string"
                            },
                            "rulename": {
                              "type": "string"
                            },
                            "workspaceId": {
                              "type": "string"
                            },
                            "kind": {
                              "type": "string",
                              "defaultValue": "Windows"
                            },
                            "wsfriendlyname": {
                              "type": "string",
                              "defaultValue": "TBD"
                            },
                            "xPathQueries": {
                              "type": "array",
                              "defaultValue": []
                            },
                            "counterSpecifiers": {
                              "type": "array",
                              "defaultValue": []
                            },
                            "samplingFrequencyInSeconds": {
                              "type": "int",
                              "defaultValue": 300
                            },
                            "Tags": {
                              "type": "object"
                            },
                            "dceId": {
                              "type": "string"
                            }
                          },
                          "resources": [
                            {
                              "type": "Microsoft.Insights/dataCollectionRules",
                              "apiVersion": "2022-06-01",
                              "name": "[parameters('rulename')]",
                              "location": "[parameters('location')]",
                              "tags": "[parameters('Tags')]",
                              "kind": "[parameters('kind')]",
                              "properties": {
                                "dataCollectionEndpointId": "[parameters('dceId')]",
                                "description": "[format('Data Collection Rule for {0}}} - {1}}}', parameters('kind'), parameters('rulename'))]",
                                "destinations": {
                                  "logAnalytics": [
                                    {
                                      "workspaceResourceId": "[parameters('workspaceId')]",
                                      "name": "[parameters('wsfriendlyname')]"
                                    }
                                  ]
                                },
                                "dataSources": {
                                  "windowsEventLogs": "[if(empty(parameters('xPathQueries')), null(), createArray(createObject('streams', createArray('Microsoft-Event'), 'xPathQueries', parameters('xPathQueries'), 'name', 'EventLogsDataSource')))]",
                                  "performanceCounters": [
                                    {
                                      "streams": [
                                        "Microsoft-Perf"
                                      ],
                                      "samplingFrequencyInSeconds": "[parameters('samplingFrequencyInSeconds')]",
                                      "counterSpecifiers": "[parameters('counterSpecifiers')]",
                                      "name": "PerfCountersDataSource"
                                    }
                                  ]
                                },
                                "dataFlows": [
                                  {
                                    "streams": [
                                      "Microsoft-Event",
                                      "Microsoft-Perf"
                                    ],
                                    "destinations": [
                                      "[parameters('wsfriendlyname')]"
                                    ]
                                  }
                                ]
                              }
                            }
                          ],
                          "outputs": {
                            "dcrId": {
                              "type": "string",
                              "value": "[resourceId('Microsoft.Insights/dataCollectionRules', parameters('rulename'))]"
                            }
                          }
                        }
                      }
                    },
                    {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2022-09-01",
                      "name": "[format('client-{0}-{1}-{2}', parameters('instanceName'), parameters('packtag'), parameters('location'))]",
                      "location": "[deployment().location]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "dceId": {
                            "value": "[parameters('dceId')]"
                          },
                          "instanceName": {
                            "value": "[parameters('instanceName')]"
                          },
                          "location": {
                            "value": "[parameters('location')]"
                          },
                          "imageGalleryName": {
                            "value": "[parameters('imageGalleryName')]"
                          },
                          "resourceGroupId": {
                            "value": "[parameters('resourceGroupId')]"
                          },
                          "storageAccountname": {
                            "value": "[parameters('storageAccountname')]"
                          },
                          "subscriptionId": {
                            "value": "[parameters('subscriptionId')]"
                          },
                          "tableName": {
                            "value": "[parameters('tableName')]"
                          },
                          "tags": {
                            "value": "[parameters('tags')]"
                          },
                          "userManagedIdentityResourceId": {
                            "value": "[parameters('userManagedIdentityResourceId')]"
                          },
                          "workspaceId": {
                            "value": "[parameters('workspaceId')]"
                          },
                          "packtag": {
                            "value": "[parameters('packtag')]"
                          },
                          "solutionTag": {
                            "value": "[parameters('solutionTag')]"
                          },
                          "appDescription": {
                            "value": "[variables('appDescription')]"
                          },
                          "appName": {
                            "value": "[variables('appName')]"
                          },
                          "OS": {
                            "value": "[variables('OS')]"
                          },
                          "ruleshortname": {
                            "value": "[variables('ruleshortname')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2018-05-01/subscriptionDeploymentTemplate.json#",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.32.4.45862",
                              "templateHash": "6845953741684185836"
                            }
                          },
                          "parameters": {
                            "packtag": {
                              "type": "string",
                              "defaultValue": "ADDS",
                              "metadata": {
                                "description": "Name of the DCR rule to be created"
                              }
                            },
                            "location": {
                              "type": "string",
                              "metadata": {
                                "description": "location for the deployment."
                              }
                            },
                            "workspaceId": {
                              "type": "string",
                              "metadata": {
                                "description": "Full resource ID of the log analytics workspace to be used for the deployment."
                              }
                            },
                            "solutionTag": {
                              "type": "string"
                            },
                            "dceId": {
                              "type": "string",
                              "metadata": {
                                "description": "Full resource ID of the data collection endpoint to be used for the deployment."
                              }
                            },
                            "userManagedIdentityResourceId": {
                              "type": "string",
                              "metadata": {
                                "description": "Full resource ID of the user managed identity to be used for the deployment"
                              }
                            },
                            "subscriptionId": {
                              "type": "string"
                            },
                            "resourceGroupId": {
                              "type": "string"
                            },
                            "storageAccountname": {
                              "type": "string"
                            },
                            "imageGalleryName": {
                              "type": "string"
                            },
                            "tableName": {
                              "type": "string"
                            },
                            "tags": {
                              "type": "object"
                            },
                            "instanceName": {
                              "type": "string"
                            },
                            "ruleshortname": {
                              "type": "string"
                            },
                            "appName": {
                              "type": "string"
                            },
                            "appDescription": {
                              "type": "string"
                            },
                            "OS": {
                              "type": "string"
                            }
                          },
                          "variables": {
                            "resourceGroupName": "[split(parameters('resourceGroupId'), '/')[4]]",
                            "tableNameToUse": "[format('{0}_CL', parameters('tableName'))]",
                            "lawFriendlyName": "[split(parameters('workspaceId'), '/')[8]]"
                          },
                          "resources": [
                            {
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "addscollectionapp",
                              "subscriptionId": "[parameters('subscriptionId')]",
                              "resourceGroup": "[variables('resourceGroupName')]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "aigname": {
                                    "value": "[parameters('imageGalleryName')]"
                                  },
                                  "appDescription": {
                                    "value": "[parameters('appDescription')]"
                                  },
                                  "appName": {
                                    "value": "[parameters('appName')]"
                                  },
                                  "location": {
                                    "value": "[parameters('location')]"
                                  },
                                  "osType": {
                                    "value": "[parameters('OS')]"
                                  },
                                  "tags": {
                                    "value": "[parameters('tags')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.32.4.45862",
                                      "templateHash": "17117017597267615596"
                                    }
                                  },
                                  "parameters": {
                                    "location": {
                                      "type": "string"
                                    },
                                    "aigname": {
                                      "type": "string"
                                    },
                                    "osType": {
                                      "type": "string"
                                    },
                                    "appDescription": {
                                      "type": "string"
                                    },
                                    "appName": {
                                      "type": "string"
                                    },
                                    "tags": {
                                      "type": "object"
                                    }
                                  },
                                  "resources": [
                                    {
                                      "type": "Microsoft.Compute/galleries/applications",
                                      "apiVersion": "2022-03-03",
                                      "name": "[format('{0}/{1}', parameters('aigname'), parameters('appName'))]",
                                      "location": "[parameters('location')]",
                                      "tags": "[parameters('tags')]",
                                      "properties": {
                                        "supportedOSType": "[parameters('osType')]",
                                        "description": "[parameters('appDescription')]"
                                      }
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "upload-addscollectionapp",
                              "subscriptionId": "[parameters('subscriptionId')]",
                              "resourceGroup": "[variables('resourceGroupName')]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "containerName": {
                                    "value": "applications"
                                  },
                                  "filename": {
                                    "value": "addscollection.zip"
                                  },
                                  "storageAccountName": {
                                    "value": "[parameters('storageAccountname')]"
                                  },
                                  "location": {
                                    "value": "[parameters('location')]"
                                  },
                                  "tags": {
                                    "value": "[parameters('tags')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.32.4.45862",
                                      "templateHash": "4498386373395502236"
                                    }
                                  },
                                  "parameters": {
                                    "location": {
                                      "type": "string"
                                    },
                                    "storageAccountName": {
                                      "type": "string"
                                    },
                                    "sasExpiry": {
                                      "type": "string",
                                      "defaultValue": "[dateTimeAdd(utcNow(), 'PT2H')]"
                                    },
                                    "filename": {
                                      "type": "string"
                                    },
                                    "containerName": {
                                      "type": "string"
                                    },
                                    "tags": {
                                      "type": "object"
                                    }
                                  },
                                  "variables": {
                                    "$fxv#0": "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",
                                    "discoveryContainerName": "applications",
                                    "tempfilename": "download.tmp",
                                    "sasConfig": {
                                      "signedResourceTypes": "sco",
                                      "signedPermission": "r",
                                      "signedServices": "b",
                                      "signedExpiry": "[parameters('sasExpiry')]",
                                      "signedProtocol": "https",
                                      "keyToSign": "key2"
                                    }
                                  },
                                  "resources": [
                                    {
                                      "type": "Microsoft.Resources/deploymentScripts",
                                      "apiVersion": "2020-10-01",
                                      "name": "deployscript-addappdiscovery",
                                      "tags": "[parameters('tags')]",
                                      "location": "[parameters('location')]",
                                      "kind": "AzureCLI",
                                      "properties": {
                                        "azCliVersion": "2.42.0",
                                        "timeout": "PT5M",
                                        "retentionInterval": "PT1H",
                                        "environmentVariables": [
                                          {
                                            "name": "AZURE_STORAGE_ACCOUNT",
                                            "value": "[parameters('storageAccountName')]"
                                          },
                                          {
                                            "name": "AZURE_STORAGE_KEY",
                                            "secureValue": "[listKeys(resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName')), '2023-01-01').keys[0].value]"
                                          },
                                          {
                                            "name": "CONTENT",
                                            "value": "[variables('$fxv#0')]"
                                          }
                                        ],
                                        "scriptContent": "[format('echo \"$CONTENT\" > {0} && cat {1} | base64 -d > {2} && az storage blob upload -f {3} -c {4} -n {5} --overwrite true', variables('tempfilename'), variables('tempfilename'), parameters('filename'), parameters('filename'), variables('discoveryContainerName'), parameters('filename'))]"
                                      }
                                    }
                                  ],
                                  "outputs": {
                                    "fileURL": {
                                      "type": "string",
                                      "value": "[format('{0}{1}/{2}?{3}', reference(resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName')), '2023-01-01').primaryEndpoints.blob, parameters('containerName'), parameters('filename'), listAccountSAS(resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName')), '2023-01-01', variables('sasConfig')).accountSasToken)]"
                                    }
                                  }
                                }
                              }
                            },
                            {
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "addscollectionappversion",
                              "subscriptionId": "[parameters('subscriptionId')]",
                              "resourceGroup": "[variables('resourceGroupName')]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "aigname": {
                                    "value": "[parameters('imageGalleryName')]"
                                  },
                                  "appName": {
                                    "value": "[parameters('appName')]"
                                  },
                                  "appVersionName": {
                                    "value": "1.0.0"
                                  },
                                  "location": {
                                    "value": "[parameters('location')]"
                                  },
                                  "targetRegion": {
                                    "value": "[parameters('location')]"
                                  },
                                  "mediaLink": {
                                    "value": "[reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', parameters('subscriptionId'), variables('resourceGroupName')), 'Microsoft.Resources/deployments', 'upload-addscollectionapp'), '2022-09-01').outputs.fileURL.value]"
                                  },
                                  "installCommands": {
                                    "value": "powershell -command \"ren addscollection addscollection.zip; expand-archive ./addscollection.zip . ; ./install.ps1\""
                                  },
                                  "removeCommands": {
                                    "value": "powershell -command \"Unregister-ScheduledTask -TaskName 'AD DS Collection Task' '\\' \""
                                  },
                                  "tags": {
                                    "value": "[parameters('tags')]"
                                  },
                                  "packageFileName": {
                                    "value": "addscollection.zip"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.32.4.45862",
                                      "templateHash": "12441285522123093851"
                                    }
                                  },
                                  "parameters": {
                                    "aigname": {
                                      "type": "string"
                                    },
                                    "appName": {
                                      "type": "string"
                                    },
                                    "appVersionName": {
                                      "type": "string"
                                    },
                                    "location": {
                                      "type": "string"
                                    },
                                    "targetRegion": {
                                      "type": "string"
                                    },
                                    "mediaLink": {
                                      "type": "string"
                                    },
                                    "packageFileName": {
                                      "type": "string"
                                    },
                                    "installCommands": {
                                      "type": "string"
                                    },
                                    "removeCommands": {
                                      "type": "string"
                                    },
                                    "tags": {
                                      "type": "object"
                                    }
                                  },
                                  "resources": [
                                    {
                                      "type": "Microsoft.Compute/galleries/applications/versions",
                                      "apiVersion": "2022-03-03",
                                      "name": "[format('{0}/{1}/{2}', parameters('aigname'), parameters('appName'), parameters('appVersionName'))]",
                                      "location": "[parameters('location')]",
                                      "tags": "[parameters('tags')]",
                                      "properties": {
                                        "publishingProfile": {
                                          "source": {
                                            "mediaLink": "[parameters('mediaLink')]"
                                          },
                                          "manageActions": {
                                            "install": "[parameters('installCommands')]",
                                            "remove": "[parameters('removeCommands')]"
                                          },
                                          "settings": {
                                            "packageFileName": "[parameters('packageFileName')]"
                                          },
                                          "enableHealthCheck": false,
                                          "targetRegions": [
                                            {
                                              "name": "[parameters('targetRegion')]",
                                              "regionalReplicaCount": 1,
                                              "storageAccountType": "Standard_LRS"
                                            }
                                          ],
                                          "replicaCount": 1,
                                          "excludeFromLatest": false,
                                          "storageAccountType": "Standard_LRS"
                                        }
                                      }
                                    }
                                  ],
                                  "outputs": {
                                    "appVersionId": {
                                      "type": "string",
                                      "value": "[resourceId('Microsoft.Compute/galleries/applications/versions', parameters('aigname'), parameters('appName'), parameters('appVersionName'))]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', parameters('subscriptionId'), variables('resourceGroupName')), 'Microsoft.Resources/deployments', 'addscollectionapp')]",
                                "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', parameters('subscriptionId'), variables('resourceGroupName')), 'Microsoft.Resources/deployments', 'upload-addscollectionapp')]"
                              ]
                            },
                            {
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "[variables('tableNameToUse')]",
                              "subscriptionId": "[parameters('subscriptionId')]",
                              "resourceGroup": "[variables('resourceGroupName')]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "parentname": {
                                    "value": "[variables('lawFriendlyName')]"
                                  },
                                  "tableName": {
                                    "value": "[variables('tableNameToUse')]"
                                  },
                                  "retentionDays": {
                                    "value": 31
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.32.4.45862",
                                      "templateHash": "2081426938105913058"
                                    }
                                  },
                                  "parameters": {
                                    "parentname": {
                                      "type": "string"
                                    },
                                    "tableName": {
                                      "type": "string"
                                    },
                                    "retentionDays": {
                                      "type": "int",
                                      "defaultValue": 31
                                    }
                                  },
                                  "resources": [
                                    {
                                      "type": "Microsoft.OperationalInsights/workspaces/tables",
                                      "apiVersion": "2022-10-01",
                                      "name": "[format('{0}/{1}', parameters('parentname'), parameters('tableName'))]",
                                      "properties": {
                                        "totalRetentionInDays": "[parameters('retentionDays')]",
                                        "plan": "Analytics",
                                        "schema": {
                                          "name": "[parameters('tableName')]",
                                          "columns": [
                                            {
                                              "name": "TimeGenerated",
                                              "type": "datetime"
                                            },
                                            {
                                              "name": "RawData",
                                              "type": "string"
                                            }
                                          ]
                                        },
                                        "retentionInDays": "[parameters('retentionDays')]"
                                      }
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "addscollectionDCR",
                              "subscriptionId": "[parameters('subscriptionId')]",
                              "resourceGroup": "[variables('resourceGroupName')]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "endpointResourceId": {
                                    "value": "[parameters('dceId')]"
                                  },
                                  "filepatterns": {
                                    "value": [
                                      "C:\\WindowsAzure\\ADDS\\*.csv"
                                    ]
                                  },
                                  "kind": {
                                    "value": "Windows"
                                  },
                                  "location": {
                                    "value": "[parameters('location')]"
                                  },
                                  "lawResourceId": {
                                    "value": "[parameters('workspaceId')]"
                                  },
                                  "OS": {
                                    "value": "Windows"
                                  },
                                  "solutionTag": {
                                    "value": "[parameters('solutionTag')]"
                                  },
                                  "tableName": {
                                    "value": "[variables('tableNameToUse')]"
                                  },
                                  "packtag": {
                                    "value": "ADDS"
                                  },
                                  "packtype": {
                                    "value": "IaaS"
                                  },
                                  "instanceName": {
                                    "value": "[parameters('instanceName')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.32.4.45862",
                                      "templateHash": "1128108251442731456"
                                    }
                                  },
                                  "parameters": {
                                    "location": {
                                      "type": "string"
                                    },
                                    "solutionTag": {
                                      "type": "string"
                                    },
                                    "lawResourceId": {
                                      "type": "string"
                                    },
                                    "tableName": {
                                      "type": "string"
                                    },
                                    "packtag": {
                                      "type": "string"
                                    },
                                    "kind": {
                                      "type": "string"
                                    },
                                    "filepatterns": {
                                      "type": "array"
                                    },
                                    "OS": {
                                      "type": "string"
                                    },
                                    "packtype": {
                                      "type": "string"
                                    },
                                    "endpointResourceId": {
                                      "type": "string",
                                      "metadata": {
                                        "description": "Specifies the resource id of the data collection endpoint."
                                      }
                                    },
                                    "instanceName": {
                                      "type": "string"
                                    }
                                  },
                                  "variables": {
                                    "streamName": "[format('Custom-{0}', parameters('tableName'))]",
                                    "lawFriendlyName": "[split(parameters('lawResourceId'), '/')[8]]"
                                  },
                                  "resources": [
                                    {
                                      "type": "Microsoft.Insights/dataCollectionRules",
                                      "apiVersion": "2022-06-01",
                                      "name": "[format('AMP-{0}-FileColl-{1}-{2}', parameters('instanceName'), parameters('packtag'), parameters('OS'))]",
                                      "location": "[parameters('location')]",
                                      "tags": {
                                        "[format('{0}', parameters('solutionTag'))]": "[parameters('packtag')]",
                                        "MonitoringPackType": "[parameters('packtype')]"
                                      },
                                      "kind": "[parameters('kind')]",
                                      "properties": {
                                        "dataSources": {
                                          "logFiles": [
                                            {
                                              "streams": [
                                                "[variables('streamName')]"
                                              ],
                                              "filePatterns": "[parameters('filepatterns')]",
                                              "format": "text",
                                              "settings": {
                                                "text": {
                                                  "recordStartTimestampFormat": "ISO 8601"
                                                }
                                              },
                                              "name": "[parameters('tableName')]"
                                            }
                                          ]
                                        },
                                        "destinations": {
                                          "logAnalytics": [
                                            {
                                              "workspaceResourceId": "[parameters('lawResourceId')]",
                                              "name": "[variables('lawFriendlyName')]"
                                            }
                                          ]
                                        },
                                        "dataFlows": [
                                          {
                                            "streams": [
                                              "[variables('streamName')]"
                                            ],
                                            "destinations": [
                                              "[variables('lawFriendlyName')]"
                                            ],
                                            "transformKql": "source",
                                            "outputStream": "[variables('streamName')]"
                                          }
                                        ],
                                        "dataCollectionEndpointId": "[parameters('endpointResourceId')]",
                                        "streamDeclarations": {
                                          "[format('{0}', variables('streamName'))]": {
                                            "columns": [
                                              {
                                                "name": "TimeGenerated",
                                                "type": "datetime"
                                              },
                                              {
                                                "name": "RawData",
                                                "type": "string"
                                              }
                                            ]
                                          }
                                        }
                                      }
                                    }
                                  ],
                                  "outputs": {
                                    "ruleId": {
                                      "type": "string",
                                      "value": "[resourceId('Microsoft.Insights/dataCollectionRules', format('AMP-{0}-FileColl-{1}-{2}', parameters('instanceName'), parameters('packtag'), parameters('OS')))]"
                                    },
                                    "ruleName": {
                                      "type": "string",
                                      "value": "[format('AMP-{0}-FileColl-{1}-{2}', parameters('instanceName'), parameters('packtag'), parameters('OS'))]"
                                    }
                                  }
                                }
                              },
                              "dependsOn": [
                                "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', parameters('subscriptionId'), variables('resourceGroupName')), 'Microsoft.Resources/deployments', variables('tableNameToUse'))]"
                              ]
                            }
                          ]
                        }
                      }
                    }
                  ]
                }
              }
            },
            {
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2022-09-01",
              "name": "[format('VMInsightsPack-{0}-{1}', parameters('instanceName'), parameters('location'))]",
              "location": "[deployment().location]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "dceId": {
                    "value": "[parameters('dceId')]"
                  },
                  "location": {
                    "value": "[parameters('location')]"
                  },
                  "resourceGroupId": {
                    "value": "[parameters('resourceGroupId')]"
                  },
                  "solutionTag": {
                    "value": "[parameters('solutionTag')]"
                  },
                  "solutionVersion": {
                    "value": "[parameters('solutionVersion')]"
                  },
                  "subscriptionId": {
                    "value": "[parameters('subscriptionId')]"
                  },
                  "userManagedIdentityResourceId": {
                    "value": "[parameters('userManagedIdentityResourceId')]"
                  },
                  "workspaceId": {
                    "value": "[parameters('workspaceId')]"
                  },
                  "customerTags": {
                    "value": "[parameters('customerTags')]"
                  },
                  "actionGroupResourceId": {
                    "value": "[parameters('actionGroupResourceId')]"
                  },
                  "instanceName": {
                    "value": "[parameters('instanceName')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2018-05-01/subscriptionDeploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.32.4.45862",
                      "templateHash": "7423306630869613208"
                    }
                  },
                  "parameters": {
                    "packtag": {
                      "type": "string",
                      "defaultValue": "VMI",
                      "metadata": {
                        "description": "The Tag value for this pack"
                      }
                    },
                    "actionGroupResourceId": {
                      "type": "string"
                    },
                    "location": {
                      "type": "string",
                      "metadata": {
                        "description": "location for the deployment."
                      }
                    },
                    "workspaceId": {
                      "type": "string",
                      "metadata": {
                        "description": "Full resource ID of the log analytics workspace to be used for the deployment."
                      }
                    },
                    "solutionTag": {
                      "type": "string"
                    },
                    "solutionVersion": {
                      "type": "string"
                    },
                    "dceId": {
                      "type": "string"
                    },
                    "userManagedIdentityResourceId": {
                      "type": "string"
                    },
                    "subscriptionId": {
                      "type": "string"
                    },
                    "resourceGroupId": {
                      "type": "string"
                    },
                    "customerTags": {
                      "type": "object"
                    },
                    "instanceName": {
                      "type": "string"
                    }
                  },
                  "variables": {
                    "rulename": "[format('AMP-{0}-{1}', parameters('instanceName'), parameters('packtag'))]",
                    "ruleshortname": "[format('AMP-{0}-{1}', parameters('instanceName'), parameters('packtag'))]",
                    "tempTags": {
                      "[format('{0}', parameters('solutionTag'))]": "[parameters('packtag')]",
                      "MonitoringPackType": "IaaS",
                      "solutionVersion": "[parameters('solutionVersion')]"
                    },
                    "Tags": "[if(equals(parameters('customerTags'), createObject()), variables('tempTags'), union(variables('tempTags'), parameters('customerTags').All))]",
                    "resourceGroupName": "[split(parameters('resourceGroupId'), '/')[4]]"
                  },
                  "resources": [
                    {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2022-09-01",
                      "name": "[format('vmInsightsDCR-{0}', parameters('packtag'))]",
                      "subscriptionId": "[parameters('subscriptionId')]",
                      "resourceGroup": "[variables('resourceGroupName')]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "location": {
                            "value": "[parameters('location')]"
                          },
                          "workspaceResourceId": {
                            "value": "[parameters('workspaceId')]"
                          },
                          "Tags": {
                            "value": "[variables('Tags')]"
                          },
                          "ruleName": {
                            "value": "[variables('rulename')]"
                          },
                          "dceId": {
                            "value": "[parameters('dceId')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.32.4.45862",
                              "templateHash": "13954368441826719999"
                            }
                          },
                          "parameters": {
                            "location": {
                              "type": "string"
                            },
                            "workspaceResourceId": {
                              "type": "string"
                            },
                            "Tags": {
                              "type": "object"
                            },
                            "ruleName": {
                              "type": "string"
                            },
                            "dceId": {
                              "type": "string"
                            }
                          },
                          "variables": {
                            "wsfriendlyname": "[split(parameters('workspaceResourceId'), '/')[8]]"
                          },
                          "resources": [
                            {
                              "type": "Microsoft.Insights/dataCollectionRules",
                              "apiVersion": "2021-09-01-preview",
                              "name": "[format('{0}-VMI', parameters('ruleName'))]",
                              "location": "[parameters('location')]",
                              "tags": "[parameters('Tags')]",
                              "properties": {
                                "description": "Data collection rule for VM Insights.",
                                "dataCollectionEndpointId": "[parameters('dceId')]",
                                "dataSources": {
                                  "performanceCounters": [
                                    {
                                      "name": "VMInsightsPerfCounters",
                                      "streams": [
                                        "Microsoft-InsightsMetrics"
                                      ],
                                      "samplingFrequencyInSeconds": 60,
                                      "counterSpecifiers": [
                                        "\\VmInsights\\DetailedMetrics"
                                      ]
                                    }
                                  ]
                                },
                                "destinations": {
                                  "logAnalytics": [
                                    {
                                      "workspaceResourceId": "[parameters('workspaceResourceId')]",
                                      "name": "[variables('wsfriendlyname')]"
                                    }
                                  ]
                                },
                                "dataFlows": [
                                  {
                                    "streams": [
                                      "Microsoft-InsightsMetrics"
                                    ],
                                    "destinations": [
                                      "[variables('wsfriendlyname')]"
                                    ]
                                  }
                                ]
                              }
                            }
                          ],
                          "outputs": {
                            "VMIRuleId": {
                              "type": "string",
                              "value": "[resourceId('Microsoft.Insights/dataCollectionRules', format('{0}-VMI', parameters('ruleName')))]"
                            }
                          }
                        }
                      }
                    },
                    {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2022-09-01",
                      "name": "[format('Alerts-{0}', parameters('packtag'))]",
                      "subscriptionId": "[parameters('subscriptionId')]",
                      "resourceGroup": "[variables('resourceGroupName')]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "location": {
                            "value": "[parameters('location')]"
                          },
                          "workspaceId": {
                            "value": "[parameters('workspaceId')]"
                          },
                          "AGId": {
                            "value": "[parameters('actionGroupResourceId')]"
                          },
                          "packtag": {
                            "value": "[parameters('packtag')]"
                          },
                          "Tags": {
                            "value": "[variables('Tags')]"
                          },
                          "instanceName": {
                            "value": "[parameters('instanceName')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.32.4.45862",
                              "templateHash": "17027824023029962763"
                            }
                          },
                          "parameters": {
                            "location": {
                              "type": "string"
                            },
                            "workspaceId": {
                              "type": "string"
                            },
                            "AGId": {
                              "type": "string"
                            },
                            "packtag": {
                              "type": "string"
                            },
                            "Tags": {
                              "type": "object"
                            },
                            "instanceName": {
                              "type": "string"
                            }
                          },
                          "variables": {
                            "moduleprefix": "[format('AMP-{0}-{1}', parameters('instanceName'), parameters('packtag'))]",
                            "alertlist": [
                              {
                                "alertRuleDescription": "Log Alert for Virtual Machine Data Disk Read Latency (ms)",
                                "alertRuleDisplayName": "Data Disk Read Latency (ms)",
                                "alertRuleName": "DataDiskReadLatency(ms)",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT5M",
                                "windowSize": "PT15M",
                                "alertType": "Aggregated",
                                "metricMeasureColumn": "AggregatedValue",
                                "operator": "GreaterThan",
                                "threshold": 30,
                                "query": "    InsightsMetrics\r\n| where Origin == \"vm.azm.ms\"\r\n| where Namespace == \"LogicalDisk\" and Name == \"ReadLatencyMs\"\r\n| extend Disk=tostring(todynamic(Tags)[\"vm.azm.ms/mountId\"])\r\n| where Disk !in ('C:','/')\r\n| summarize AggregatedValue = avg(Val) by bin(TimeGenerated,15m), Computer, _ResourceId, Disk\r\n"
                              },
                              {
                                "alertRuleDescription": "Log Alert for Virtual Machine Data Disk Free Space Percentage",
                                "alertRuleDisplayName": "Data Disk Free Space Percentage",
                                "alertRuleName": "DataDiskFreeSpacePercentage",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT5M",
                                "windowSize": "PT15M",
                                "alertType": "Aggregated",
                                "metricMeasureColumn": "AggregatedValue",
                                "operator": "LessThan",
                                "threshold": 10,
                                "query": "    InsightsMetrics\r\n| where Origin == \"vm.azm.ms\"\r\n| where Namespace == \"LogicalDisk\"and Name == \"FreeSpacePercentage\"\r\n| extend Disk=tostring(todynamic(Tags)[\"vm.azm.ms/mountId\"])\r\n| where Disk !in ('C:','/')\r\n| summarize AggregatedValue = avg(Val) by bin(TimeGenerated,15m), Computer, _ResourceId, Disk\r\n"
                              },
                              {
                                "alertRuleDescription": "Log Alert for Virtual Machine Data Disk Write Latency (ms)",
                                "alertRuleDisplayName": "Data Disk Write Latency (ms)",
                                "alertRuleName": "DataDiskWriteLatency(ms)",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT5M",
                                "windowSize": "PT15M",
                                "alertType": "Aggregated",
                                "metricMeasureColumn": "AggregatedValue",
                                "operator": "GreaterThan",
                                "threshold": 30,
                                "query": "    InsightsMetrics\r\n| where Origin == \"vm.azm.ms\"\r\n| where Namespace == \"LogicalDisk\" and Name == \"WriteLatencyMs\"\r\n| extend Disk=tostring(todynamic(Tags)[\"vm.azm.ms/mountId\"])\r\n| where Disk !in ('C:','/')\r\n| summarize AggregatedValue = avg(Val) by bin(TimeGenerated,15m), Computer, _ResourceId, Disk\r\n"
                              },
                              {
                                "alertRuleDescription": "Log Alert for Virtual Machine Network Read (bytes-sec)",
                                "alertRuleDisplayName": "Network Read (bytes-sec)",
                                "alertRuleName": "NetworkRead(bytes-sec)",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT5M",
                                "windowSize": "PT15M",
                                "alertType": "Aggregated",
                                "metricMeasureColumn": "AggregatedValue",
                                "operator": "GreaterThan",
                                "threshold": 10000000,
                                "query": "    InsightsMetrics\r\n| where Origin == \"vm.azm.ms\"\r\n| where Namespace == \"Network\" and Name == \"ReadBytesPerSecond\"\r\n| extend NetworkInterface=tostring(todynamic(Tags)[\"vm.azm.ms/networkDeviceId\"])\r\n| summarize AggregatedValue = avg(Val) by bin(TimeGenerated, 15m), Computer, _ResourceId, NetworkInterface\r\n"
                              },
                              {
                                "alertRuleDescription": "Log Alert for Virtual Machine Network Write (bytes-sec)",
                                "alertRuleDisplayName": "Network Write (bytes-sec)",
                                "alertRuleName": "NetworkWrite(bytes-sec)",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT5M",
                                "windowSize": "PT15M",
                                "alertType": "Aggregated",
                                "metricMeasureColumn": "AggregatedValue",
                                "operator": "GreaterThan",
                                "threshold": 10000000,
                                "query": "    InsightsMetrics\r\n| where Origin == \"vm.azm.ms\"\r\n| where Namespace == \"Network\" and Name == \"WriteBytesPerSecond\"\r\n| extend NetworkInterface=tostring(todynamic(Tags)[\"vm.azm.ms/networkDeviceId\"])\r\n| summarize AggregatedValue = avg(Val) by bin(TimeGenerated, 15m), Computer, _ResourceId, NetworkInterface\r\n"
                              },
                              {
                                "alertRuleDescription": "Log Alert for Virtual Machine Data OS Read Latency (ms)",
                                "alertRuleDisplayName": "OS Disk Read Latency (ms)",
                                "alertRuleName": "OSDiskReadLatency(ms)",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT5M",
                                "windowSize": "PT15M",
                                "alertType": "Aggregated",
                                "metricMeasureColumn": "AggregatedValue",
                                "operator": "GreaterThan",
                                "threshold": 30,
                                "query": "    InsightsMetrics\r\n| where Origin == \"vm.azm.ms\"\r\n| where Namespace == \"LogicalDisk\" and Name == \"ReadLatencyMs\"\r\n| extend Disk=tostring(todynamic(Tags)[\"vm.azm.ms/mountId\"])\r\n| summarize AggregatedValue = avg(Val) by bin(TimeGenerated, 15m), Computer, _ResourceId, Disk\r\n"
                              },
                              {
                                "alertRuleDescription": "Log Alert for Virtual Machine OS Disk Free Space Percentage",
                                "alertRuleDisplayName": "OS Disk Free Space Percentage",
                                "alertRuleName": "OSDiskFreeSpacePercentage",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT5M",
                                "windowSize": "PT15M",
                                "alertType": "Aggregated",
                                "metricMeasureColumn": "AggregatedValue",
                                "operator": "LessThan",
                                "threshold": 10,
                                "query": "    InsightsMetrics\r\n| where Origin == \"vm.azm.ms\"\r\n| where Namespace == \"LogicalDisk\" and Name == \"FreeSpacePercentage\"\r\n| extend Disk=tostring(todynamic(Tags)[\"vm.azm.ms/mountId\"])\r\n| summarize AggregatedValue = avg(Val) by bin(TimeGenerated, 15m), Computer, _ResourceId, Disk\r\n"
                              },
                              {
                                "alertRuleDescription": "Log Alert for Virtual Machine OS Disk Write Latency (ms)",
                                "alertRuleDisplayName": "OS Disk Write Latency (ms)",
                                "alertRuleName": "OSDiskWriteLatency(ms)",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT5M",
                                "windowSize": "PT15M",
                                "alertType": "Aggregated",
                                "metricMeasureColumn": "AggregatedValue",
                                "operator": "GreaterThan",
                                "threshold": 50,
                                "query": "    InsightsMetrics| where Origin == \"vm.azm.ms\"\r\n| where Namespace == \"LogicalDisk\" and Name == \"WriteLatencyMs\"\r\n| extend Disk=tostring(todynamic(Tags)[\"vm.azm.ms/mountId\"])\r\n| summarize AggregatedValue = avg(Val) by bin(TimeGenerated, 15m), Computer, _ResourceId, Disk\r\n"
                              },
                              {
                                "alertRuleDescription": "Log Alert for Virtual Machine Processor Utilization Percentage",
                                "alertRuleDisplayName": "Processor Utilization Percentage",
                                "alertRuleName": "ProcessorUtilizationPercentage",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT5M",
                                "windowSize": "PT15M",
                                "alertType": "Aggregated",
                                "metricMeasureColumn": "AggregatedValue",
                                "operator": "GreaterThan",
                                "threshold": 85,
                                "query": "    InsightsMetrics\r\n| where Origin == \"vm.azm.ms\"\r\n| where Namespace == \"Processor\" and Name == \"UtilizationPercentage\"\r\n| summarize AggregatedValue = avg(Val) by bin(TimeGenerated, 15m), Computer, _ResourceId\r\n"
                              },
                              {
                                "alertRuleDescription": "Log Alert for Virtual Machine Available Memory Percentage",
                                "alertRuleDisplayName": "Available Memory Percentage",
                                "alertRuleName": "AvailableMemoryPercentage",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT5M",
                                "windowSize": "PT15M",
                                "alertType": "Aggregated",
                                "metricMeasureColumn": "AggregatedValue",
                                "operator": "LessThan",
                                "threshold": 10,
                                "query": "    InsightsMetrics\r\n| where Origin == \"vm.azm.ms\"\r\n| where Namespace == \"Memory\" and Name == \"AvailableMB\"\r\n| extend TotalMemory = toreal(todynamic(Tags)[\"vm.azm.ms/memorySizeMB\"])\r\n| extend AvailableMemoryPercentage = (toreal(Val) / TotalMemory) * 100.0\r\n| summarize AggregatedValue = avg(AvailableMemoryPercentage) by bin(TimeGenerated, 15m), Computer, _ResourceId\r\n"
                              }
                            ]
                          },
                          "resources": [
                            {
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "[format('{0}-Alerts', variables('moduleprefix'))]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "alertlist": {
                                    "value": "[variables('alertlist')]"
                                  },
                                  "AGId": {
                                    "value": "[parameters('AGId')]"
                                  },
                                  "location": {
                                    "value": "[parameters('location')]"
                                  },
                                  "moduleprefix": {
                                    "value": "[variables('moduleprefix')]"
                                  },
                                  "packtag": {
                                    "value": "[parameters('packtag')]"
                                  },
                                  "Tags": {
                                    "value": "[parameters('Tags')]"
                                  },
                                  "workspaceId": {
                                    "value": "[parameters('workspaceId')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.32.4.45862",
                                      "templateHash": "17858688129795365440"
                                    }
                                  },
                                  "parameters": {
                                    "alertlist": {
                                      "type": "array"
                                    },
                                    "location": {
                                      "type": "string"
                                    },
                                    "workspaceId": {
                                      "type": "string"
                                    },
                                    "AGId": {
                                      "type": "string"
                                    },
                                    "packtag": {
                                      "type": "string"
                                    },
                                    "Tags": {
                                      "type": "object"
                                    },
                                    "moduleprefix": {
                                      "type": "string"
                                    }
                                  },
                                  "resources": [
                                    {
                                      "copy": {
                                        "name": "Alerts",
                                        "count": "[length(parameters('alertlist'))]"
                                      },
                                      "type": "Microsoft.Resources/deployments",
                                      "apiVersion": "2022-09-01",
                                      "name": "[format('{0}-Alert-{1}', parameters('packtag'), copyIndex())]",
                                      "properties": {
                                        "expressionEvaluationOptions": {
                                          "scope": "inner"
                                        },
                                        "mode": "Incremental",
                                        "parameters": {
                                          "location": {
                                            "value": "[parameters('location')]"
                                          },
                                          "actionGroupResourceId": {
                                            "value": "[parameters('AGId')]"
                                          },
                                          "alertRuleDescription": {
                                            "value": "[parameters('alertlist')[copyIndex()].alertRuleDescription]"
                                          },
                                          "alertRuleDisplayName": {
                                            "value": "[format('{0}-{1}', parameters('moduleprefix'), parameters('alertlist')[copyIndex()].alertRuleDisplayName)]"
                                          },
                                          "alertRuleName": {
                                            "value": "[format('{0}-{1}', parameters('moduleprefix'), parameters('alertlist')[copyIndex()].alertRuleName)]"
                                          },
                                          "alertRuleSeverity": {
                                            "value": "[parameters('alertlist')[copyIndex()].alertRuleSeverity]"
                                          },
                                          "autoMitigate": {
                                            "value": "[parameters('alertlist')[copyIndex()].autoMitigate]"
                                          },
                                          "evaluationFrequency": {
                                            "value": "[parameters('alertlist')[copyIndex()].evaluationFrequency]"
                                          },
                                          "windowSize": {
                                            "value": "[parameters('alertlist')[copyIndex()].windowSize]"
                                          },
                                          "scope": {
                                            "value": "[parameters('workspaceId')]"
                                          },
                                          "query": {
                                            "value": "[parameters('alertlist')[copyIndex()].query]"
                                          },
                                          "dimensions": "[if(contains(parameters('alertlist')[copyIndex()], 'dimensions'), createObject('value', parameters('alertlist')[copyIndex()].dimensions), createObject('value', null()))]",
                                          "packtag": {
                                            "value": "[parameters('packtag')]"
                                          },
                                          "Tags": {
                                            "value": "[parameters('Tags')]"
                                          },
                                          "alertType": {
                                            "value": "[parameters('alertlist')[copyIndex()].alertType]"
                                          },
                                          "metricMeasureColumn": "[if(equals(parameters('alertlist')[copyIndex()].alertType, 'Aggregated'), createObject('value', parameters('alertlist')[copyIndex()].metricMeasureColumn), createObject('value', null()))]",
                                          "operator": "[if(equals(parameters('alertlist')[copyIndex()].alertType, 'Aggregated'), createObject('value', parameters('alertlist')[copyIndex()].operator), createObject('value', null()))]",
                                          "threshold": "[if(equals(parameters('alertlist')[copyIndex()].alertType, 'Aggregated'), createObject('value', parameters('alertlist')[copyIndex()].threshold), createObject('value', null()))]"
                                        },
                                        "template": {
                                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                          "contentVersion": "1.0.0.0",
                                          "metadata": {
                                            "_generator": {
                                              "name": "bicep",
                                              "version": "0.32.4.45862",
                                              "templateHash": "10159755056440989647"
                                            }
                                          },
                                          "parameters": {
                                            "alertType": {
                                              "type": "string",
                                              "allowedValues": [
                                                "rows",
                                                "Aggregated"
                                              ]
                                            },
                                            "alertRuleName": {
                                              "type": "string"
                                            },
                                            "alertRuleDisplayName": {
                                              "type": "string"
                                            },
                                            "alertRuleDescription": {
                                              "type": "string"
                                            },
                                            "scope": {
                                              "type": "string"
                                            },
                                            "actionGroupResourceId": {
                                              "type": "string"
                                            },
                                            "alertRuleSeverity": {
                                              "type": "int"
                                            },
                                            "location": {
                                              "type": "string"
                                            },
                                            "windowSize": {
                                              "type": "string",
                                              "defaultValue": "PT15M"
                                            },
                                            "evaluationFrequency": {
                                              "type": "string",
                                              "defaultValue": "PT15M"
                                            },
                                            "autoMitigate": {
                                              "type": "bool",
                                              "defaultValue": false
                                            },
                                            "query": {
                                              "type": "string"
                                            },
                                            "packtag": {
                                              "type": "string"
                                            },
                                            "Tags": {
                                              "type": "object"
                                            },
                                            "threshold": {
                                              "type": "int",
                                              "defaultValue": 0
                                            },
                                            "metricMeasureColumn": {
                                              "type": "string",
                                              "defaultValue": ""
                                            },
                                            "dimensions": {
                                              "type": "array",
                                              "defaultValue": [
                                                {
                                                  "name": "Computer",
                                                  "operator": "Include",
                                                  "values": [
                                                    "*"
                                                  ]
                                                }
                                              ]
                                            },
                                            "operator": {
                                              "type": "string",
                                              "defaultValue": "GreaterThan",
                                              "allowedValues": [
                                                "GreaterThan",
                                                "GreaterThanOrEqual",
                                                "LessThan",
                                                "LessThanOrEqual",
                                                "Equal",
                                                "NotEqual"
                                              ]
                                            }
                                          },
                                          "resources": [
                                            {
                                              "condition": "[equals(parameters('alertType'), 'rows')]",
                                              "type": "Microsoft.Resources/deployments",
                                              "apiVersion": "2022-09-01",
                                              "name": "[parameters('alertRuleName')]",
                                              "properties": {
                                                "expressionEvaluationOptions": {
                                                  "scope": "inner"
                                                },
                                                "mode": "Incremental",
                                                "parameters": {
                                                  "alertRuleName": {
                                                    "value": "[parameters('alertRuleName')]"
                                                  },
                                                  "alertRuleDisplayName": {
                                                    "value": "[parameters('alertRuleDisplayName')]"
                                                  },
                                                  "alertRuleDescription": {
                                                    "value": "[parameters('alertRuleDescription')]"
                                                  },
                                                  "scope": {
                                                    "value": "[parameters('scope')]"
                                                  },
                                                  "dimensions": {
                                                    "value": "[parameters('dimensions')]"
                                                  },
                                                  "actionGroupResourceId": {
                                                    "value": "[parameters('actionGroupResourceId')]"
                                                  },
                                                  "alertRuleSeverity": {
                                                    "value": "[parameters('alertRuleSeverity')]"
                                                  },
                                                  "location": {
                                                    "value": "[parameters('location')]"
                                                  },
                                                  "windowSize": {
                                                    "value": "[parameters('windowSize')]"
                                                  },
                                                  "evaluationFrequency": {
                                                    "value": "[parameters('evaluationFrequency')]"
                                                  },
                                                  "autoMitigate": {
                                                    "value": "[parameters('autoMitigate')]"
                                                  },
                                                  "query": {
                                                    "value": "[parameters('query')]"
                                                  },
                                                  "Tags": {
                                                    "value": "[parameters('Tags')]"
                                                  }
                                                },
                                                "template": {
                                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                                  "contentVersion": "1.0.0.0",
                                                  "metadata": {
                                                    "_generator": {
                                                      "name": "bicep",
                                                      "version": "0.32.4.45862",
                                                      "templateHash": "16566470716356207302"
                                                    }
                                                  },
                                                  "parameters": {
                                                    "alertRuleName": {
                                                      "type": "string"
                                                    },
                                                    "alertRuleDisplayName": {
                                                      "type": "string"
                                                    },
                                                    "alertRuleDescription": {
                                                      "type": "string"
                                                    },
                                                    "scope": {
                                                      "type": "string"
                                                    },
                                                    "actionGroupResourceId": {
                                                      "type": "string"
                                                    },
                                                    "alertRuleSeverity": {
                                                      "type": "int"
                                                    },
                                                    "location": {
                                                      "type": "string"
                                                    },
                                                    "windowSize": {
                                                      "type": "string",
                                                      "defaultValue": "PT15M"
                                                    },
                                                    "evaluationFrequency": {
                                                      "type": "string",
                                                      "defaultValue": "PT15M"
                                                    },
                                                    "autoMitigate": {
                                                      "type": "bool",
                                                      "defaultValue": false
                                                    },
                                                    "query": {
                                                      "type": "string"
                                                    },
                                                    "dimensions": {
                                                      "type": "array"
                                                    },
                                                    "Tags": {
                                                      "type": "object"
                                                    }
                                                  },
                                                  "resources": [
                                                    {
                                                      "type": "Microsoft.Insights/scheduledQueryRules",
                                                      "apiVersion": "2023-03-15-preview",
                                                      "name": "[parameters('alertRuleName')]",
                                                      "location": "[parameters('location')]",
                                                      "tags": "[parameters('Tags')]",
                                                      "properties": {
                                                        "description": "[parameters('alertRuleDescription')]",
                                                        "ruleResolveConfiguration": {},
                                                        "displayName": "[parameters('alertRuleDisplayName')]",
                                                        "enabled": true,
                                                        "scopes": [
                                                          "[parameters('scope')]"
                                                        ],
                                                        "targetResourceTypes": [
                                                          "Microsoft.OperationalInsights/workspaces"
                                                        ],
                                                        "windowSize": "[parameters('windowSize')]",
                                                        "evaluationFrequency": "[parameters('evaluationFrequency')]",
                                                        "severity": "[parameters('alertRuleSeverity')]",
                                                        "criteria": {
                                                          "allOf": [
                                                            {
                                                              "query": "[parameters('query')]",
                                                              "timeAggregation": "Count",
                                                              "dimensions": "[parameters('dimensions')]",
                                                              "resourceIdColumn": "[if(empty(parameters('dimensions')), '_ResourceId', null())]",
                                                              "operator": "GreaterThan",
                                                              "threshold": 0,
                                                              "failingPeriods": {
                                                                "numberOfEvaluationPeriods": 1,
                                                                "minFailingPeriodsToAlert": 1
                                                              }
                                                            }
                                                          ]
                                                        },
                                                        "autoMitigate": "[parameters('autoMitigate')]",
                                                        "actions": {
                                                          "actionGroups": [
                                                            "[parameters('actionGroupResourceId')]"
                                                          ],
                                                          "customProperties": {}
                                                        }
                                                      }
                                                    }
                                                  ]
                                                }
                                              }
                                            },
                                            {
                                              "condition": "[equals(parameters('alertType'), 'Aggregated')]",
                                              "type": "Microsoft.Resources/deployments",
                                              "apiVersion": "2022-09-01",
                                              "name": "[parameters('alertRuleName')]",
                                              "properties": {
                                                "expressionEvaluationOptions": {
                                                  "scope": "inner"
                                                },
                                                "mode": "Incremental",
                                                "parameters": {
                                                  "alertRuleName": {
                                                    "value": "[parameters('alertRuleName')]"
                                                  },
                                                  "alertRuleDisplayName": {
                                                    "value": "[parameters('alertRuleDisplayName')]"
                                                  },
                                                  "alertRuleDescription": {
                                                    "value": "[parameters('alertRuleDescription')]"
                                                  },
                                                  "scope": {
                                                    "value": "[parameters('scope')]"
                                                  },
                                                  "dimensions": {
                                                    "value": "[parameters('dimensions')]"
                                                  },
                                                  "actionGroupResourceId": {
                                                    "value": "[parameters('actionGroupResourceId')]"
                                                  },
                                                  "alertRuleSeverity": {
                                                    "value": "[parameters('alertRuleSeverity')]"
                                                  },
                                                  "location": {
                                                    "value": "[parameters('location')]"
                                                  },
                                                  "windowSize": {
                                                    "value": "[parameters('windowSize')]"
                                                  },
                                                  "evaluationFrequency": {
                                                    "value": "[parameters('evaluationFrequency')]"
                                                  },
                                                  "autoMitigate": {
                                                    "value": "[parameters('autoMitigate')]"
                                                  },
                                                  "query": {
                                                    "value": "[parameters('query')]"
                                                  },
                                                  "Tags": {
                                                    "value": "[parameters('Tags')]"
                                                  },
                                                  "threshold": {
                                                    "value": "[parameters('threshold')]"
                                                  },
                                                  "metricMeasureColumn": {
                                                    "value": "[parameters('metricMeasureColumn')]"
                                                  },
                                                  "operator": {
                                                    "value": "[parameters('operator')]"
                                                  }
                                                },
                                                "template": {
                                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                                  "contentVersion": "1.0.0.0",
                                                  "metadata": {
                                                    "_generator": {
                                                      "name": "bicep",
                                                      "version": "0.32.4.45862",
                                                      "templateHash": "18444959286864838274"
                                                    }
                                                  },
                                                  "parameters": {
                                                    "alertRuleName": {
                                                      "type": "string"
                                                    },
                                                    "alertRuleDisplayName": {
                                                      "type": "string"
                                                    },
                                                    "alertRuleDescription": {
                                                      "type": "string"
                                                    },
                                                    "scope": {
                                                      "type": "string"
                                                    },
                                                    "actionGroupResourceId": {
                                                      "type": "string"
                                                    },
                                                    "alertRuleSeverity": {
                                                      "type": "int"
                                                    },
                                                    "location": {
                                                      "type": "string"
                                                    },
                                                    "windowSize": {
                                                      "type": "string",
                                                      "defaultValue": "PT15M"
                                                    },
                                                    "evaluationFrequency": {
                                                      "type": "string",
                                                      "defaultValue": "PT15M"
                                                    },
                                                    "autoMitigate": {
                                                      "type": "bool",
                                                      "defaultValue": false
                                                    },
                                                    "query": {
                                                      "type": "string"
                                                    },
                                                    "dimensions": {
                                                      "type": "array"
                                                    },
                                                    "threshold": {
                                                      "type": "int"
                                                    },
                                                    "metricMeasureColumn": {
                                                      "type": "string"
                                                    },
                                                    "Tags": {
                                                      "type": "object"
                                                    },
                                                    "operator": {
                                                      "type": "string",
                                                      "allowedValues": [
                                                        "GreaterThan",
                                                        "GreaterThanOrEqual",
                                                        "LessThan",
                                                        "LessThanOrEqual",
                                                        "Equal",
                                                        "NotEqual"
                                                      ]
                                                    }
                                                  },
                                                  "resources": [
                                                    {
                                                      "type": "Microsoft.Insights/scheduledQueryRules",
                                                      "apiVersion": "2023-03-15-preview",
                                                      "name": "[parameters('alertRuleName')]",
                                                      "location": "[parameters('location')]",
                                                      "tags": "[parameters('Tags')]",
                                                      "properties": {
                                                        "description": "[parameters('alertRuleDescription')]",
                                                        "ruleResolveConfiguration": {},
                                                        "displayName": "[parameters('alertRuleDisplayName')]",
                                                        "enabled": true,
                                                        "scopes": [
                                                          "[parameters('scope')]"
                                                        ],
                                                        "targetResourceTypes": [
                                                          "Microsoft.OperationalInsights/workspaces"
                                                        ],
                                                        "windowSize": "[parameters('windowSize')]",
                                                        "evaluationFrequency": "[parameters('evaluationFrequency')]",
                                                        "severity": "[parameters('alertRuleSeverity')]",
                                                        "criteria": {
                                                          "allOf": [
                                                            {
                                                              "query": "[parameters('query')]",
                                                              "timeAggregation": "Average",
                                                              "metricMeasureColumn": "[parameters('metricMeasureColumn')]",
                                                              "dimensions": "[parameters('dimensions')]",
                                                              "resourceIdColumn": "[if(empty(parameters('dimensions')), '_ResourceId', null())]",
                                                              "operator": "[parameters('operator')]",
                                                              "threshold": "[parameters('threshold')]",
                                                              "failingPeriods": {
                                                                "numberOfEvaluationPeriods": 1,
                                                                "minFailingPeriodsToAlert": 1
                                                              }
                                                            }
                                                          ]
                                                        },
                                                        "autoMitigate": "[parameters('autoMitigate')]",
                                                        "actions": {
                                                          "actionGroups": [
                                                            "[parameters('actionGroupResourceId')]"
                                                          ],
                                                          "customProperties": {}
                                                        }
                                                      }
                                                    }
                                                  ]
                                                }
                                              }
                                            }
                                          ]
                                        }
                                      }
                                    }
                                  ]
                                }
                              }
                            }
                          ]
                        }
                      }
                    }
                  ]
                }
              }
            },
            {
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2022-09-01",
              "name": "[format('IISPack-deployment-{0}-{1}', parameters('instanceName'), parameters('location'))]",
              "location": "[deployment().location]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "dceId": {
                    "value": "[parameters('dceId')]"
                  },
                  "location": {
                    "value": "[parameters('location')]"
                  },
                  "resourceGroupId": {
                    "value": "[parameters('resourceGroupId')]"
                  },
                  "solutionTag": {
                    "value": "[parameters('solutionTag')]"
                  },
                  "solutionVersion": {
                    "value": "[parameters('solutionVersion')]"
                  },
                  "subscriptionId": {
                    "value": "[parameters('subscriptionId')]"
                  },
                  "userManagedIdentityResourceId": {
                    "value": "[parameters('userManagedIdentityResourceId')]"
                  },
                  "workspaceId": {
                    "value": "[parameters('workspaceId')]"
                  },
                  "customerTags": {
                    "value": "[parameters('customerTags')]"
                  },
                  "actionGroupResourceId": {
                    "value": "[parameters('actionGroupResourceId')]"
                  },
                  "instanceName": {
                    "value": "[parameters('instanceName')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2018-05-01/subscriptionDeploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.32.4.45862",
                      "templateHash": "17534859391202854246"
                    }
                  },
                  "parameters": {
                    "location": {
                      "type": "string",
                      "metadata": {
                        "description": "location for the deployment."
                      }
                    },
                    "workspaceId": {
                      "type": "string",
                      "metadata": {
                        "description": "Full resource ID of the log analytics workspace to be used for the deployment."
                      }
                    },
                    "packtag": {
                      "type": "string",
                      "defaultValue": "IIS"
                    },
                    "solutionTag": {
                      "type": "string"
                    },
                    "solutionVersion": {
                      "type": "string"
                    },
                    "dceId": {
                      "type": "string",
                      "metadata": {
                        "description": "Full resource ID of the data collection endpoint to be used for the deployment."
                      }
                    },
                    "userManagedIdentityResourceId": {
                      "type": "string",
                      "metadata": {
                        "description": "Full resource ID of the user managed identity to be used for the deployment"
                      }
                    },
                    "subscriptionId": {
                      "type": "string"
                    },
                    "resourceGroupId": {
                      "type": "string"
                    },
                    "customerTags": {
                      "type": "object"
                    },
                    "actionGroupResourceId": {
                      "type": "string"
                    },
                    "instanceName": {
                      "type": "string"
                    }
                  },
                  "variables": {
                    "rulename": "[format('AMP-{0}-{1}', parameters('instanceName'), parameters('packtag'))]",
                    "tempTags": {
                      "[format('{0}', parameters('solutionTag'))]": "[parameters('packtag')]",
                      "MonitoringPackType": "IaaS",
                      "solutionVersion": "[parameters('solutionVersion')]"
                    },
                    "Tags": "[if(equals(parameters('customerTags'), createObject()), variables('tempTags'), union(variables('tempTags'), parameters('customerTags').All))]",
                    "workspaceFriendlyName": "[split(parameters('workspaceId'), '/')[8]]",
                    "ruleshortname": "[format('AMP-{0}-{1}', parameters('instanceName'), parameters('packtag'))]",
                    "resourceGroupName": "[split(parameters('resourceGroupId'), '/')[4]]",
                    "kind": "Windows",
                    "xPathQueries": [
                      "Application!*[System[Provider[@Name='Microsoft-Windows-IIS-W3SVC-WP'] and (EventID=2221)]]",
                      "System!*[System[Provider[@Name='Microsoft-Windows-WAS'] and (EventID=5152)]]",
                      "System!*[System[Provider[@Name='Microsoft-Windows-WAS'] and (EventID=5010 or EventID=5011 or EventID=5012 or EventID=5013)]]",
                      "System!*[System[Provider[@Name='Microsoft-Windows-WAS'] and (EventID=5009)]]",
                      "Application!*[System[Provider[@Name='Active Server Pages'] and (EventID=500 or EventID=499 or EventID=23 or EventID=22 or EventID=21 or EventID=20 or EventID=19 or EventID=18 or EventID=17 or EventID=16 or EventID=9 or EventID=8 or EventID=7 or EventID=6 or EventID=5)]]",
                      "System!*[System[Provider[@Name='Microsoft-Windows-IIS-W3SVC'] and (EventID=1037)]]",
                      "Application!*[System[Provider[@Name='Microsoft-Windows-IIS-W3SVC-WP'] and (EventID=2208)]]",
                      "Application!*[System[Provider[@Name='Microsoft-Windows-IIS-W3SVC-WP'] and (EventID=2206)]]",
                      "Application!*[System[Provider[@Name='Microsoft-Windows-IIS-W3SVC-WP'] and (EventID=2201)]]",
                      "Application!*[System[Provider[@Name='Microsoft-Windows-IIS-W3SVC-WP'] and (EventID=2203)]]",
                      "Application!*[System[Provider[@Name='Microsoft-Windows-IIS-W3SVC-WP'] and (EventID=2204)]]",
                      "Application!*[System[Provider[@Name='Microsoft-Windows-IIS-W3SVC-WP'] and (EventID=2274 or EventID=2268 or EventID=2220 or EventID=2219 or EventID=2214)]]",
                      "System!*[System[Provider[@Name='Microsoft-Windows-WAS'] and (EventID=5088 or EventID=5061 or EventID=5060)]]",
                      "Application!*[System[Provider[@Name='Microsoft-Windows-IIS-W3SVC-WP'] and (EventID=2296)]]",
                      "Application!*[System[Provider[@Name='Microsoft-Windows-IIS-W3SVC-WP'] and (EventID=2295)]]",
                      "Application!*[System[Provider[@Name='Microsoft-Windows-IIS-W3SVC-WP'] and (EventID=2293)]]",
                      "System!*[System[Provider[@Name='Microsoft-Windows-IIS-W3SVC'] and (EventID=1133)]]",
                      "Application!*[System[Provider[@Name='Microsoft-Windows-IIS-W3SVC-WP'] and (EventID=2261)]]",
                      "System!*[System[Provider[@Name='Microsoft-Windows-WAS'] and (EventID=5036)]]",
                      "Application!*[System[Provider[@Name='Microsoft-Windows-IIS-W3SVC-WP'] and (EventID=2264)]]",
                      "Application!*[System[Provider[@Name='Microsoft-Windows-IIS-W3SVC-WP'] and (EventID=2298)]]",
                      "Application!*[System[Provider[@Name='Microsoft-Windows-IIS-W3SVC-WP'] and (EventID=2218)]]",
                      "Application!*[System[Provider[@Name='Microsoft-Windows-IIS-W3SVC-WP'] and (EventID=2258)]]",
                      "Application!*[System[Provider[@Name='Microsoft-Windows-IIS-W3SVC-WP'] and (EventID=2227)]]",
                      "Application!*[System[Provider[@Name='Microsoft-Windows-IIS-W3SVC-WP'] and (EventID=2233)]]",
                      "Application!*[System[Provider[@Name='Microsoft-Windows-IIS-W3SVC-WP'] and (EventID=2226 or EventID=2230 or EventID=2231 or EventID=2232)]]",
                      "System!*[System[Provider[@Name='Microsoft-Windows-WAS'] and (EventID=5174 or EventID=5179 or EventID=5180)]]"
                    ],
                    "performanceCounters": [
                      "\\Web Service(_Total)\\Bytes Received/sec",
                      "\\Web Service(_Total)\\Bytes Sent/sec",
                      "\\Web Service(_Total)\\Bytes Total/sec",
                      "\\Web Service(_Total)\\Connection Attempts/sec",
                      "\\Web Service(_Total)\\Current Connections",
                      "\\Web Service(_Total)\\Total Method Requests/sec",
                      "\\Microsoft FTP Service(_Total)\\Bytes Total/sec",
                      "\\Microsoft FTP Service(_Total)\\Current Connections",
                      "\\SMTP Server(_Total)\\Bytes Received/sec",
                      "\\SMTP Server(_Total)\\Bytes Sent/sec",
                      "\\SMTP Server(_Total)\\Bytes Total/sec",
                      "\\SMTP Server(_Total)\\Inbound Connections Current",
                      "\\SMTP Server(_Total)\\Message Bytes Received/sec",
                      "\\SMTP Server(_Total)\\Message Bytes Sent/sec",
                      "\\SMTP Server(_Total)\\Messages Delivered/sec",
                      "\\SMTP Server(_Total)\\Messages Received/sec",
                      "\\SMTP Server(_Total)\\Messages Sent/sec",
                      "\\SMTP Server(_Total)\\Outbound Connections Current",
                      "\\SMTP Server(_Total)\\Total Messages Submitted",
                      "\\SMTP Server(SMTP 1)\\Bytes Received/sec",
                      "\\SMTP Server(SMTP 1)\\Bytes Sent/sec",
                      "\\SMTP Server(SMTP 1)\\Bytes Total/sec",
                      "\\SMTP Server(SMTP 1)\\Inbound Connections Current",
                      "\\SMTP Server(SMTP 1)\\Message Bytes Received/sec",
                      "\\SMTP Server(SMTP 1)\\Message Bytes Sent/sec",
                      "\\SMTP Server(SMTP 1)\\Messages Delivered/sec",
                      "\\SMTP Server(SMTP 1)\\Messages Received/sec",
                      "\\SMTP Server(SMTP 1)\\Messages Sent/sec",
                      "\\SMTP Server(SMTP 1)\\Outbound Connections Current",
                      "\\SMTP Server(SMTP 1)\\Total Messages Submitted"
                    ]
                  },
                  "resources": [
                    {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2022-09-01",
                      "name": "[format('Alerts-{0}', parameters('packtag'))]",
                      "subscriptionId": "[parameters('subscriptionId')]",
                      "resourceGroup": "[variables('resourceGroupName')]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "location": {
                            "value": "[parameters('location')]"
                          },
                          "workspaceId": {
                            "value": "[parameters('workspaceId')]"
                          },
                          "AGId": {
                            "value": "[parameters('actionGroupResourceId')]"
                          },
                          "packtag": {
                            "value": "[parameters('packtag')]"
                          },
                          "Tags": {
                            "value": "[variables('Tags')]"
                          },
                          "instanceName": {
                            "value": "[parameters('instanceName')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.32.4.45862",
                              "templateHash": "9461356001780640398"
                            }
                          },
                          "parameters": {
                            "location": {
                              "type": "string"
                            },
                            "workspaceId": {
                              "type": "string"
                            },
                            "AGId": {
                              "type": "string"
                            },
                            "packtag": {
                              "type": "string"
                            },
                            "Tags": {
                              "type": "object"
                            },
                            "instanceName": {
                              "type": "string"
                            }
                          },
                          "variables": {
                            "moduleprefix": "[format('AMP-{0}-{1}', parameters('instanceName'), parameters('packtag'))]",
                            "alertlist": [
                              {
                                "alertRuleDescription": "A server side include file has included itself or the maximum depth of server side includes has been exceeded",
                                "alertRuleDisplayName": "A server side include file has included itself or the maximum depth of server side includes has been exceeded",
                                "alertRuleName": "AlertRule-IIS-2012-1",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (2221) and EventLog == 'Application' and Source == 'Microsoft-Windows-IIS-W3SVC-WP'"
                              },
                              {
                                "alertRuleDescription": "Application Pool has an IdleTimeout equal to or greater than the PeriodicRestart time",
                                "alertRuleDisplayName": "Application Pool has an IdleTimeout equal to or greater than the PeriodicRestart time",
                                "alertRuleName": "AlertRule-IIS-2012-2",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (5152) and EventLog == 'System' and Source == 'Microsoft-Windows-WAS'"
                              },
                              {
                                "alertRuleDescription": "Application Pool worker process is unresponsive",
                                "alertRuleDisplayName": "Application Pool worker process is unresponsive",
                                "alertRuleName": "AlertRule-IIS-2012-3",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (5010,5011,5012,5013) and EventLog == 'System' and Source == 'Microsoft-Windows-WAS'"
                              },
                              {
                                "alertRuleDescription": "Application Pool worker process terminated unexpectedly",
                                "alertRuleDisplayName": "Application Pool worker process terminated unexpectedly",
                                "alertRuleName": "AlertRule-IIS-2012-4",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (5009) and EventLog == 'System' and Source == 'Microsoft-Windows-WAS'"
                              },
                              {
                                "alertRuleDescription": "ASP application error occurred",
                                "alertRuleDisplayName": "ASP application error occurred",
                                "alertRuleName": "AlertRule-IIS-2012-5",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (500,499,23,22,21,20,19,18,17,16,9,8,7,6,5) and EventLog == 'Application' and Source == 'Active Server Pages'"
                              },
                              {
                                "alertRuleDescription": "HTTP control channel for the WWW Service did not open",
                                "alertRuleDisplayName": "HTTP control channel for the WWW Service did not open",
                                "alertRuleName": "AlertRule-IIS-2012-6",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (1037) and EventLog == 'System' and Source == 'Microsoft-Windows-IIS-W3SVC'"
                              },
                              {
                                "alertRuleDescription": "HTTP Server could not create a client connection object for user",
                                "alertRuleDisplayName": "HTTP Server could not create a client connection object for user",
                                "alertRuleName": "AlertRule-IIS-2012-7",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (2208) and EventLog == 'Application' and Source == 'Microsoft-Windows-IIS-W3SVC-WP'"
                              },
                              {
                                "alertRuleDescription": "HTTP Server could not create the main connection socket",
                                "alertRuleDisplayName": "HTTP Server could not create the main connection socket",
                                "alertRuleName": "AlertRule-IIS-2012-8",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (2206) and EventLog == 'Application' and Source == 'Microsoft-Windows-IIS-W3SVC-WP'"
                              },
                              {
                                "alertRuleDescription": "HTTP Server could not initialize its security",
                                "alertRuleDisplayName": "HTTP Server could not initialize its security",
                                "alertRuleName": "AlertRule-IIS-2012-9",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (2201) and EventLog == 'Application' and Source == 'Microsoft-Windows-IIS-W3SVC-WP'"
                              },
                              {
                                "alertRuleDescription": "HTTP Server could not initialize the socket library",
                                "alertRuleDisplayName": "HTTP Server could not initialize the socket library",
                                "alertRuleName": "AlertRule-IIS-2012-10",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (2203) and EventLog == 'Application' and Source == 'Microsoft-Windows-IIS-W3SVC-WP'"
                              },
                              {
                                "alertRuleDescription": "HTTP Server was unable to initialize due to a shortage of available memory",
                                "alertRuleDisplayName": "HTTP Server was unable to initialize due to a shortage of available memory",
                                "alertRuleName": "AlertRule-IIS-2012-11",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (2204) and EventLog == 'Application' and Source == 'Microsoft-Windows-IIS-W3SVC-WP'"
                              },
                              {
                                "alertRuleDescription": "ISAPI application error detected",
                                "alertRuleDisplayName": "ISAPI application error detected",
                                "alertRuleName": "AlertRule-IIS-2012-12",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (2274,2268,2220,2219,2214) and EventLog == 'Application' and Source == 'Microsoft-Windows-IIS-W3SVC-WP'"
                              },
                              {
                                "alertRuleDescription": "Job object associated with the application pool encountered an error",
                                "alertRuleDisplayName": "Job object associated with the application pool encountered an error",
                                "alertRuleName": "AlertRule-IIS-2012-13",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (5088,5061,5060) and EventLog == 'System' and Source == 'Microsoft-Windows-WAS'"
                              },
                              {
                                "alertRuleDescription": "Module has an invalid precondition",
                                "alertRuleDisplayName": "Module has an invalid precondition",
                                "alertRuleName": "AlertRule-IIS-2012-14",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (2296) and EventLog == 'Application' and Source == 'Microsoft-Windows-IIS-W3SVC-WP'"
                              },
                              {
                                "alertRuleDescription": "Module registration error detected (failed to find RegisterModule entrypoint)",
                                "alertRuleDisplayName": "Module registration error detected (failed to find RegisterModule entrypoint)",
                                "alertRuleName": "AlertRule-IIS-2012-15",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (2295) and EventLog == 'Application' and Source == 'Microsoft-Windows-IIS-W3SVC-WP'"
                              },
                              {
                                "alertRuleDescription": "Module registration error detected (module returned an error during registration)",
                                "alertRuleDisplayName": "Module registration error detected (module returned an error during registration)",
                                "alertRuleName": "AlertRule-IIS-2012-16",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (2293) and EventLog == 'Application' and Source == 'Microsoft-Windows-IIS-W3SVC-WP'"
                              },
                              {
                                "alertRuleDescription": "Only one type of logging can be enabled at a time",
                                "alertRuleDisplayName": "Only one type of logging can be enabled at a time",
                                "alertRuleName": "AlertRule-IIS-2012-17",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (1133) and EventLog == 'System' and Source == 'Microsoft-Windows-IIS-W3SVC'"
                              },
                              {
                                "alertRuleDescription": "SF_NOTIFY_READ_RAW_DATA filter notification is not supported in IIS 8",
                                "alertRuleDisplayName": "SF_NOTIFY_READ_RAW_DATA filter notification is not supported in IIS 8",
                                "alertRuleName": "AlertRule-IIS-2012-18",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (2261) and EventLog == 'Application' and Source == 'Microsoft-Windows-IIS-W3SVC-WP'"
                              },
                              {
                                "alertRuleDescription": "The configuration manager for WAS did not initialize",
                                "alertRuleDisplayName": "The configuration manager for WAS did not initialize",
                                "alertRuleName": "AlertRule-IIS-2012-19",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (5036) and EventLog == 'System' and Source == 'Microsoft-Windows-WAS'"
                              },
                              {
                                "alertRuleDescription": "The directory specified for caching compressed content is invalid",
                                "alertRuleDisplayName": "The directory specified for caching compressed content is invalid",
                                "alertRuleName": "AlertRule-IIS-2012-20",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (2264) and EventLog == 'Application' and Source == 'Microsoft-Windows-IIS-W3SVC-WP'"
                              },
                              {
                                "alertRuleDescription": "The Global Modules list is empty",
                                "alertRuleDisplayName": "The Global Modules list is empty",
                                "alertRuleName": "AlertRule-IIS-2012-21",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (2298) and EventLog == 'Application' and Source == 'Microsoft-Windows-IIS-W3SVC-WP'"
                              },
                              {
                                "alertRuleDescription": "The HTTP server encountered an error processing the server side include file",
                                "alertRuleDisplayName": "The HTTP server encountered an error processing the server side include file",
                                "alertRuleName": "AlertRule-IIS-2012-22",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (2218) and EventLog == 'Application' and Source == 'Microsoft-Windows-IIS-W3SVC-WP'"
                              },
                              {
                                "alertRuleDescription": "The server failed to close client connections to URLs during shutdown",
                                "alertRuleDisplayName": "The server failed to close client connections to URLs during shutdown",
                                "alertRuleName": "AlertRule-IIS-2012-23",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (2258) and EventLog == 'Application' and Source == 'Microsoft-Windows-IIS-W3SVC-WP'"
                              },
                              {
                                "alertRuleDescription": "The server was unable to acquire a license for a SSL connection",
                                "alertRuleDisplayName": "The server was unable to acquire a license for a SSL connection",
                                "alertRuleName": "AlertRule-IIS-2012-24",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (2227) and EventLog == 'Application' and Source == 'Microsoft-Windows-IIS-W3SVC-WP'"
                              },
                              {
                                "alertRuleDescription": "The server was unable to allocate a buffer to read a file",
                                "alertRuleDisplayName": "The server was unable to allocate a buffer to read a file",
                                "alertRuleName": "AlertRule-IIS-2012-25",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (2233) and EventLog == 'Application' and Source == 'Microsoft-Windows-IIS-W3SVC-WP'"
                              },
                              {
                                "alertRuleDescription": "The server was unable to read a file",
                                "alertRuleDisplayName": "The server was unable to read a file",
                                "alertRuleName": "AlertRule-IIS-2012-26",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (2226,2230,2231,2232) and EventLog == 'Application' and Source == 'Microsoft-Windows-IIS-W3SVC-WP'"
                              },
                              {
                                "alertRuleDescription": "WAS detected invalid configuration data",
                                "alertRuleDisplayName": "WAS detected invalid configuration data",
                                "alertRuleName": "AlertRule-IIS-2012-27",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (5174,5179,5180) and EventLog == 'System' and Source == 'Microsoft-Windows-WAS'"
                              }
                            ]
                          },
                          "resources": [
                            {
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "[format('{0}-Alerts', variables('moduleprefix'))]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "alertlist": {
                                    "value": "[variables('alertlist')]"
                                  },
                                  "AGId": {
                                    "value": "[parameters('AGId')]"
                                  },
                                  "location": {
                                    "value": "[parameters('location')]"
                                  },
                                  "moduleprefix": {
                                    "value": "[variables('moduleprefix')]"
                                  },
                                  "packtag": {
                                    "value": "[parameters('packtag')]"
                                  },
                                  "Tags": {
                                    "value": "[parameters('Tags')]"
                                  },
                                  "workspaceId": {
                                    "value": "[parameters('workspaceId')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.32.4.45862",
                                      "templateHash": "17858688129795365440"
                                    }
                                  },
                                  "parameters": {
                                    "alertlist": {
                                      "type": "array"
                                    },
                                    "location": {
                                      "type": "string"
                                    },
                                    "workspaceId": {
                                      "type": "string"
                                    },
                                    "AGId": {
                                      "type": "string"
                                    },
                                    "packtag": {
                                      "type": "string"
                                    },
                                    "Tags": {
                                      "type": "object"
                                    },
                                    "moduleprefix": {
                                      "type": "string"
                                    }
                                  },
                                  "resources": [
                                    {
                                      "copy": {
                                        "name": "Alerts",
                                        "count": "[length(parameters('alertlist'))]"
                                      },
                                      "type": "Microsoft.Resources/deployments",
                                      "apiVersion": "2022-09-01",
                                      "name": "[format('{0}-Alert-{1}', parameters('packtag'), copyIndex())]",
                                      "properties": {
                                        "expressionEvaluationOptions": {
                                          "scope": "inner"
                                        },
                                        "mode": "Incremental",
                                        "parameters": {
                                          "location": {
                                            "value": "[parameters('location')]"
                                          },
                                          "actionGroupResourceId": {
                                            "value": "[parameters('AGId')]"
                                          },
                                          "alertRuleDescription": {
                                            "value": "[parameters('alertlist')[copyIndex()].alertRuleDescription]"
                                          },
                                          "alertRuleDisplayName": {
                                            "value": "[format('{0}-{1}', parameters('moduleprefix'), parameters('alertlist')[copyIndex()].alertRuleDisplayName)]"
                                          },
                                          "alertRuleName": {
                                            "value": "[format('{0}-{1}', parameters('moduleprefix'), parameters('alertlist')[copyIndex()].alertRuleName)]"
                                          },
                                          "alertRuleSeverity": {
                                            "value": "[parameters('alertlist')[copyIndex()].alertRuleSeverity]"
                                          },
                                          "autoMitigate": {
                                            "value": "[parameters('alertlist')[copyIndex()].autoMitigate]"
                                          },
                                          "evaluationFrequency": {
                                            "value": "[parameters('alertlist')[copyIndex()].evaluationFrequency]"
                                          },
                                          "windowSize": {
                                            "value": "[parameters('alertlist')[copyIndex()].windowSize]"
                                          },
                                          "scope": {
                                            "value": "[parameters('workspaceId')]"
                                          },
                                          "query": {
                                            "value": "[parameters('alertlist')[copyIndex()].query]"
                                          },
                                          "dimensions": "[if(contains(parameters('alertlist')[copyIndex()], 'dimensions'), createObject('value', parameters('alertlist')[copyIndex()].dimensions), createObject('value', null()))]",
                                          "packtag": {
                                            "value": "[parameters('packtag')]"
                                          },
                                          "Tags": {
                                            "value": "[parameters('Tags')]"
                                          },
                                          "alertType": {
                                            "value": "[parameters('alertlist')[copyIndex()].alertType]"
                                          },
                                          "metricMeasureColumn": "[if(equals(parameters('alertlist')[copyIndex()].alertType, 'Aggregated'), createObject('value', parameters('alertlist')[copyIndex()].metricMeasureColumn), createObject('value', null()))]",
                                          "operator": "[if(equals(parameters('alertlist')[copyIndex()].alertType, 'Aggregated'), createObject('value', parameters('alertlist')[copyIndex()].operator), createObject('value', null()))]",
                                          "threshold": "[if(equals(parameters('alertlist')[copyIndex()].alertType, 'Aggregated'), createObject('value', parameters('alertlist')[copyIndex()].threshold), createObject('value', null()))]"
                                        },
                                        "template": {
                                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                          "contentVersion": "1.0.0.0",
                                          "metadata": {
                                            "_generator": {
                                              "name": "bicep",
                                              "version": "0.32.4.45862",
                                              "templateHash": "10159755056440989647"
                                            }
                                          },
                                          "parameters": {
                                            "alertType": {
                                              "type": "string",
                                              "allowedValues": [
                                                "rows",
                                                "Aggregated"
                                              ]
                                            },
                                            "alertRuleName": {
                                              "type": "string"
                                            },
                                            "alertRuleDisplayName": {
                                              "type": "string"
                                            },
                                            "alertRuleDescription": {
                                              "type": "string"
                                            },
                                            "scope": {
                                              "type": "string"
                                            },
                                            "actionGroupResourceId": {
                                              "type": "string"
                                            },
                                            "alertRuleSeverity": {
                                              "type": "int"
                                            },
                                            "location": {
                                              "type": "string"
                                            },
                                            "windowSize": {
                                              "type": "string",
                                              "defaultValue": "PT15M"
                                            },
                                            "evaluationFrequency": {
                                              "type": "string",
                                              "defaultValue": "PT15M"
                                            },
                                            "autoMitigate": {
                                              "type": "bool",
                                              "defaultValue": false
                                            },
                                            "query": {
                                              "type": "string"
                                            },
                                            "packtag": {
                                              "type": "string"
                                            },
                                            "Tags": {
                                              "type": "object"
                                            },
                                            "threshold": {
                                              "type": "int",
                                              "defaultValue": 0
                                            },
                                            "metricMeasureColumn": {
                                              "type": "string",
                                              "defaultValue": ""
                                            },
                                            "dimensions": {
                                              "type": "array",
                                              "defaultValue": [
                                                {
                                                  "name": "Computer",
                                                  "operator": "Include",
                                                  "values": [
                                                    "*"
                                                  ]
                                                }
                                              ]
                                            },
                                            "operator": {
                                              "type": "string",
                                              "defaultValue": "GreaterThan",
                                              "allowedValues": [
                                                "GreaterThan",
                                                "GreaterThanOrEqual",
                                                "LessThan",
                                                "LessThanOrEqual",
                                                "Equal",
                                                "NotEqual"
                                              ]
                                            }
                                          },
                                          "resources": [
                                            {
                                              "condition": "[equals(parameters('alertType'), 'rows')]",
                                              "type": "Microsoft.Resources/deployments",
                                              "apiVersion": "2022-09-01",
                                              "name": "[parameters('alertRuleName')]",
                                              "properties": {
                                                "expressionEvaluationOptions": {
                                                  "scope": "inner"
                                                },
                                                "mode": "Incremental",
                                                "parameters": {
                                                  "alertRuleName": {
                                                    "value": "[parameters('alertRuleName')]"
                                                  },
                                                  "alertRuleDisplayName": {
                                                    "value": "[parameters('alertRuleDisplayName')]"
                                                  },
                                                  "alertRuleDescription": {
                                                    "value": "[parameters('alertRuleDescription')]"
                                                  },
                                                  "scope": {
                                                    "value": "[parameters('scope')]"
                                                  },
                                                  "dimensions": {
                                                    "value": "[parameters('dimensions')]"
                                                  },
                                                  "actionGroupResourceId": {
                                                    "value": "[parameters('actionGroupResourceId')]"
                                                  },
                                                  "alertRuleSeverity": {
                                                    "value": "[parameters('alertRuleSeverity')]"
                                                  },
                                                  "location": {
                                                    "value": "[parameters('location')]"
                                                  },
                                                  "windowSize": {
                                                    "value": "[parameters('windowSize')]"
                                                  },
                                                  "evaluationFrequency": {
                                                    "value": "[parameters('evaluationFrequency')]"
                                                  },
                                                  "autoMitigate": {
                                                    "value": "[parameters('autoMitigate')]"
                                                  },
                                                  "query": {
                                                    "value": "[parameters('query')]"
                                                  },
                                                  "Tags": {
                                                    "value": "[parameters('Tags')]"
                                                  }
                                                },
                                                "template": {
                                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                                  "contentVersion": "1.0.0.0",
                                                  "metadata": {
                                                    "_generator": {
                                                      "name": "bicep",
                                                      "version": "0.32.4.45862",
                                                      "templateHash": "16566470716356207302"
                                                    }
                                                  },
                                                  "parameters": {
                                                    "alertRuleName": {
                                                      "type": "string"
                                                    },
                                                    "alertRuleDisplayName": {
                                                      "type": "string"
                                                    },
                                                    "alertRuleDescription": {
                                                      "type": "string"
                                                    },
                                                    "scope": {
                                                      "type": "string"
                                                    },
                                                    "actionGroupResourceId": {
                                                      "type": "string"
                                                    },
                                                    "alertRuleSeverity": {
                                                      "type": "int"
                                                    },
                                                    "location": {
                                                      "type": "string"
                                                    },
                                                    "windowSize": {
                                                      "type": "string",
                                                      "defaultValue": "PT15M"
                                                    },
                                                    "evaluationFrequency": {
                                                      "type": "string",
                                                      "defaultValue": "PT15M"
                                                    },
                                                    "autoMitigate": {
                                                      "type": "bool",
                                                      "defaultValue": false
                                                    },
                                                    "query": {
                                                      "type": "string"
                                                    },
                                                    "dimensions": {
                                                      "type": "array"
                                                    },
                                                    "Tags": {
                                                      "type": "object"
                                                    }
                                                  },
                                                  "resources": [
                                                    {
                                                      "type": "Microsoft.Insights/scheduledQueryRules",
                                                      "apiVersion": "2023-03-15-preview",
                                                      "name": "[parameters('alertRuleName')]",
                                                      "location": "[parameters('location')]",
                                                      "tags": "[parameters('Tags')]",
                                                      "properties": {
                                                        "description": "[parameters('alertRuleDescription')]",
                                                        "ruleResolveConfiguration": {},
                                                        "displayName": "[parameters('alertRuleDisplayName')]",
                                                        "enabled": true,
                                                        "scopes": [
                                                          "[parameters('scope')]"
                                                        ],
                                                        "targetResourceTypes": [
                                                          "Microsoft.OperationalInsights/workspaces"
                                                        ],
                                                        "windowSize": "[parameters('windowSize')]",
                                                        "evaluationFrequency": "[parameters('evaluationFrequency')]",
                                                        "severity": "[parameters('alertRuleSeverity')]",
                                                        "criteria": {
                                                          "allOf": [
                                                            {
                                                              "query": "[parameters('query')]",
                                                              "timeAggregation": "Count",
                                                              "dimensions": "[parameters('dimensions')]",
                                                              "resourceIdColumn": "[if(empty(parameters('dimensions')), '_ResourceId', null())]",
                                                              "operator": "GreaterThan",
                                                              "threshold": 0,
                                                              "failingPeriods": {
                                                                "numberOfEvaluationPeriods": 1,
                                                                "minFailingPeriodsToAlert": 1
                                                              }
                                                            }
                                                          ]
                                                        },
                                                        "autoMitigate": "[parameters('autoMitigate')]",
                                                        "actions": {
                                                          "actionGroups": [
                                                            "[parameters('actionGroupResourceId')]"
                                                          ],
                                                          "customProperties": {}
                                                        }
                                                      }
                                                    }
                                                  ]
                                                }
                                              }
                                            },
                                            {
                                              "condition": "[equals(parameters('alertType'), 'Aggregated')]",
                                              "type": "Microsoft.Resources/deployments",
                                              "apiVersion": "2022-09-01",
                                              "name": "[parameters('alertRuleName')]",
                                              "properties": {
                                                "expressionEvaluationOptions": {
                                                  "scope": "inner"
                                                },
                                                "mode": "Incremental",
                                                "parameters": {
                                                  "alertRuleName": {
                                                    "value": "[parameters('alertRuleName')]"
                                                  },
                                                  "alertRuleDisplayName": {
                                                    "value": "[parameters('alertRuleDisplayName')]"
                                                  },
                                                  "alertRuleDescription": {
                                                    "value": "[parameters('alertRuleDescription')]"
                                                  },
                                                  "scope": {
                                                    "value": "[parameters('scope')]"
                                                  },
                                                  "dimensions": {
                                                    "value": "[parameters('dimensions')]"
                                                  },
                                                  "actionGroupResourceId": {
                                                    "value": "[parameters('actionGroupResourceId')]"
                                                  },
                                                  "alertRuleSeverity": {
                                                    "value": "[parameters('alertRuleSeverity')]"
                                                  },
                                                  "location": {
                                                    "value": "[parameters('location')]"
                                                  },
                                                  "windowSize": {
                                                    "value": "[parameters('windowSize')]"
                                                  },
                                                  "evaluationFrequency": {
                                                    "value": "[parameters('evaluationFrequency')]"
                                                  },
                                                  "autoMitigate": {
                                                    "value": "[parameters('autoMitigate')]"
                                                  },
                                                  "query": {
                                                    "value": "[parameters('query')]"
                                                  },
                                                  "Tags": {
                                                    "value": "[parameters('Tags')]"
                                                  },
                                                  "threshold": {
                                                    "value": "[parameters('threshold')]"
                                                  },
                                                  "metricMeasureColumn": {
                                                    "value": "[parameters('metricMeasureColumn')]"
                                                  },
                                                  "operator": {
                                                    "value": "[parameters('operator')]"
                                                  }
                                                },
                                                "template": {
                                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                                  "contentVersion": "1.0.0.0",
                                                  "metadata": {
                                                    "_generator": {
                                                      "name": "bicep",
                                                      "version": "0.32.4.45862",
                                                      "templateHash": "18444959286864838274"
                                                    }
                                                  },
                                                  "parameters": {
                                                    "alertRuleName": {
                                                      "type": "string"
                                                    },
                                                    "alertRuleDisplayName": {
                                                      "type": "string"
                                                    },
                                                    "alertRuleDescription": {
                                                      "type": "string"
                                                    },
                                                    "scope": {
                                                      "type": "string"
                                                    },
                                                    "actionGroupResourceId": {
                                                      "type": "string"
                                                    },
                                                    "alertRuleSeverity": {
                                                      "type": "int"
                                                    },
                                                    "location": {
                                                      "type": "string"
                                                    },
                                                    "windowSize": {
                                                      "type": "string",
                                                      "defaultValue": "PT15M"
                                                    },
                                                    "evaluationFrequency": {
                                                      "type": "string",
                                                      "defaultValue": "PT15M"
                                                    },
                                                    "autoMitigate": {
                                                      "type": "bool",
                                                      "defaultValue": false
                                                    },
                                                    "query": {
                                                      "type": "string"
                                                    },
                                                    "dimensions": {
                                                      "type": "array"
                                                    },
                                                    "threshold": {
                                                      "type": "int"
                                                    },
                                                    "metricMeasureColumn": {
                                                      "type": "string"
                                                    },
                                                    "Tags": {
                                                      "type": "object"
                                                    },
                                                    "operator": {
                                                      "type": "string",
                                                      "allowedValues": [
                                                        "GreaterThan",
                                                        "GreaterThanOrEqual",
                                                        "LessThan",
                                                        "LessThanOrEqual",
                                                        "Equal",
                                                        "NotEqual"
                                                      ]
                                                    }
                                                  },
                                                  "resources": [
                                                    {
                                                      "type": "Microsoft.Insights/scheduledQueryRules",
                                                      "apiVersion": "2023-03-15-preview",
                                                      "name": "[parameters('alertRuleName')]",
                                                      "location": "[parameters('location')]",
                                                      "tags": "[parameters('Tags')]",
                                                      "properties": {
                                                        "description": "[parameters('alertRuleDescription')]",
                                                        "ruleResolveConfiguration": {},
                                                        "displayName": "[parameters('alertRuleDisplayName')]",
                                                        "enabled": true,
                                                        "scopes": [
                                                          "[parameters('scope')]"
                                                        ],
                                                        "targetResourceTypes": [
                                                          "Microsoft.OperationalInsights/workspaces"
                                                        ],
                                                        "windowSize": "[parameters('windowSize')]",
                                                        "evaluationFrequency": "[parameters('evaluationFrequency')]",
                                                        "severity": "[parameters('alertRuleSeverity')]",
                                                        "criteria": {
                                                          "allOf": [
                                                            {
                                                              "query": "[parameters('query')]",
                                                              "timeAggregation": "Average",
                                                              "metricMeasureColumn": "[parameters('metricMeasureColumn')]",
                                                              "dimensions": "[parameters('dimensions')]",
                                                              "resourceIdColumn": "[if(empty(parameters('dimensions')), '_ResourceId', null())]",
                                                              "operator": "[parameters('operator')]",
                                                              "threshold": "[parameters('threshold')]",
                                                              "failingPeriods": {
                                                                "numberOfEvaluationPeriods": 1,
                                                                "minFailingPeriodsToAlert": 1
                                                              }
                                                            }
                                                          ]
                                                        },
                                                        "autoMitigate": "[parameters('autoMitigate')]",
                                                        "actions": {
                                                          "actionGroups": [
                                                            "[parameters('actionGroupResourceId')]"
                                                          ],
                                                          "customProperties": {}
                                                        }
                                                      }
                                                    }
                                                  ]
                                                }
                                              }
                                            }
                                          ]
                                        }
                                      }
                                    }
                                  ]
                                }
                              }
                            }
                          ]
                        }
                      }
                    },
                    {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2022-09-01",
                      "name": "[format('dcrPerformance-{0}', parameters('packtag'))]",
                      "subscriptionId": "[parameters('subscriptionId')]",
                      "resourceGroup": "[variables('resourceGroupName')]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "location": {
                            "value": "[parameters('location')]"
                          },
                          "rulename": {
                            "value": "[variables('rulename')]"
                          },
                          "workspaceId": {
                            "value": "[parameters('workspaceId')]"
                          },
                          "wsfriendlyname": {
                            "value": "[variables('workspaceFriendlyName')]"
                          },
                          "kind": {
                            "value": "[variables('kind')]"
                          },
                          "xPathQueries": {
                            "value": "[variables('xPathQueries')]"
                          },
                          "counterSpecifiers": {
                            "value": "[variables('performanceCounters')]"
                          },
                          "Tags": {
                            "value": "[variables('Tags')]"
                          },
                          "dceId": {
                            "value": "[parameters('dceId')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.32.4.45862",
                              "templateHash": "15691414683408659274"
                            }
                          },
                          "parameters": {
                            "location": {
                              "type": "string"
                            },
                            "rulename": {
                              "type": "string"
                            },
                            "workspaceId": {
                              "type": "string"
                            },
                            "kind": {
                              "type": "string",
                              "defaultValue": "Windows"
                            },
                            "wsfriendlyname": {
                              "type": "string",
                              "defaultValue": "TBD"
                            },
                            "xPathQueries": {
                              "type": "array",
                              "defaultValue": []
                            },
                            "counterSpecifiers": {
                              "type": "array",
                              "defaultValue": []
                            },
                            "samplingFrequencyInSeconds": {
                              "type": "int",
                              "defaultValue": 300
                            },
                            "Tags": {
                              "type": "object"
                            },
                            "dceId": {
                              "type": "string"
                            }
                          },
                          "resources": [
                            {
                              "type": "Microsoft.Insights/dataCollectionRules",
                              "apiVersion": "2022-06-01",
                              "name": "[parameters('rulename')]",
                              "location": "[parameters('location')]",
                              "tags": "[parameters('Tags')]",
                              "kind": "[parameters('kind')]",
                              "properties": {
                                "dataCollectionEndpointId": "[parameters('dceId')]",
                                "description": "[format('Data Collection Rule for {0}}} - {1}}}', parameters('kind'), parameters('rulename'))]",
                                "destinations": {
                                  "logAnalytics": [
                                    {
                                      "workspaceResourceId": "[parameters('workspaceId')]",
                                      "name": "[parameters('wsfriendlyname')]"
                                    }
                                  ]
                                },
                                "dataSources": {
                                  "windowsEventLogs": "[if(empty(parameters('xPathQueries')), null(), createArray(createObject('streams', createArray('Microsoft-Event'), 'xPathQueries', parameters('xPathQueries'), 'name', 'EventLogsDataSource')))]",
                                  "performanceCounters": [
                                    {
                                      "streams": [
                                        "Microsoft-Perf"
                                      ],
                                      "samplingFrequencyInSeconds": "[parameters('samplingFrequencyInSeconds')]",
                                      "counterSpecifiers": "[parameters('counterSpecifiers')]",
                                      "name": "PerfCountersDataSource"
                                    }
                                  ]
                                },
                                "dataFlows": [
                                  {
                                    "streams": [
                                      "Microsoft-Event",
                                      "Microsoft-Perf"
                                    ],
                                    "destinations": [
                                      "[parameters('wsfriendlyname')]"
                                    ]
                                  }
                                ]
                              }
                            }
                          ],
                          "outputs": {
                            "dcrId": {
                              "type": "string",
                              "value": "[resourceId('Microsoft.Insights/dataCollectionRules', parameters('rulename'))]"
                            }
                          }
                        }
                      }
                    },
                    {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2022-09-01",
                      "name": "[format('dcrIISLogs-{0}', parameters('packtag'))]",
                      "subscriptionId": "[parameters('subscriptionId')]",
                      "resourceGroup": "[variables('resourceGroupName')]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "location": {
                            "value": "[parameters('location')]"
                          },
                          "ruleName": {
                            "value": "[format('{0}-IISLogs', variables('rulename'))]"
                          },
                          "lawResourceId": {
                            "value": "[parameters('workspaceId')]"
                          },
                          "Tags": {
                            "value": "[variables('Tags')]"
                          },
                          "endpointResourceId": {
                            "value": "[parameters('dceId')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.32.4.45862",
                              "templateHash": "11212238793022467482"
                            }
                          },
                          "parameters": {
                            "ruleName": {
                              "type": "string",
                              "metadata": {
                                "description": "Specifies the name of the data collection rule to create."
                              }
                            },
                            "endpointResourceId": {
                              "type": "string",
                              "metadata": {
                                "description": "Specifies the resource id of the data collection endpoint."
                              }
                            },
                            "location": {
                              "type": "string",
                              "metadata": {
                                "description": "Specifies the location in which to create the data collection rule."
                              }
                            },
                            "lawResourceId": {
                              "type": "string"
                            },
                            "Tags": {
                              "type": "object"
                            }
                          },
                          "variables": {
                            "lawFriendlyName": "[split(parameters('lawResourceId'), '/')[8]]"
                          },
                          "resources": [
                            {
                              "type": "Microsoft.Insights/dataCollectionRules",
                              "apiVersion": "2022-06-01",
                              "name": "[parameters('ruleName')]",
                              "location": "[parameters('location')]",
                              "tags": "[parameters('Tags')]",
                              "kind": "Windows",
                              "properties": {
                                "dataCollectionEndpointId": "[parameters('endpointResourceId')]",
                                "dataSources": {
                                  "iisLogs": [
                                    {
                                      "streams": [
                                        "Microsoft-W3CIISLog"
                                      ],
                                      "name": "iisLogsDataSource"
                                    }
                                  ]
                                },
                                "destinations": {
                                  "logAnalytics": [
                                    {
                                      "workspaceResourceId": "[parameters('lawResourceId')]",
                                      "name": "[variables('lawFriendlyName')]"
                                    }
                                  ]
                                },
                                "dataFlows": [
                                  {
                                    "streams": [
                                      "Microsoft-W3CIISLog"
                                    ],
                                    "destinations": [
                                      "[variables('lawFriendlyName')]"
                                    ],
                                    "transformKql": "source",
                                    "outputStream": "Microsoft-W3CIISLog"
                                  }
                                ],
                                "streamDeclarations": {
                                  "Custom-MyTable_CL": {
                                    "columns": [
                                      {
                                        "name": "TimeGenerated",
                                        "type": "datetime"
                                      },
                                      {
                                        "name": "RawData",
                                        "type": "string"
                                      }
                                    ]
                                  }
                                }
                              }
                            }
                          ],
                          "outputs": {
                            "dcrId": {
                              "type": "string",
                              "value": "[resourceId('Microsoft.Insights/dataCollectionRules', parameters('ruleName'))]"
                            }
                          }
                        }
                      }
                    }
                  ]
                }
              }
            },
            {
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2022-09-01",
              "name": "[format('IIS2016-deployment-{0}-{1}', parameters('instanceName'), parameters('location'))]",
              "location": "[deployment().location]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "dceId": {
                    "value": "[parameters('dceId')]"
                  },
                  "location": {
                    "value": "[parameters('location')]"
                  },
                  "resourceGroupId": {
                    "value": "[parameters('resourceGroupId')]"
                  },
                  "solutionTag": {
                    "value": "[parameters('solutionTag')]"
                  },
                  "solutionVersion": {
                    "value": "[parameters('solutionVersion')]"
                  },
                  "subscriptionId": {
                    "value": "[parameters('subscriptionId')]"
                  },
                  "userManagedIdentityResourceId": {
                    "value": "[parameters('userManagedIdentityResourceId')]"
                  },
                  "workspaceId": {
                    "value": "[parameters('workspaceId')]"
                  },
                  "customerTags": {
                    "value": "[parameters('customerTags')]"
                  },
                  "actionGroupResourceId": {
                    "value": "[parameters('actionGroupResourceId')]"
                  },
                  "instanceName": {
                    "value": "[parameters('instanceName')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2018-05-01/subscriptionDeploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.32.4.45862",
                      "templateHash": "1996276289550204623"
                    }
                  },
                  "parameters": {
                    "actionGroupResourceId": {
                      "type": "string"
                    },
                    "location": {
                      "type": "string",
                      "metadata": {
                        "description": "location for the deployment."
                      }
                    },
                    "workspaceId": {
                      "type": "string",
                      "metadata": {
                        "description": "Full resource ID of the log analytics workspace to be used for the deployment."
                      }
                    },
                    "packtag": {
                      "type": "string",
                      "defaultValue": "IIS2016"
                    },
                    "solutionTag": {
                      "type": "string",
                      "defaultValue": "MonitorStarterPacks"
                    },
                    "solutionVersion": {
                      "type": "string"
                    },
                    "dceId": {
                      "type": "string",
                      "metadata": {
                        "description": "Full resource ID of the data collection endpoint to be used for the deployment."
                      }
                    },
                    "userManagedIdentityResourceId": {
                      "type": "string",
                      "metadata": {
                        "description": "Full resource ID of the user managed identity to be used for the deployment"
                      }
                    },
                    "subscriptionId": {
                      "type": "string"
                    },
                    "resourceGroupId": {
                      "type": "string"
                    },
                    "instanceName": {
                      "type": "string"
                    },
                    "customerTags": {
                      "type": "object"
                    }
                  },
                  "variables": {
                    "rulename": "[format('AMP-{0}-{1}', parameters('instanceName'), parameters('packtag'))]",
                    "ruleshortname": "[format('AMP-{0}-{1}', parameters('instanceName'), parameters('packtag'))]",
                    "tempTags": {
                      "[format('{0}', parameters('solutionTag'))]": "[parameters('packtag')]",
                      "MonitoringPackType": "IaaS",
                      "solutionVersion": "[parameters('solutionVersion')]"
                    },
                    "Tags": "[if(equals(parameters('customerTags'), createObject()), variables('tempTags'), union(variables('tempTags'), parameters('customerTags').All))]",
                    "workspaceFriendlyName": "[split(parameters('workspaceId'), '/')[8]]",
                    "resourceGroupName": "[split(parameters('resourceGroupId'), '/')[4]]",
                    "kind": "Windows",
                    "xPathQueries": [
                      "System!*[System[Provider[@Name='Microsoft-Windows-IIS-W3SVC'] and (EventID=1071 or EventID=1073)]]",
                      "System!*[System[Provider[@Name='Microsoft-Windows-IIS-W3SVC'] and (EventID=1135 or EventID=1134)]]",
                      "Application!*[System[Provider[@Name='Microsoft-Windows-IIS-W3SVC-WP'] and (EventID=2226 or EventID=2230 or EventID=2231 or EventID=2232)]]",
                      "Application!*[System[Provider[@Name='Microsoft-Windows-IIS-W3SVC-WP'] and (EventID=2274 or EventID=2268 or EventID=2220 or EventID=2219 or EventID=2214)]]",
                      "System!*[System[Provider[@Name='Microsoft-Windows-WAS'] and (EventID=5172 or EventID=5173)]]",
                      "System!*[System[Provider[@Name='Microsoft-Windows-WAS'] and (EventID=5174 or EventID=5179 or EventID=5180)]]",
                      "System!*[System[Provider[@Name='Microsoft-Windows-WAS'] and (EventID=5152)]]",
                      "System!*[System[Provider[@Name='Microsoft-Windows-IIS-W3SVC'] and (EventID=1037)]]",
                      "System!*[System[Provider[@Name='Microsoft-Windows-IIS-W3SVC'] and (EventID=1062)]]",
                      "System!*[System[Provider[@Name='Microsoft-Windows-IIS-W3SVC'] and (EventID=1126)]]",
                      "System!*[System[Provider[@Name='Microsoft-Windows-IIS-W3SVC'] and (EventID=1133)]]",
                      "System!*[System[Provider[@Name='Microsoft-Windows-IIS-W3SVC'] and (EventID=1173)]]",
                      "System!*[System[Provider[@Name='Microsoft-Windows-IIS-W3SVC'] and (EventID=1175)]]",
                      "Application!*[System[Provider[@Name='Microsoft-Windows-IIS-W3SVC-WP'] and (EventID=2201)]]",
                      "Application!*[System[Provider[@Name='Microsoft-Windows-IIS-W3SVC-WP'] and (EventID=2203)]]",
                      "Application!*[System[Provider[@Name='Microsoft-Windows-IIS-W3SVC-WP'] and (EventID=2204)]]",
                      "Application!*[System[Provider[@Name='Microsoft-Windows-IIS-W3SVC-WP'] and (EventID=2206)]]",
                      "Application!*[System[Provider[@Name='Microsoft-Windows-IIS-W3SVC-WP'] and (EventID=2208)]]",
                      "Application!*[System[Provider[@Name='Microsoft-Windows-IIS-W3SVC-WP'] and (EventID=2218)]]",
                      "Application!*[System[Provider[@Name='Microsoft-Windows-IIS-W3SVC-WP'] and (EventID=2227)]]",
                      "Application!*[System[Provider[@Name='Microsoft-Windows-IIS-W3SVC-WP'] and (EventID=2233)]]",
                      "Application!*[System[Provider[@Name='Microsoft-Windows-IIS-W3SVC-WP'] and (EventID=2258)]]",
                      "Application!*[System[Provider[@Name='Microsoft-Windows-IIS-W3SVC-WP'] and (EventID=2261)]]",
                      "Application!*[System[Provider[@Name='Microsoft-Windows-IIS-W3SVC-WP'] and (EventID=2264)]]",
                      "Application!*[System[Provider[@Name='Microsoft-Windows-IIS-W3SVC-WP'] and (EventID=2281)]]",
                      "Application!*[System[Provider[@Name='Microsoft-Windows-IIS-W3SVC-WP'] and (EventID=2293)]]",
                      "Application!*[System[Provider[@Name='Microsoft-Windows-IIS-W3SVC-WP'] and (EventID=2295)]]",
                      "Application!*[System[Provider[@Name='Microsoft-Windows-IIS-W3SVC-WP'] and (EventID=2296)]]",
                      "Application!*[System[Provider[@Name='Microsoft-Windows-IIS-W3SVC-WP'] and (EventID=2298)]]",
                      "System!*[System[Provider[@Name='Microsoft-Windows-WAS'] and (EventID=5005)]]",
                      "System!*[System[Provider[@Name='Microsoft-Windows-WAS'] and (EventID=5030)]]",
                      "System!*[System[Provider[@Name='Microsoft-Windows-WAS'] and (EventID=5036)]]",
                      "System!*[System[Provider[@Name='Microsoft-Windows-WAS'] and (EventID=5053)]]",
                      "System!*[System[Provider[@Name='Microsoft-Windows-WAS'] and (EventID=5063)]]",
                      "System!*[System[Provider[@Name='Microsoft-Windows-WAS'] and (EventID=5066)]]",
                      "System!*[System[Provider[@Name='Microsoft-Windows-WAS'] and (EventID=5067)]]",
                      "System!*[System[Provider[@Name='Microsoft-Windows-WAS'] and (EventID=5153)]]",
                      "System!*[System[Provider[@Name='Microsoft-Windows-W3LOGSVC'] and (EventID=6001)]]",
                      "System!*[System[Provider[@Name='Microsoft-Windows-W3LOGSVC'] and (EventID=6002)]]",
                      "System!*[System[Provider[@Name='Microsoft-Windows-W3LOGSVC'] and (EventID=6003)]]",
                      "System!*[System[Provider[@Name='Microsoft-Windows-W3LOGSVC'] and (EventID=6004)]]",
                      "System!*[System[Provider[@Name='Microsoft-Windows-W3LOGSVC'] and (EventID=6005)]]",
                      "System!*[System[Provider[@Name='Microsoft-Windows-W3LOGSVC'] and (EventID=6006)]]",
                      "System!*[System[Provider[@Name='Microsoft-Windows-W3LOGSVC'] and (EventID=6007)]]",
                      "System!*[System[Provider[@Name='Microsoft-Windows-W3LOGSVC'] and (EventID=6008)]]",
                      "System!*[System[Provider[@Name='Microsoft-Windows-W3LOGSVC'] and (EventID=6009)]]",
                      "System!*[System[Provider[@Name='Microsoft-Windows-W3LOGSVC'] and (EventID=6010)]]",
                      "System!*[System[Provider[@Name='Microsoft-Windows-W3LOGSVC'] and (EventID=6011)]]",
                      "System!*[System[Provider[@Name='Service Control Manager'] and (EventID=7023 or EventID=7024)]]",
                      "System!*[System[Provider[@Name='Service Control Manager'] and (EventID=7031)]]",
                      "System!*[System[Provider[@Name='Service Control Manager'] and (EventID=7034)]]",
                      "System!*[System[Provider[@Name='Service Control Manager'] and (EventID=7043)]]"
                    ],
                    "performanceCounters": [
                      "\\Web Service(_Total)\\Bytes Received/sec",
                      "\\Web Service(_Total)\\Bytes Sent/sec",
                      "\\Web Service(_Total)\\Bytes Total/sec",
                      "\\Web Service(_Total)\\Connection Attempts/sec",
                      "\\Web Service(_Total)\\Current Connections",
                      "\\Web Service(_Total)\\Total Method Requests/sec",
                      "\\Microsoft FTP Service(_Total)\\Bytes Total/sec",
                      "\\Microsoft FTP Service(_Total)\\Current Connections",
                      "\\SMTP Server(_Total)\\Bytes Received/sec",
                      "\\SMTP Server(_Total)\\Bytes Sent/sec",
                      "\\SMTP Server(_Total)\\Bytes Total/sec",
                      "\\SMTP Server(_Total)\\Inbound Connections Current",
                      "\\SMTP Server(_Total)\\Message Bytes Received/sec",
                      "\\SMTP Server(_Total)\\Message Bytes Sent/sec",
                      "\\SMTP Server(_Total)\\Messages Delivered/sec",
                      "\\SMTP Server(_Total)\\Messages Received/sec",
                      "\\SMTP Server(_Total)\\Messages Sent/sec",
                      "\\SMTP Server(_Total)\\Outbound Connections Current",
                      "\\SMTP Server(_Total)\\Total Messages Submitted",
                      "\\SMTP Server(SMTP 1)\\Bytes Received/sec",
                      "\\SMTP Server(SMTP 1)\\Bytes Sent/sec",
                      "\\SMTP Server(SMTP 1)\\Bytes Total/sec",
                      "\\SMTP Server(SMTP 1)\\Inbound Connections Current",
                      "\\SMTP Server(SMTP 1)\\Message Bytes Received/sec",
                      "\\SMTP Server(SMTP 1)\\Message Bytes Sent/sec",
                      "\\SMTP Server(SMTP 1)\\Messages Delivered/sec",
                      "\\SMTP Server(SMTP 1)\\Messages Received/sec",
                      "\\SMTP Server(SMTP 1)\\Messages Sent/sec",
                      "\\SMTP Server(SMTP 1)\\Outbound Connections Current",
                      "\\SMTP Server(SMTP 1)\\Total Messages Submitted"
                    ]
                  },
                  "resources": [
                    {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2022-09-01",
                      "name": "[format('Alerts-{0}', parameters('packtag'))]",
                      "subscriptionId": "[parameters('subscriptionId')]",
                      "resourceGroup": "[variables('resourceGroupName')]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "location": {
                            "value": "[parameters('location')]"
                          },
                          "workspaceId": {
                            "value": "[parameters('workspaceId')]"
                          },
                          "AGId": {
                            "value": "[parameters('actionGroupResourceId')]"
                          },
                          "packtag": {
                            "value": "[parameters('packtag')]"
                          },
                          "Tags": {
                            "value": "[variables('Tags')]"
                          },
                          "instanceName": {
                            "value": "[parameters('instanceName')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.32.4.45862",
                              "templateHash": "9461356001780640398"
                            }
                          },
                          "parameters": {
                            "location": {
                              "type": "string"
                            },
                            "workspaceId": {
                              "type": "string"
                            },
                            "AGId": {
                              "type": "string"
                            },
                            "packtag": {
                              "type": "string"
                            },
                            "Tags": {
                              "type": "object"
                            },
                            "instanceName": {
                              "type": "string"
                            }
                          },
                          "variables": {
                            "moduleprefix": "[format('AMP-{0}-{1}', parameters('instanceName'), parameters('packtag'))]",
                            "alertlist": [
                              {
                                "alertRuleDescription": "A server side include file has included itself or the maximum depth of server side includes has been exceeded",
                                "alertRuleDisplayName": "A server side include file has included itself or the maximum depth of server side includes has been exceeded",
                                "alertRuleName": "AlertRule-IIS-2012-1",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (2221) and EventLog == 'Application' and Source == 'Microsoft-Windows-IIS-W3SVC-WP'"
                              },
                              {
                                "alertRuleDescription": "Application Pool has an IdleTimeout equal to or greater than the PeriodicRestart time",
                                "alertRuleDisplayName": "Application Pool has an IdleTimeout equal to or greater than the PeriodicRestart time",
                                "alertRuleName": "AlertRule-IIS-2012-2",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (5152) and EventLog == 'System' and Source == 'Microsoft-Windows-WAS'"
                              },
                              {
                                "alertRuleDescription": "Application Pool worker process is unresponsive",
                                "alertRuleDisplayName": "Application Pool worker process is unresponsive",
                                "alertRuleName": "AlertRule-IIS-2012-3",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (5010,5011,5012,5013) and EventLog == 'System' and Source == 'Microsoft-Windows-WAS'"
                              },
                              {
                                "alertRuleDescription": "Application Pool worker process terminated unexpectedly",
                                "alertRuleDisplayName": "Application Pool worker process terminated unexpectedly",
                                "alertRuleName": "AlertRule-IIS-2012-4",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (5009) and EventLog == 'System' and Source == 'Microsoft-Windows-WAS'"
                              },
                              {
                                "alertRuleDescription": "ASP application error occurred",
                                "alertRuleDisplayName": "ASP application error occurred",
                                "alertRuleName": "AlertRule-IIS-2012-5",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (500,499,23,22,21,20,19,18,17,16,9,8,7,6,5) and EventLog == 'Application' and Source == 'Active Server Pages'"
                              },
                              {
                                "alertRuleDescription": "HTTP control channel for the WWW Service did not open",
                                "alertRuleDisplayName": "HTTP control channel for the WWW Service did not open",
                                "alertRuleName": "AlertRule-IIS-2012-6",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (1037) and EventLog == 'System' and Source == 'Microsoft-Windows-IIS-W3SVC'"
                              },
                              {
                                "alertRuleDescription": "HTTP Server could not create a client connection object for user",
                                "alertRuleDisplayName": "HTTP Server could not create a client connection object for user",
                                "alertRuleName": "AlertRule-IIS-2012-7",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (2208) and EventLog == 'Application' and Source == 'Microsoft-Windows-IIS-W3SVC-WP'"
                              },
                              {
                                "alertRuleDescription": "HTTP Server could not create the main connection socket",
                                "alertRuleDisplayName": "HTTP Server could not create the main connection socket",
                                "alertRuleName": "AlertRule-IIS-2012-8",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (2206) and EventLog == 'Application' and Source == 'Microsoft-Windows-IIS-W3SVC-WP'"
                              },
                              {
                                "alertRuleDescription": "HTTP Server could not initialize its security",
                                "alertRuleDisplayName": "HTTP Server could not initialize its security",
                                "alertRuleName": "AlertRule-IIS-2012-9",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (2201) and EventLog == 'Application' and Source == 'Microsoft-Windows-IIS-W3SVC-WP'"
                              },
                              {
                                "alertRuleDescription": "HTTP Server could not initialize the socket library",
                                "alertRuleDisplayName": "HTTP Server could not initialize the socket library",
                                "alertRuleName": "AlertRule-IIS-2012-10",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (2203) and EventLog == 'Application' and Source == 'Microsoft-Windows-IIS-W3SVC-WP'"
                              },
                              {
                                "alertRuleDescription": "HTTP Server was unable to initialize due to a shortage of available memory",
                                "alertRuleDisplayName": "HTTP Server was unable to initialize due to a shortage of available memory",
                                "alertRuleName": "AlertRule-IIS-2012-11",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (2204) and EventLog == 'Application' and Source == 'Microsoft-Windows-IIS-W3SVC-WP'"
                              },
                              {
                                "alertRuleDescription": "ISAPI application error detected",
                                "alertRuleDisplayName": "ISAPI application error detected",
                                "alertRuleName": "AlertRule-IIS-2012-12",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (2274,2268,2220,2219,2214) and EventLog == 'Application' and Source == 'Microsoft-Windows-IIS-W3SVC-WP'"
                              },
                              {
                                "alertRuleDescription": "Job object associated with the application pool encountered an error",
                                "alertRuleDisplayName": "Job object associated with the application pool encountered an error",
                                "alertRuleName": "AlertRule-IIS-2012-13",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (5088,5061,5060) and EventLog == 'System' and Source == 'Microsoft-Windows-WAS'"
                              },
                              {
                                "alertRuleDescription": "Module has an invalid precondition",
                                "alertRuleDisplayName": "Module has an invalid precondition",
                                "alertRuleName": "AlertRule-IIS-2012-14",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (2296) and EventLog == 'Application' and Source == 'Microsoft-Windows-IIS-W3SVC-WP'"
                              },
                              {
                                "alertRuleDescription": "Module registration error detected (failed to find RegisterModule entrypoint)",
                                "alertRuleDisplayName": "Module registration error detected (failed to find RegisterModule entrypoint)",
                                "alertRuleName": "AlertRule-IIS-2012-15",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (2295) and EventLog == 'Application' and Source == 'Microsoft-Windows-IIS-W3SVC-WP'"
                              },
                              {
                                "alertRuleDescription": "Module registration error detected (module returned an error during registration)",
                                "alertRuleDisplayName": "Module registration error detected (module returned an error during registration)",
                                "alertRuleName": "AlertRule-IIS-2012-16",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (2293) and EventLog == 'Application' and Source == 'Microsoft-Windows-IIS-W3SVC-WP'"
                              },
                              {
                                "alertRuleDescription": "Only one type of logging can be enabled at a time",
                                "alertRuleDisplayName": "Only one type of logging can be enabled at a time",
                                "alertRuleName": "AlertRule-IIS-2012-17",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (1133) and EventLog == 'System' and Source == 'Microsoft-Windows-IIS-W3SVC'"
                              },
                              {
                                "alertRuleDescription": "SF_NOTIFY_READ_RAW_DATA filter notification is not supported in IIS 8",
                                "alertRuleDisplayName": "SF_NOTIFY_READ_RAW_DATA filter notification is not supported in IIS 8",
                                "alertRuleName": "AlertRule-IIS-2012-18",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (2261) and EventLog == 'Application' and Source == 'Microsoft-Windows-IIS-W3SVC-WP'"
                              },
                              {
                                "alertRuleDescription": "The configuration manager for WAS did not initialize",
                                "alertRuleDisplayName": "The configuration manager for WAS did not initialize",
                                "alertRuleName": "AlertRule-IIS-2012-19",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (5036) and EventLog == 'System' and Source == 'Microsoft-Windows-WAS'"
                              },
                              {
                                "alertRuleDescription": "The directory specified for caching compressed content is invalid",
                                "alertRuleDisplayName": "The directory specified for caching compressed content is invalid",
                                "alertRuleName": "AlertRule-IIS-2012-20",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (2264) and EventLog == 'Application' and Source == 'Microsoft-Windows-IIS-W3SVC-WP'"
                              },
                              {
                                "alertRuleDescription": "The Global Modules list is empty",
                                "alertRuleDisplayName": "The Global Modules list is empty",
                                "alertRuleName": "AlertRule-IIS-2012-21",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (2298) and EventLog == 'Application' and Source == 'Microsoft-Windows-IIS-W3SVC-WP'"
                              },
                              {
                                "alertRuleDescription": "The HTTP server encountered an error processing the server side include file",
                                "alertRuleDisplayName": "The HTTP server encountered an error processing the server side include file",
                                "alertRuleName": "AlertRule-IIS-2012-22",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (2218) and EventLog == 'Application' and Source == 'Microsoft-Windows-IIS-W3SVC-WP'"
                              },
                              {
                                "alertRuleDescription": "The server failed to close client connections to URLs during shutdown",
                                "alertRuleDisplayName": "The server failed to close client connections to URLs during shutdown",
                                "alertRuleName": "AlertRule-IIS-2012-23",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (2258) and EventLog == 'Application' and Source == 'Microsoft-Windows-IIS-W3SVC-WP'"
                              },
                              {
                                "alertRuleDescription": "The server was unable to acquire a license for a SSL connection",
                                "alertRuleDisplayName": "The server was unable to acquire a license for a SSL connection",
                                "alertRuleName": "AlertRule-IIS-2012-24",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (2227) and EventLog == 'Application' and Source == 'Microsoft-Windows-IIS-W3SVC-WP'"
                              },
                              {
                                "alertRuleDescription": "The server was unable to allocate a buffer to read a file",
                                "alertRuleDisplayName": "The server was unable to allocate a buffer to read a file",
                                "alertRuleName": "AlertRule-IIS-2012-25",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (2233) and EventLog == 'Application' and Source == 'Microsoft-Windows-IIS-W3SVC-WP'"
                              },
                              {
                                "alertRuleDescription": "The server was unable to read a file",
                                "alertRuleDisplayName": "The server was unable to read a file",
                                "alertRuleName": "AlertRule-IIS-2012-26",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (2226,2230,2231,2232) and EventLog == 'Application' and Source == 'Microsoft-Windows-IIS-W3SVC-WP'"
                              },
                              {
                                "alertRuleDescription": "WAS detected invalid configuration data",
                                "alertRuleDisplayName": "WAS detected invalid configuration data",
                                "alertRuleName": "AlertRule-IIS-2012-27",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (5174,5179,5180) and EventLog == 'System' and Source == 'Microsoft-Windows-WAS'"
                              }
                            ]
                          },
                          "resources": [
                            {
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "[format('{0}-Alerts', variables('moduleprefix'))]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "alertlist": {
                                    "value": "[variables('alertlist')]"
                                  },
                                  "AGId": {
                                    "value": "[parameters('AGId')]"
                                  },
                                  "location": {
                                    "value": "[parameters('location')]"
                                  },
                                  "moduleprefix": {
                                    "value": "[variables('moduleprefix')]"
                                  },
                                  "packtag": {
                                    "value": "[parameters('packtag')]"
                                  },
                                  "Tags": {
                                    "value": "[parameters('Tags')]"
                                  },
                                  "workspaceId": {
                                    "value": "[parameters('workspaceId')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.32.4.45862",
                                      "templateHash": "17858688129795365440"
                                    }
                                  },
                                  "parameters": {
                                    "alertlist": {
                                      "type": "array"
                                    },
                                    "location": {
                                      "type": "string"
                                    },
                                    "workspaceId": {
                                      "type": "string"
                                    },
                                    "AGId": {
                                      "type": "string"
                                    },
                                    "packtag": {
                                      "type": "string"
                                    },
                                    "Tags": {
                                      "type": "object"
                                    },
                                    "moduleprefix": {
                                      "type": "string"
                                    }
                                  },
                                  "resources": [
                                    {
                                      "copy": {
                                        "name": "Alerts",
                                        "count": "[length(parameters('alertlist'))]"
                                      },
                                      "type": "Microsoft.Resources/deployments",
                                      "apiVersion": "2022-09-01",
                                      "name": "[format('{0}-Alert-{1}', parameters('packtag'), copyIndex())]",
                                      "properties": {
                                        "expressionEvaluationOptions": {
                                          "scope": "inner"
                                        },
                                        "mode": "Incremental",
                                        "parameters": {
                                          "location": {
                                            "value": "[parameters('location')]"
                                          },
                                          "actionGroupResourceId": {
                                            "value": "[parameters('AGId')]"
                                          },
                                          "alertRuleDescription": {
                                            "value": "[parameters('alertlist')[copyIndex()].alertRuleDescription]"
                                          },
                                          "alertRuleDisplayName": {
                                            "value": "[format('{0}-{1}', parameters('moduleprefix'), parameters('alertlist')[copyIndex()].alertRuleDisplayName)]"
                                          },
                                          "alertRuleName": {
                                            "value": "[format('{0}-{1}', parameters('moduleprefix'), parameters('alertlist')[copyIndex()].alertRuleName)]"
                                          },
                                          "alertRuleSeverity": {
                                            "value": "[parameters('alertlist')[copyIndex()].alertRuleSeverity]"
                                          },
                                          "autoMitigate": {
                                            "value": "[parameters('alertlist')[copyIndex()].autoMitigate]"
                                          },
                                          "evaluationFrequency": {
                                            "value": "[parameters('alertlist')[copyIndex()].evaluationFrequency]"
                                          },
                                          "windowSize": {
                                            "value": "[parameters('alertlist')[copyIndex()].windowSize]"
                                          },
                                          "scope": {
                                            "value": "[parameters('workspaceId')]"
                                          },
                                          "query": {
                                            "value": "[parameters('alertlist')[copyIndex()].query]"
                                          },
                                          "dimensions": "[if(contains(parameters('alertlist')[copyIndex()], 'dimensions'), createObject('value', parameters('alertlist')[copyIndex()].dimensions), createObject('value', null()))]",
                                          "packtag": {
                                            "value": "[parameters('packtag')]"
                                          },
                                          "Tags": {
                                            "value": "[parameters('Tags')]"
                                          },
                                          "alertType": {
                                            "value": "[parameters('alertlist')[copyIndex()].alertType]"
                                          },
                                          "metricMeasureColumn": "[if(equals(parameters('alertlist')[copyIndex()].alertType, 'Aggregated'), createObject('value', parameters('alertlist')[copyIndex()].metricMeasureColumn), createObject('value', null()))]",
                                          "operator": "[if(equals(parameters('alertlist')[copyIndex()].alertType, 'Aggregated'), createObject('value', parameters('alertlist')[copyIndex()].operator), createObject('value', null()))]",
                                          "threshold": "[if(equals(parameters('alertlist')[copyIndex()].alertType, 'Aggregated'), createObject('value', parameters('alertlist')[copyIndex()].threshold), createObject('value', null()))]"
                                        },
                                        "template": {
                                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                          "contentVersion": "1.0.0.0",
                                          "metadata": {
                                            "_generator": {
                                              "name": "bicep",
                                              "version": "0.32.4.45862",
                                              "templateHash": "10159755056440989647"
                                            }
                                          },
                                          "parameters": {
                                            "alertType": {
                                              "type": "string",
                                              "allowedValues": [
                                                "rows",
                                                "Aggregated"
                                              ]
                                            },
                                            "alertRuleName": {
                                              "type": "string"
                                            },
                                            "alertRuleDisplayName": {
                                              "type": "string"
                                            },
                                            "alertRuleDescription": {
                                              "type": "string"
                                            },
                                            "scope": {
                                              "type": "string"
                                            },
                                            "actionGroupResourceId": {
                                              "type": "string"
                                            },
                                            "alertRuleSeverity": {
                                              "type": "int"
                                            },
                                            "location": {
                                              "type": "string"
                                            },
                                            "windowSize": {
                                              "type": "string",
                                              "defaultValue": "PT15M"
                                            },
                                            "evaluationFrequency": {
                                              "type": "string",
                                              "defaultValue": "PT15M"
                                            },
                                            "autoMitigate": {
                                              "type": "bool",
                                              "defaultValue": false
                                            },
                                            "query": {
                                              "type": "string"
                                            },
                                            "packtag": {
                                              "type": "string"
                                            },
                                            "Tags": {
                                              "type": "object"
                                            },
                                            "threshold": {
                                              "type": "int",
                                              "defaultValue": 0
                                            },
                                            "metricMeasureColumn": {
                                              "type": "string",
                                              "defaultValue": ""
                                            },
                                            "dimensions": {
                                              "type": "array",
                                              "defaultValue": [
                                                {
                                                  "name": "Computer",
                                                  "operator": "Include",
                                                  "values": [
                                                    "*"
                                                  ]
                                                }
                                              ]
                                            },
                                            "operator": {
                                              "type": "string",
                                              "defaultValue": "GreaterThan",
                                              "allowedValues": [
                                                "GreaterThan",
                                                "GreaterThanOrEqual",
                                                "LessThan",
                                                "LessThanOrEqual",
                                                "Equal",
                                                "NotEqual"
                                              ]
                                            }
                                          },
                                          "resources": [
                                            {
                                              "condition": "[equals(parameters('alertType'), 'rows')]",
                                              "type": "Microsoft.Resources/deployments",
                                              "apiVersion": "2022-09-01",
                                              "name": "[parameters('alertRuleName')]",
                                              "properties": {
                                                "expressionEvaluationOptions": {
                                                  "scope": "inner"
                                                },
                                                "mode": "Incremental",
                                                "parameters": {
                                                  "alertRuleName": {
                                                    "value": "[parameters('alertRuleName')]"
                                                  },
                                                  "alertRuleDisplayName": {
                                                    "value": "[parameters('alertRuleDisplayName')]"
                                                  },
                                                  "alertRuleDescription": {
                                                    "value": "[parameters('alertRuleDescription')]"
                                                  },
                                                  "scope": {
                                                    "value": "[parameters('scope')]"
                                                  },
                                                  "dimensions": {
                                                    "value": "[parameters('dimensions')]"
                                                  },
                                                  "actionGroupResourceId": {
                                                    "value": "[parameters('actionGroupResourceId')]"
                                                  },
                                                  "alertRuleSeverity": {
                                                    "value": "[parameters('alertRuleSeverity')]"
                                                  },
                                                  "location": {
                                                    "value": "[parameters('location')]"
                                                  },
                                                  "windowSize": {
                                                    "value": "[parameters('windowSize')]"
                                                  },
                                                  "evaluationFrequency": {
                                                    "value": "[parameters('evaluationFrequency')]"
                                                  },
                                                  "autoMitigate": {
                                                    "value": "[parameters('autoMitigate')]"
                                                  },
                                                  "query": {
                                                    "value": "[parameters('query')]"
                                                  },
                                                  "Tags": {
                                                    "value": "[parameters('Tags')]"
                                                  }
                                                },
                                                "template": {
                                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                                  "contentVersion": "1.0.0.0",
                                                  "metadata": {
                                                    "_generator": {
                                                      "name": "bicep",
                                                      "version": "0.32.4.45862",
                                                      "templateHash": "16566470716356207302"
                                                    }
                                                  },
                                                  "parameters": {
                                                    "alertRuleName": {
                                                      "type": "string"
                                                    },
                                                    "alertRuleDisplayName": {
                                                      "type": "string"
                                                    },
                                                    "alertRuleDescription": {
                                                      "type": "string"
                                                    },
                                                    "scope": {
                                                      "type": "string"
                                                    },
                                                    "actionGroupResourceId": {
                                                      "type": "string"
                                                    },
                                                    "alertRuleSeverity": {
                                                      "type": "int"
                                                    },
                                                    "location": {
                                                      "type": "string"
                                                    },
                                                    "windowSize": {
                                                      "type": "string",
                                                      "defaultValue": "PT15M"
                                                    },
                                                    "evaluationFrequency": {
                                                      "type": "string",
                                                      "defaultValue": "PT15M"
                                                    },
                                                    "autoMitigate": {
                                                      "type": "bool",
                                                      "defaultValue": false
                                                    },
                                                    "query": {
                                                      "type": "string"
                                                    },
                                                    "dimensions": {
                                                      "type": "array"
                                                    },
                                                    "Tags": {
                                                      "type": "object"
                                                    }
                                                  },
                                                  "resources": [
                                                    {
                                                      "type": "Microsoft.Insights/scheduledQueryRules",
                                                      "apiVersion": "2023-03-15-preview",
                                                      "name": "[parameters('alertRuleName')]",
                                                      "location": "[parameters('location')]",
                                                      "tags": "[parameters('Tags')]",
                                                      "properties": {
                                                        "description": "[parameters('alertRuleDescription')]",
                                                        "ruleResolveConfiguration": {},
                                                        "displayName": "[parameters('alertRuleDisplayName')]",
                                                        "enabled": true,
                                                        "scopes": [
                                                          "[parameters('scope')]"
                                                        ],
                                                        "targetResourceTypes": [
                                                          "Microsoft.OperationalInsights/workspaces"
                                                        ],
                                                        "windowSize": "[parameters('windowSize')]",
                                                        "evaluationFrequency": "[parameters('evaluationFrequency')]",
                                                        "severity": "[parameters('alertRuleSeverity')]",
                                                        "criteria": {
                                                          "allOf": [
                                                            {
                                                              "query": "[parameters('query')]",
                                                              "timeAggregation": "Count",
                                                              "dimensions": "[parameters('dimensions')]",
                                                              "resourceIdColumn": "[if(empty(parameters('dimensions')), '_ResourceId', null())]",
                                                              "operator": "GreaterThan",
                                                              "threshold": 0,
                                                              "failingPeriods": {
                                                                "numberOfEvaluationPeriods": 1,
                                                                "minFailingPeriodsToAlert": 1
                                                              }
                                                            }
                                                          ]
                                                        },
                                                        "autoMitigate": "[parameters('autoMitigate')]",
                                                        "actions": {
                                                          "actionGroups": [
                                                            "[parameters('actionGroupResourceId')]"
                                                          ],
                                                          "customProperties": {}
                                                        }
                                                      }
                                                    }
                                                  ]
                                                }
                                              }
                                            },
                                            {
                                              "condition": "[equals(parameters('alertType'), 'Aggregated')]",
                                              "type": "Microsoft.Resources/deployments",
                                              "apiVersion": "2022-09-01",
                                              "name": "[parameters('alertRuleName')]",
                                              "properties": {
                                                "expressionEvaluationOptions": {
                                                  "scope": "inner"
                                                },
                                                "mode": "Incremental",
                                                "parameters": {
                                                  "alertRuleName": {
                                                    "value": "[parameters('alertRuleName')]"
                                                  },
                                                  "alertRuleDisplayName": {
                                                    "value": "[parameters('alertRuleDisplayName')]"
                                                  },
                                                  "alertRuleDescription": {
                                                    "value": "[parameters('alertRuleDescription')]"
                                                  },
                                                  "scope": {
                                                    "value": "[parameters('scope')]"
                                                  },
                                                  "dimensions": {
                                                    "value": "[parameters('dimensions')]"
                                                  },
                                                  "actionGroupResourceId": {
                                                    "value": "[parameters('actionGroupResourceId')]"
                                                  },
                                                  "alertRuleSeverity": {
                                                    "value": "[parameters('alertRuleSeverity')]"
                                                  },
                                                  "location": {
                                                    "value": "[parameters('location')]"
                                                  },
                                                  "windowSize": {
                                                    "value": "[parameters('windowSize')]"
                                                  },
                                                  "evaluationFrequency": {
                                                    "value": "[parameters('evaluationFrequency')]"
                                                  },
                                                  "autoMitigate": {
                                                    "value": "[parameters('autoMitigate')]"
                                                  },
                                                  "query": {
                                                    "value": "[parameters('query')]"
                                                  },
                                                  "Tags": {
                                                    "value": "[parameters('Tags')]"
                                                  },
                                                  "threshold": {
                                                    "value": "[parameters('threshold')]"
                                                  },
                                                  "metricMeasureColumn": {
                                                    "value": "[parameters('metricMeasureColumn')]"
                                                  },
                                                  "operator": {
                                                    "value": "[parameters('operator')]"
                                                  }
                                                },
                                                "template": {
                                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                                  "contentVersion": "1.0.0.0",
                                                  "metadata": {
                                                    "_generator": {
                                                      "name": "bicep",
                                                      "version": "0.32.4.45862",
                                                      "templateHash": "18444959286864838274"
                                                    }
                                                  },
                                                  "parameters": {
                                                    "alertRuleName": {
                                                      "type": "string"
                                                    },
                                                    "alertRuleDisplayName": {
                                                      "type": "string"
                                                    },
                                                    "alertRuleDescription": {
                                                      "type": "string"
                                                    },
                                                    "scope": {
                                                      "type": "string"
                                                    },
                                                    "actionGroupResourceId": {
                                                      "type": "string"
                                                    },
                                                    "alertRuleSeverity": {
                                                      "type": "int"
                                                    },
                                                    "location": {
                                                      "type": "string"
                                                    },
                                                    "windowSize": {
                                                      "type": "string",
                                                      "defaultValue": "PT15M"
                                                    },
                                                    "evaluationFrequency": {
                                                      "type": "string",
                                                      "defaultValue": "PT15M"
                                                    },
                                                    "autoMitigate": {
                                                      "type": "bool",
                                                      "defaultValue": false
                                                    },
                                                    "query": {
                                                      "type": "string"
                                                    },
                                                    "dimensions": {
                                                      "type": "array"
                                                    },
                                                    "threshold": {
                                                      "type": "int"
                                                    },
                                                    "metricMeasureColumn": {
                                                      "type": "string"
                                                    },
                                                    "Tags": {
                                                      "type": "object"
                                                    },
                                                    "operator": {
                                                      "type": "string",
                                                      "allowedValues": [
                                                        "GreaterThan",
                                                        "GreaterThanOrEqual",
                                                        "LessThan",
                                                        "LessThanOrEqual",
                                                        "Equal",
                                                        "NotEqual"
                                                      ]
                                                    }
                                                  },
                                                  "resources": [
                                                    {
                                                      "type": "Microsoft.Insights/scheduledQueryRules",
                                                      "apiVersion": "2023-03-15-preview",
                                                      "name": "[parameters('alertRuleName')]",
                                                      "location": "[parameters('location')]",
                                                      "tags": "[parameters('Tags')]",
                                                      "properties": {
                                                        "description": "[parameters('alertRuleDescription')]",
                                                        "ruleResolveConfiguration": {},
                                                        "displayName": "[parameters('alertRuleDisplayName')]",
                                                        "enabled": true,
                                                        "scopes": [
                                                          "[parameters('scope')]"
                                                        ],
                                                        "targetResourceTypes": [
                                                          "Microsoft.OperationalInsights/workspaces"
                                                        ],
                                                        "windowSize": "[parameters('windowSize')]",
                                                        "evaluationFrequency": "[parameters('evaluationFrequency')]",
                                                        "severity": "[parameters('alertRuleSeverity')]",
                                                        "criteria": {
                                                          "allOf": [
                                                            {
                                                              "query": "[parameters('query')]",
                                                              "timeAggregation": "Average",
                                                              "metricMeasureColumn": "[parameters('metricMeasureColumn')]",
                                                              "dimensions": "[parameters('dimensions')]",
                                                              "resourceIdColumn": "[if(empty(parameters('dimensions')), '_ResourceId', null())]",
                                                              "operator": "[parameters('operator')]",
                                                              "threshold": "[parameters('threshold')]",
                                                              "failingPeriods": {
                                                                "numberOfEvaluationPeriods": 1,
                                                                "minFailingPeriodsToAlert": 1
                                                              }
                                                            }
                                                          ]
                                                        },
                                                        "autoMitigate": "[parameters('autoMitigate')]",
                                                        "actions": {
                                                          "actionGroups": [
                                                            "[parameters('actionGroupResourceId')]"
                                                          ],
                                                          "customProperties": {}
                                                        }
                                                      }
                                                    }
                                                  ]
                                                }
                                              }
                                            }
                                          ]
                                        }
                                      }
                                    }
                                  ]
                                }
                              }
                            }
                          ]
                        }
                      }
                    },
                    {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2022-09-01",
                      "name": "[format('dcrPerformance-{0}', parameters('packtag'))]",
                      "subscriptionId": "[parameters('subscriptionId')]",
                      "resourceGroup": "[variables('resourceGroupName')]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "location": {
                            "value": "[parameters('location')]"
                          },
                          "rulename": {
                            "value": "[variables('rulename')]"
                          },
                          "workspaceId": {
                            "value": "[parameters('workspaceId')]"
                          },
                          "wsfriendlyname": {
                            "value": "[variables('workspaceFriendlyName')]"
                          },
                          "kind": {
                            "value": "[variables('kind')]"
                          },
                          "xPathQueries": {
                            "value": "[variables('xPathQueries')]"
                          },
                          "counterSpecifiers": {
                            "value": "[variables('performanceCounters')]"
                          },
                          "Tags": {
                            "value": "[variables('Tags')]"
                          },
                          "dceId": {
                            "value": "[parameters('dceId')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.32.4.45862",
                              "templateHash": "15691414683408659274"
                            }
                          },
                          "parameters": {
                            "location": {
                              "type": "string"
                            },
                            "rulename": {
                              "type": "string"
                            },
                            "workspaceId": {
                              "type": "string"
                            },
                            "kind": {
                              "type": "string",
                              "defaultValue": "Windows"
                            },
                            "wsfriendlyname": {
                              "type": "string",
                              "defaultValue": "TBD"
                            },
                            "xPathQueries": {
                              "type": "array",
                              "defaultValue": []
                            },
                            "counterSpecifiers": {
                              "type": "array",
                              "defaultValue": []
                            },
                            "samplingFrequencyInSeconds": {
                              "type": "int",
                              "defaultValue": 300
                            },
                            "Tags": {
                              "type": "object"
                            },
                            "dceId": {
                              "type": "string"
                            }
                          },
                          "resources": [
                            {
                              "type": "Microsoft.Insights/dataCollectionRules",
                              "apiVersion": "2022-06-01",
                              "name": "[parameters('rulename')]",
                              "location": "[parameters('location')]",
                              "tags": "[parameters('Tags')]",
                              "kind": "[parameters('kind')]",
                              "properties": {
                                "dataCollectionEndpointId": "[parameters('dceId')]",
                                "description": "[format('Data Collection Rule for {0}}} - {1}}}', parameters('kind'), parameters('rulename'))]",
                                "destinations": {
                                  "logAnalytics": [
                                    {
                                      "workspaceResourceId": "[parameters('workspaceId')]",
                                      "name": "[parameters('wsfriendlyname')]"
                                    }
                                  ]
                                },
                                "dataSources": {
                                  "windowsEventLogs": "[if(empty(parameters('xPathQueries')), null(), createArray(createObject('streams', createArray('Microsoft-Event'), 'xPathQueries', parameters('xPathQueries'), 'name', 'EventLogsDataSource')))]",
                                  "performanceCounters": [
                                    {
                                      "streams": [
                                        "Microsoft-Perf"
                                      ],
                                      "samplingFrequencyInSeconds": "[parameters('samplingFrequencyInSeconds')]",
                                      "counterSpecifiers": "[parameters('counterSpecifiers')]",
                                      "name": "PerfCountersDataSource"
                                    }
                                  ]
                                },
                                "dataFlows": [
                                  {
                                    "streams": [
                                      "Microsoft-Event",
                                      "Microsoft-Perf"
                                    ],
                                    "destinations": [
                                      "[parameters('wsfriendlyname')]"
                                    ]
                                  }
                                ]
                              }
                            }
                          ],
                          "outputs": {
                            "dcrId": {
                              "type": "string",
                              "value": "[resourceId('Microsoft.Insights/dataCollectionRules', parameters('rulename'))]"
                            }
                          }
                        }
                      }
                    },
                    {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2022-09-01",
                      "name": "[format('dcrIISLogs-{0}', parameters('packtag'))]",
                      "subscriptionId": "[parameters('subscriptionId')]",
                      "resourceGroup": "[variables('resourceGroupName')]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "location": {
                            "value": "[parameters('location')]"
                          },
                          "ruleName": {
                            "value": "[format('{0}-IISLogs', variables('rulename'))]"
                          },
                          "lawResourceId": {
                            "value": "[parameters('workspaceId')]"
                          },
                          "Tags": {
                            "value": "[variables('Tags')]"
                          },
                          "endpointResourceId": {
                            "value": "[parameters('dceId')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.32.4.45862",
                              "templateHash": "11212238793022467482"
                            }
                          },
                          "parameters": {
                            "ruleName": {
                              "type": "string",
                              "metadata": {
                                "description": "Specifies the name of the data collection rule to create."
                              }
                            },
                            "endpointResourceId": {
                              "type": "string",
                              "metadata": {
                                "description": "Specifies the resource id of the data collection endpoint."
                              }
                            },
                            "location": {
                              "type": "string",
                              "metadata": {
                                "description": "Specifies the location in which to create the data collection rule."
                              }
                            },
                            "lawResourceId": {
                              "type": "string"
                            },
                            "Tags": {
                              "type": "object"
                            }
                          },
                          "variables": {
                            "lawFriendlyName": "[split(parameters('lawResourceId'), '/')[8]]"
                          },
                          "resources": [
                            {
                              "type": "Microsoft.Insights/dataCollectionRules",
                              "apiVersion": "2022-06-01",
                              "name": "[parameters('ruleName')]",
                              "location": "[parameters('location')]",
                              "tags": "[parameters('Tags')]",
                              "kind": "Windows",
                              "properties": {
                                "dataCollectionEndpointId": "[parameters('endpointResourceId')]",
                                "dataSources": {
                                  "iisLogs": [
                                    {
                                      "streams": [
                                        "Microsoft-W3CIISLog"
                                      ],
                                      "name": "iisLogsDataSource"
                                    }
                                  ]
                                },
                                "destinations": {
                                  "logAnalytics": [
                                    {
                                      "workspaceResourceId": "[parameters('lawResourceId')]",
                                      "name": "[variables('lawFriendlyName')]"
                                    }
                                  ]
                                },
                                "dataFlows": [
                                  {
                                    "streams": [
                                      "Microsoft-W3CIISLog"
                                    ],
                                    "destinations": [
                                      "[variables('lawFriendlyName')]"
                                    ],
                                    "transformKql": "source",
                                    "outputStream": "Microsoft-W3CIISLog"
                                  }
                                ],
                                "streamDeclarations": {
                                  "Custom-MyTable_CL": {
                                    "columns": [
                                      {
                                        "name": "TimeGenerated",
                                        "type": "datetime"
                                      },
                                      {
                                        "name": "RawData",
                                        "type": "string"
                                      }
                                    ]
                                  }
                                }
                              }
                            }
                          ],
                          "outputs": {
                            "dcrId": {
                              "type": "string",
                              "value": "[resourceId('Microsoft.Insights/dataCollectionRules', parameters('ruleName'))]"
                            }
                          }
                        }
                      }
                    }
                  ]
                }
              }
            },
            {
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2022-09-01",
              "name": "[format('DNS2016-deployment-{0}-{1}', parameters('instanceName'), parameters('location'))]",
              "location": "[deployment().location]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "dceId": {
                    "value": "[parameters('dceId')]"
                  },
                  "location": {
                    "value": "[parameters('location')]"
                  },
                  "resourceGroupId": {
                    "value": "[parameters('resourceGroupId')]"
                  },
                  "solutionTag": {
                    "value": "[parameters('solutionTag')]"
                  },
                  "solutionVersion": {
                    "value": "[parameters('solutionVersion')]"
                  },
                  "subscriptionId": {
                    "value": "[parameters('subscriptionId')]"
                  },
                  "userManagedIdentityResourceId": {
                    "value": "[parameters('userManagedIdentityResourceId')]"
                  },
                  "workspaceId": {
                    "value": "[parameters('workspaceId')]"
                  },
                  "customerTags": {
                    "value": "[parameters('customerTags')]"
                  },
                  "actionGroupResourceId": {
                    "value": "[parameters('actionGroupResourceId')]"
                  },
                  "instanceName": {
                    "value": "[parameters('instanceName')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2018-05-01/subscriptionDeploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.32.4.45862",
                      "templateHash": "15095836579749806306"
                    }
                  },
                  "parameters": {
                    "location": {
                      "type": "string",
                      "metadata": {
                        "description": "location for the deployment."
                      }
                    },
                    "workspaceId": {
                      "type": "string",
                      "metadata": {
                        "description": "Full resource ID of the log analytics workspace to be used for the deployment."
                      }
                    },
                    "packtag": {
                      "type": "string",
                      "defaultValue": "DNS2016"
                    },
                    "dceId": {
                      "type": "string",
                      "metadata": {
                        "description": "Full resource ID of the data collection endpoint to be used for the deployment."
                      }
                    },
                    "userManagedIdentityResourceId": {
                      "type": "string",
                      "metadata": {
                        "description": "Full resource ID of the user managed identity to be used for the deployment"
                      }
                    },
                    "subscriptionId": {
                      "type": "string"
                    },
                    "resourceGroupId": {
                      "type": "string"
                    },
                    "solutionTag": {
                      "type": "string"
                    },
                    "solutionVersion": {
                      "type": "string"
                    },
                    "customerTags": {
                      "type": "object"
                    },
                    "actionGroupResourceId": {
                      "type": "string"
                    },
                    "instanceName": {
                      "type": "string"
                    }
                  },
                  "variables": {
                    "rulename": "[format('AMP-{0}-{1}', parameters('instanceName'), parameters('packtag'))]",
                    "tempTags": {
                      "[format('{0}', parameters('solutionTag'))]": "[parameters('packtag')]",
                      "MonitoringPackType": "IaaS",
                      "solutionVersion": "[parameters('solutionVersion')]"
                    },
                    "Tags": "[if(equals(parameters('customerTags'), createObject()), variables('tempTags'), union(variables('tempTags'), parameters('customerTags').All))]",
                    "workspaceFriendlyName": "[split(parameters('workspaceId'), '/')[8]]",
                    "ruleshortname": "[format('AMP-{0}-{1}', parameters('instanceName'), parameters('packtag'))]",
                    "resourceGroupName": "[split(parameters('resourceGroupId'), '/')[4]]",
                    "kind": "Windows",
                    "xPathQueries": [
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=10)]]",
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=1000)]]",
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=1004)]]",
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=1200)]]",
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=1201)]]",
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=1203)]]",
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=131)]]",
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=140)]]",
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=150)]]",
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=1540)]]",
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=4000)]]",
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=4006)]]",
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=4007)]]",
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=4010)]]",
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=4011)]]",
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=4012)]]",
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=4014)]]",
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=4015)]]",
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=4016)]]",
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=4017)]]",
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=408)]]",
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=409)]]",
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=410)]]",
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=414)]]",
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=4510)]]",
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=4511)]]",
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=4512)]]",
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=501)]]",
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=502)]]",
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=503)]]",
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=504)]]",
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=5051)]]",
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=6527)]]",
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=6702)]]",
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=706)]]",
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=7060)]]",
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=7616)]]",
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=7636)]]",
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=7642)]]",
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=7644)]]",
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=777)]]",
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=111 or EventID=6533)]]",
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=4018 or EventID=4019)]]",
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=4513 or EventID=4514)]]",
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=4520 or EventID=4521)]]",
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=707 or EventID=1003)]]",
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=7692 or EventID=790)]]",
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=796 or EventID=799)]]",
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=2200 or EventID=2202 or EventID=2203)]]",
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=7502 or EventID=7503 or EventID=7504)]]",
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=792 or EventID=795 or EventID=797)]]",
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=1001 or EventID=1008 or EventID=3151 or EventID=3152 or EventID=3153)]]",
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=403 or EventID=404 or EventID=405 or EventID=406 or EventID=407)]]",
                      "DNS Server!*[System[Provider[@Name='Microsoft-Windows-DNS-Server-Service'] and (EventID=500 or EventID=505 or EventID=506 or EventID=507 or EventID=2204)]]"
                    ],
                    "performanceCounters": [
                      "\\DNS\\AXFR Request Received",
                      "\\DNS\\AXFR Request Sent",
                      "\\DNS\\AXFR Response Received",
                      "\\DNS\\AXFR Success Received",
                      "\\DNS\\AXFR Success Sent",
                      "\\DNS\\Caching Memory",
                      "\\DNS\\Data Flush Pages/sec",
                      "\\DNS\\Data Flushes/sec",
                      "\\DNS\\Database Node Memory",
                      "\\DNS\\Dynamic Update NoOperation",
                      "\\DNS\\Dynamic Update NoOperation/sec",
                      "\\DNS\\Dynamic Update Queued",
                      "\\DNS\\Dynamic Update Received",
                      "\\DNS\\Dynamic Update Received/sec",
                      "\\DNS\\Dynamic Update Rejected",
                      "\\DNS\\Dynamic Update TimeOuts",
                      "\\DNS\\Dynamic Update Written to Database",
                      "\\DNS\\Dynamic Update Written to Database/sec",
                      "\\DNS\\IXFR Request Received",
                      "\\DNS\\IXFR Request Sent",
                      "\\DNS\\IXFR Response Received",
                      "\\DNS\\IXFR Success Received",
                      "\\DNS\\IXFR Success Sent",
                      "\\DNS\\IXFR TCP Success Received",
                      "\\DNS\\IXFR UDP Success Received",
                      "\\DNS\\Nbstat Memory",
                      "\\DNS\\Notify Received",
                      "\\DNS\\Notify Sent",
                      "\\DNS\\Query Dropped Bad Socket",
                      "\\DNS\\Query Dropped Bad Socket/sec",
                      "\\DNS\\Query Dropped By Policy",
                      "\\DNS\\Query Dropped By Policy/sec",
                      "\\DNS\\Query Dropped By Response Rate Limiting",
                      "\\DNS\\Query Dropped By Response Rate Limiting/sec",
                      "\\DNS\\Query Dropped Send",
                      "\\DNS\\Query Dropped Send/sec",
                      "\\DNS\\Query Dropped Total",
                      "\\DNS\\Query Dropped Total/sec",
                      "\\DNS\\Record Flow Memory",
                      "\\DNS\\Recursive Queries",
                      "\\DNS\\Recursive Queries/sec",
                      "\\DNS\\Recursive Query Failure",
                      "\\DNS\\Recursive Query Failure/sec",
                      "\\DNS\\Recursive Send TimeOuts",
                      "\\DNS\\Recursive TimeOut/sec",
                      "\\DNS\\Responses Suppressed",
                      "\\DNS\\Responses Suppressed/sec",
                      "\\DNS\\Secure Update Failure",
                      "\\DNS\\Secure Update Received",
                      "\\DNS\\Secure Update Received/sec",
                      "\\DNS\\TCP Message Memory",
                      "\\DNS\\TCP Query Received",
                      "\\DNS\\TCP Query Received/sec",
                      "\\DNS\\TCP Response Sent",
                      "\\DNS\\TCP Response Sent/sec",
                      "\\DNS\\Total Query Received",
                      "\\DNS\\Total Query Received/sec",
                      "\\DNS\\Total Remote Inflight Queries",
                      "\\DNS\\Total Response Sent",
                      "\\DNS\\Total Response Sent/sec",
                      "\\DNS\\UDP Message Memory",
                      "\\DNS\\UDP Query Received",
                      "\\DNS\\UDP Query Received/sec",
                      "\\DNS\\UDP Response Sent",
                      "\\DNS\\UDP Response Sent/sec",
                      "\\DNS\\Unmatched Responses Received",
                      "\\DNS\\WINS Lookup Received",
                      "\\DNS\\WINS Lookup Received/sec",
                      "\\DNS\\WINS Response Sent",
                      "\\DNS\\WINS Response Sent/sec",
                      "\\DNS\\WINS Reverse Lookup Received",
                      "\\DNS\\WINS Reverse Lookup Received/sec",
                      "\\DNS\\WINS Reverse Response Sent",
                      "\\DNS\\WINS Reverse Response Sent/sec",
                      "\\DNS\\Zone Transfer Failure",
                      "\\DNS\\Zone Transfer Request Received",
                      "\\DNS\\Zone Transfer SOA Request Sent",
                      "\\DNS\\Zone Transfer Success"
                    ]
                  },
                  "resources": [
                    {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2022-09-01",
                      "name": "[format('Alerts-{0}', parameters('packtag'))]",
                      "subscriptionId": "[parameters('subscriptionId')]",
                      "resourceGroup": "[variables('resourceGroupName')]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "location": {
                            "value": "[parameters('location')]"
                          },
                          "workspaceId": {
                            "value": "[parameters('workspaceId')]"
                          },
                          "AGId": {
                            "value": "[parameters('actionGroupResourceId')]"
                          },
                          "packtag": {
                            "value": "[parameters('packtag')]"
                          },
                          "Tags": {
                            "value": "[variables('Tags')]"
                          },
                          "instanceName": {
                            "value": "[parameters('instanceName')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.32.4.45862",
                              "templateHash": "10681976057115393931"
                            }
                          },
                          "parameters": {
                            "location": {
                              "type": "string"
                            },
                            "workspaceId": {
                              "type": "string"
                            },
                            "AGId": {
                              "type": "string"
                            },
                            "packtag": {
                              "type": "string"
                            },
                            "Tags": {
                              "type": "object"
                            },
                            "instanceName": {
                              "type": "string"
                            }
                          },
                          "variables": {
                            "moduleprefix": "[format('AMP-{0}-{1}', parameters('instanceName'), parameters('packtag'))]",
                            "alertlist": [
                              {
                                "alertRuleDescription": "Service.DependencyFailed",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.Service.DependencyFailed",
                                "alertRuleName": "AlertRule-Dns-2016-10",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (10) and EventLog == 'DNS Server'"
                              },
                              {
                                "alertRuleDescription": "Configuration.FileOpenError",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.Configuration.FileOpenError",
                                "alertRuleName": "AlertRule-Dns-2016-1000",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (1000) and EventLog == 'DNS Server'"
                              },
                              {
                                "alertRuleDescription": "Configuration.CouldNotOpenDatabase",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.Configuration.CouldNotOpenDatabase",
                                "alertRuleName": "AlertRule-Dns-2016-1004",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (1004) and EventLog == 'DNS Server'"
                              },
                              {
                                "alertRuleDescription": "Configuration.BootFileNotFound",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.Configuration.BootFileNotFound",
                                "alertRuleName": "AlertRule-Dns-2016-1200",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (1200) and EventLog == 'DNS Server'"
                              },
                              {
                                "alertRuleDescription": "Configuration.ZoneCreationFailed",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.Configuration.ZoneCreationFailed",
                                "alertRuleName": "AlertRule-Dns-2016-1201",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (1201) and EventLog == 'DNS Server'"
                              },
                              {
                                "alertRuleDescription": "Configuration.NoForwardingAddresses",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.Configuration.NoForwardingAddresses",
                                "alertRuleName": "AlertRule-Dns-2016-1203",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (1203) and EventLog == 'DNS Server'"
                              },
                              {
                                "alertRuleDescription": "WINSConnector.Initialize.Failed",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.WINSConnector.Initialize.Failed",
                                "alertRuleName": "AlertRule-Dns-2016-131",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (131) and EventLog == 'DNS Server'"
                              },
                              {
                                "alertRuleDescription": "RPC.Initialize.Failed",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.RPC.Initialize.Failed",
                                "alertRuleName": "AlertRule-Dns-2016-140",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (140) and EventLog == 'DNS Server'"
                              },
                              {
                                "alertRuleDescription": "Configuration.PluginInitFailed",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.Configuration.PluginInitFailed",
                                "alertRuleName": "AlertRule-Dns-2016-150",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (150) and EventLog == 'DNS Server'"
                              },
                              {
                                "alertRuleDescription": "Configuration.DomainNodeCreationError",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.Configuration.DomainNodeCreationError",
                                "alertRuleName": "AlertRule-Dns-2016-1540",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (1540) and EventLog == 'DNS Server'"
                              },
                              {
                                "alertRuleDescription": "ADI.OpenFailed",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.ADI.OpenFailed",
                                "alertRuleName": "AlertRule-Dns-2016-4000",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (4000) and EventLog == 'DNS Server'"
                              },
                              {
                                "alertRuleDescription": "ADI.LoadFailed",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.ADI.LoadFailed",
                                "alertRuleName": "AlertRule-Dns-2016-4006",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (4006) and EventLog == 'DNS Server'"
                              },
                              {
                                "alertRuleDescription": "ADI.OpenPartitionFailed",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.ADI.OpenPartitionFailed",
                                "alertRuleName": "AlertRule-Dns-2016-4007",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (4007) and EventLog == 'DNS Server'"
                              },
                              {
                                "alertRuleDescription": "ADI.RecordLoadFailed",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.ADI.RecordLoadFailed",
                                "alertRuleName": "AlertRule-Dns-2016-4010",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (4010) and EventLog == 'DNS Server'"
                              },
                              {
                                "alertRuleDescription": "ADI.WriteFailed",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.ADI.WriteFailed",
                                "alertRuleName": "AlertRule-Dns-2016-4011",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (4011) and EventLog == 'DNS Server'"
                              },
                              {
                                "alertRuleDescription": "ADI.WriteTimeout",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.ADI.WriteTimeout",
                                "alertRuleName": "AlertRule-Dns-2016-4012",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (4012) and EventLog == 'DNS Server'"
                              },
                              {
                                "alertRuleDescription": "ADI.SecurityInterfaceFailed",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.ADI.SecurityInterfaceFailed",
                                "alertRuleName": "AlertRule-Dns-2016-4014",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (4014) and EventLog == 'DNS Server'"
                              },
                              {
                                "alertRuleDescription": "ADI.InterfaceError",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.ADI.InterfaceError",
                                "alertRuleName": "AlertRule-Dns-2016-4015",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (4015) and EventLog == 'DNS Server'"
                              },
                              {
                                "alertRuleDescription": "ADI.LDAPTimeout",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.ADI.LDAPTimeout",
                                "alertRuleName": "AlertRule-Dns-2016-4016",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (4016) and EventLog == 'DNS Server'"
                              },
                              {
                                "alertRuleDescription": "ADI.DNSAdminsError",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.ADI.DNSAdminsError",
                                "alertRuleName": "AlertRule-Dns-2016-4017",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (4017) and EventLog == 'DNS Server'"
                              },
                              {
                                "alertRuleDescription": "Configuration.OpenSocketForAddress",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.Configuration.OpenSocketForAddress",
                                "alertRuleName": "AlertRule-Dns-2016-408",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (408) and EventLog == 'DNS Server'"
                              },
                              {
                                "alertRuleDescription": "Configuration.UpdateListenAddresses",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.Configuration.UpdateListenAddresses",
                                "alertRuleName": "AlertRule-Dns-2016-409",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (409) and EventLog == 'DNS Server'"
                              },
                              {
                                "alertRuleDescription": "Configuration.InvalidListenAddresses",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.Configuration.InvalidListenAddresses",
                                "alertRuleName": "AlertRule-Dns-2016-410",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (410) and EventLog == 'DNS Server'"
                              },
                              {
                                "alertRuleDescription": "Configuration.SingleLabelHostname",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.Configuration.SingleLabelHostname",
                                "alertRuleName": "AlertRule-Dns-2016-414",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (414) and EventLog == 'DNS Server'"
                              },
                              {
                                "alertRuleDescription": "ADI.FSMOUnavailable",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.ADI.FSMOUnavailable",
                                "alertRuleName": "AlertRule-Dns-2016-4510",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (4510) and EventLog == 'DNS Server'"
                              },
                              {
                                "alertRuleDescription": "ADI.DeleteError",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.ADI.DeleteError",
                                "alertRuleName": "AlertRule-Dns-2016-4511",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (4511) and EventLog == 'DNS Server'"
                              },
                              {
                                "alertRuleDescription": "ADI.PartitionCreateError",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.ADI.PartitionCreateError",
                                "alertRuleName": "AlertRule-Dns-2016-4512",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (4512) and EventLog == 'DNS Server'"
                              },
                              {
                                "alertRuleDescription": "Configuration.InvalidZoneType",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.Configuration.InvalidZoneType",
                                "alertRuleName": "AlertRule-Dns-2016-501",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (501) and EventLog == 'DNS Server'"
                              },
                              {
                                "alertRuleDescription": "Configuration.NoZoneFile",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.Configuration.NoZoneFile",
                                "alertRuleName": "AlertRule-Dns-2016-502",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (502) and EventLog == 'DNS Server'"
                              },
                              {
                                "alertRuleDescription": "Configuration.SecondaryRequiresMasters",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.Configuration.SecondaryRequiresMasters",
                                "alertRuleName": "AlertRule-Dns-2016-503",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (503) and EventLog == 'DNS Server'"
                              },
                              {
                                "alertRuleDescription": "Configuration.RegZoneCreationFailed",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.Configuration.RegZoneCreationFailed",
                                "alertRuleName": "AlertRule-Dns-2016-504",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (504) and EventLog == 'DNS Server'"
                              },
                              {
                                "alertRuleDescription": "Service.Memory.Warning",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.Service.Memory.Warning",
                                "alertRuleName": "AlertRule-Dns-2016-5051",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (5051) and EventLog == 'DNS Server'"
                              },
                              {
                                "alertRuleDescription": "Configuration.ZoneExpiration",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.Configuration.ZoneExpiration",
                                "alertRuleName": "AlertRule-Dns-2016-6527",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (6527) and EventLog == 'DNS Server'"
                              },
                              {
                                "alertRuleDescription": "Configuration.UpdateDSPeersFailure",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.Configuration.UpdateDSPeersFailure",
                                "alertRuleName": "AlertRule-Dns-2016-6702",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (6702) and EventLog == 'DNS Server'"
                              },
                              {
                                "alertRuleDescription": "RootHints.NoRootNameServer",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.RootHints.NoRootNameServer",
                                "alertRuleName": "AlertRule-Dns-2016-706",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (706) and EventLog == 'DNS Server'"
                              },
                              {
                                "alertRuleDescription": "Service.ConnectionError",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.Service.ConnectionError",
                                "alertRuleName": "AlertRule-Dns-2016-7060",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (7060) and EventLog == 'DNS Server'"
                              },
                              {
                                "alertRuleDescription": "DNSSEC.TALoadFailed",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.Rules.DNSSEC.TALoadFailed",
                                "alertRuleName": "AlertRule-Dns-2016-7616",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (7616) and EventLog == 'DNS Server'"
                              },
                              {
                                "alertRuleDescription": "DNSSEC.TPDeleted",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.Rules.DNSSEC.TPDeleted",
                                "alertRuleName": "AlertRule-Dns-2016-7636",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (7636) and EventLog == 'DNS Server'"
                              },
                              {
                                "alertRuleDescription": "DNSSEC.InvalidTA",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.Rules.DNSSEC.InvalidTA",
                                "alertRuleName": "AlertRule-Dns-2016-7642",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (7642) and EventLog == 'DNS Server'"
                              },
                              {
                                "alertRuleDescription": "DNSSEC.TARefreshFailed",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.Rules.DNSSEC.TARefreshFailed",
                                "alertRuleName": "AlertRule-Dns-2016-7644",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (7644) and EventLog == 'DNS Server'"
                              },
                              {
                                "alertRuleDescription": "DNSSEC.ZoneUnSignFailure",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.Rules.DNSSEC.ZoneUnSignFailure",
                                "alertRuleName": "AlertRule-Dns-2016-777",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (777) and EventLog == 'DNS Server'"
                              },
                              {
                                "alertRuleDescription": "Service.ThreadCreationFailed",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.Service.ThreadCreationFailed",
                                "alertRuleName": "AlertRule-Dns-2016-111",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (111,6533) and EventLog == 'DNS Server'"
                              },
                              {
                                "alertRuleDescription": "ADI.BackgroundLoadFailure",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.ADI.BackgroundLoadFailure",
                                "alertRuleName": "AlertRule-Dns-2016-4018",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (4018,4019) and EventLog == 'DNS Server'"
                              },
                              {
                                "alertRuleDescription": "ADI.EnlistmentFailed",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.ADI.EnlistmentFailed",
                                "alertRuleName": "AlertRule-Dns-2016-4513",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (4513,4514) and EventLog == 'DNS Server'"
                              },
                              {
                                "alertRuleDescription": "ADI.RetryableZoneOperationFailed",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.ADI.RetryableZoneOperationFailed",
                                "alertRuleName": "AlertRule-Dns-2016-4520",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (4520,4521) and EventLog == 'DNS Server'"
                              },
                              {
                                "alertRuleDescription": "RootHints.CacheFileError",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.RootHints.CacheFileError",
                                "alertRuleName": "AlertRule-Dns-2016-707",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (707,1003) and EventLog == 'DNS Server'"
                              },
                              {
                                "alertRuleDescription": "Server.EDNS0.ZoneTransfer.OptionInvalid",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.Rules.Server.EDNS0.ZoneTransfer.OptionInvalid",
                                "alertRuleName": "AlertRule-Dns-2016-7692",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (7692,790) and EventLog == 'DNS Server'"
                              },
                              {
                                "alertRuleDescription": "ClientSubnet.LoadFail",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.Rules.ClientSubnet.LoadFail",
                                "alertRuleName": "AlertRule-Dns-2016-796",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (796,799) and EventLog == 'DNS Server'"
                              },
                              {
                                "alertRuleDescription": "Configuration.RegistryOperationFailed",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.Configuration.RegistryOperationFailed",
                                "alertRuleName": "AlertRule-Dns-2016-2200",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (2200,2202,2203) and EventLog == 'DNS Server'"
                              },
                              {
                                "alertRuleDescription": "Service.Memory.Error",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.Service.Memory.Error",
                                "alertRuleName": "AlertRule-Dns-2016-7502",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (7502,7503,7504) and EventLog == 'DNS Server'"
                              },
                              {
                                "alertRuleDescription": "Policy.ServerLevel.LoadFail",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.Rules.Policy.ServerLevel.LoadFail",
                                "alertRuleName": "AlertRule-Dns-2016-792",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (792,795,797) and EventLog == 'DNS Server'"
                              },
                              {
                                "alertRuleDescription": "Service.FileError",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.Service.FileError",
                                "alertRuleName": "AlertRule-Dns-2016-1001",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (1001,1008,3151,3152,3153) and EventLog == 'DNS Server'"
                              },
                              {
                                "alertRuleDescription": "Service.SocketFailure",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.Service.SocketFailure",
                                "alertRuleName": "AlertRule-Dns-2016-403",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (403,404,405,406,407) and EventLog == 'DNS Server'"
                              },
                              {
                                "alertRuleDescription": "Configuration.InvalidRegistrySetting",
                                "alertRuleDisplayName": "Microsoft.Windows.DNSServer.2016.Configuration.InvalidRegistrySetting",
                                "alertRuleName": "AlertRule-Dns-2016-500",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (500,505,506,507,2204) and EventLog == 'DNS Server'"
                              }
                            ]
                          },
                          "resources": [
                            {
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "[format('{0}-Alerts', variables('moduleprefix'))]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "alertlist": {
                                    "value": "[variables('alertlist')]"
                                  },
                                  "AGId": {
                                    "value": "[parameters('AGId')]"
                                  },
                                  "location": {
                                    "value": "[parameters('location')]"
                                  },
                                  "moduleprefix": {
                                    "value": "[variables('moduleprefix')]"
                                  },
                                  "packtag": {
                                    "value": "[parameters('packtag')]"
                                  },
                                  "Tags": {
                                    "value": "[parameters('Tags')]"
                                  },
                                  "workspaceId": {
                                    "value": "[parameters('workspaceId')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.32.4.45862",
                                      "templateHash": "17858688129795365440"
                                    }
                                  },
                                  "parameters": {
                                    "alertlist": {
                                      "type": "array"
                                    },
                                    "location": {
                                      "type": "string"
                                    },
                                    "workspaceId": {
                                      "type": "string"
                                    },
                                    "AGId": {
                                      "type": "string"
                                    },
                                    "packtag": {
                                      "type": "string"
                                    },
                                    "Tags": {
                                      "type": "object"
                                    },
                                    "moduleprefix": {
                                      "type": "string"
                                    }
                                  },
                                  "resources": [
                                    {
                                      "copy": {
                                        "name": "Alerts",
                                        "count": "[length(parameters('alertlist'))]"
                                      },
                                      "type": "Microsoft.Resources/deployments",
                                      "apiVersion": "2022-09-01",
                                      "name": "[format('{0}-Alert-{1}', parameters('packtag'), copyIndex())]",
                                      "properties": {
                                        "expressionEvaluationOptions": {
                                          "scope": "inner"
                                        },
                                        "mode": "Incremental",
                                        "parameters": {
                                          "location": {
                                            "value": "[parameters('location')]"
                                          },
                                          "actionGroupResourceId": {
                                            "value": "[parameters('AGId')]"
                                          },
                                          "alertRuleDescription": {
                                            "value": "[parameters('alertlist')[copyIndex()].alertRuleDescription]"
                                          },
                                          "alertRuleDisplayName": {
                                            "value": "[format('{0}-{1}', parameters('moduleprefix'), parameters('alertlist')[copyIndex()].alertRuleDisplayName)]"
                                          },
                                          "alertRuleName": {
                                            "value": "[format('{0}-{1}', parameters('moduleprefix'), parameters('alertlist')[copyIndex()].alertRuleName)]"
                                          },
                                          "alertRuleSeverity": {
                                            "value": "[parameters('alertlist')[copyIndex()].alertRuleSeverity]"
                                          },
                                          "autoMitigate": {
                                            "value": "[parameters('alertlist')[copyIndex()].autoMitigate]"
                                          },
                                          "evaluationFrequency": {
                                            "value": "[parameters('alertlist')[copyIndex()].evaluationFrequency]"
                                          },
                                          "windowSize": {
                                            "value": "[parameters('alertlist')[copyIndex()].windowSize]"
                                          },
                                          "scope": {
                                            "value": "[parameters('workspaceId')]"
                                          },
                                          "query": {
                                            "value": "[parameters('alertlist')[copyIndex()].query]"
                                          },
                                          "dimensions": "[if(contains(parameters('alertlist')[copyIndex()], 'dimensions'), createObject('value', parameters('alertlist')[copyIndex()].dimensions), createObject('value', null()))]",
                                          "packtag": {
                                            "value": "[parameters('packtag')]"
                                          },
                                          "Tags": {
                                            "value": "[parameters('Tags')]"
                                          },
                                          "alertType": {
                                            "value": "[parameters('alertlist')[copyIndex()].alertType]"
                                          },
                                          "metricMeasureColumn": "[if(equals(parameters('alertlist')[copyIndex()].alertType, 'Aggregated'), createObject('value', parameters('alertlist')[copyIndex()].metricMeasureColumn), createObject('value', null()))]",
                                          "operator": "[if(equals(parameters('alertlist')[copyIndex()].alertType, 'Aggregated'), createObject('value', parameters('alertlist')[copyIndex()].operator), createObject('value', null()))]",
                                          "threshold": "[if(equals(parameters('alertlist')[copyIndex()].alertType, 'Aggregated'), createObject('value', parameters('alertlist')[copyIndex()].threshold), createObject('value', null()))]"
                                        },
                                        "template": {
                                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                          "contentVersion": "1.0.0.0",
                                          "metadata": {
                                            "_generator": {
                                              "name": "bicep",
                                              "version": "0.32.4.45862",
                                              "templateHash": "10159755056440989647"
                                            }
                                          },
                                          "parameters": {
                                            "alertType": {
                                              "type": "string",
                                              "allowedValues": [
                                                "rows",
                                                "Aggregated"
                                              ]
                                            },
                                            "alertRuleName": {
                                              "type": "string"
                                            },
                                            "alertRuleDisplayName": {
                                              "type": "string"
                                            },
                                            "alertRuleDescription": {
                                              "type": "string"
                                            },
                                            "scope": {
                                              "type": "string"
                                            },
                                            "actionGroupResourceId": {
                                              "type": "string"
                                            },
                                            "alertRuleSeverity": {
                                              "type": "int"
                                            },
                                            "location": {
                                              "type": "string"
                                            },
                                            "windowSize": {
                                              "type": "string",
                                              "defaultValue": "PT15M"
                                            },
                                            "evaluationFrequency": {
                                              "type": "string",
                                              "defaultValue": "PT15M"
                                            },
                                            "autoMitigate": {
                                              "type": "bool",
                                              "defaultValue": false
                                            },
                                            "query": {
                                              "type": "string"
                                            },
                                            "packtag": {
                                              "type": "string"
                                            },
                                            "Tags": {
                                              "type": "object"
                                            },
                                            "threshold": {
                                              "type": "int",
                                              "defaultValue": 0
                                            },
                                            "metricMeasureColumn": {
                                              "type": "string",
                                              "defaultValue": ""
                                            },
                                            "dimensions": {
                                              "type": "array",
                                              "defaultValue": [
                                                {
                                                  "name": "Computer",
                                                  "operator": "Include",
                                                  "values": [
                                                    "*"
                                                  ]
                                                }
                                              ]
                                            },
                                            "operator": {
                                              "type": "string",
                                              "defaultValue": "GreaterThan",
                                              "allowedValues": [
                                                "GreaterThan",
                                                "GreaterThanOrEqual",
                                                "LessThan",
                                                "LessThanOrEqual",
                                                "Equal",
                                                "NotEqual"
                                              ]
                                            }
                                          },
                                          "resources": [
                                            {
                                              "condition": "[equals(parameters('alertType'), 'rows')]",
                                              "type": "Microsoft.Resources/deployments",
                                              "apiVersion": "2022-09-01",
                                              "name": "[parameters('alertRuleName')]",
                                              "properties": {
                                                "expressionEvaluationOptions": {
                                                  "scope": "inner"
                                                },
                                                "mode": "Incremental",
                                                "parameters": {
                                                  "alertRuleName": {
                                                    "value": "[parameters('alertRuleName')]"
                                                  },
                                                  "alertRuleDisplayName": {
                                                    "value": "[parameters('alertRuleDisplayName')]"
                                                  },
                                                  "alertRuleDescription": {
                                                    "value": "[parameters('alertRuleDescription')]"
                                                  },
                                                  "scope": {
                                                    "value": "[parameters('scope')]"
                                                  },
                                                  "dimensions": {
                                                    "value": "[parameters('dimensions')]"
                                                  },
                                                  "actionGroupResourceId": {
                                                    "value": "[parameters('actionGroupResourceId')]"
                                                  },
                                                  "alertRuleSeverity": {
                                                    "value": "[parameters('alertRuleSeverity')]"
                                                  },
                                                  "location": {
                                                    "value": "[parameters('location')]"
                                                  },
                                                  "windowSize": {
                                                    "value": "[parameters('windowSize')]"
                                                  },
                                                  "evaluationFrequency": {
                                                    "value": "[parameters('evaluationFrequency')]"
                                                  },
                                                  "autoMitigate": {
                                                    "value": "[parameters('autoMitigate')]"
                                                  },
                                                  "query": {
                                                    "value": "[parameters('query')]"
                                                  },
                                                  "Tags": {
                                                    "value": "[parameters('Tags')]"
                                                  }
                                                },
                                                "template": {
                                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                                  "contentVersion": "1.0.0.0",
                                                  "metadata": {
                                                    "_generator": {
                                                      "name": "bicep",
                                                      "version": "0.32.4.45862",
                                                      "templateHash": "16566470716356207302"
                                                    }
                                                  },
                                                  "parameters": {
                                                    "alertRuleName": {
                                                      "type": "string"
                                                    },
                                                    "alertRuleDisplayName": {
                                                      "type": "string"
                                                    },
                                                    "alertRuleDescription": {
                                                      "type": "string"
                                                    },
                                                    "scope": {
                                                      "type": "string"
                                                    },
                                                    "actionGroupResourceId": {
                                                      "type": "string"
                                                    },
                                                    "alertRuleSeverity": {
                                                      "type": "int"
                                                    },
                                                    "location": {
                                                      "type": "string"
                                                    },
                                                    "windowSize": {
                                                      "type": "string",
                                                      "defaultValue": "PT15M"
                                                    },
                                                    "evaluationFrequency": {
                                                      "type": "string",
                                                      "defaultValue": "PT15M"
                                                    },
                                                    "autoMitigate": {
                                                      "type": "bool",
                                                      "defaultValue": false
                                                    },
                                                    "query": {
                                                      "type": "string"
                                                    },
                                                    "dimensions": {
                                                      "type": "array"
                                                    },
                                                    "Tags": {
                                                      "type": "object"
                                                    }
                                                  },
                                                  "resources": [
                                                    {
                                                      "type": "Microsoft.Insights/scheduledQueryRules",
                                                      "apiVersion": "2023-03-15-preview",
                                                      "name": "[parameters('alertRuleName')]",
                                                      "location": "[parameters('location')]",
                                                      "tags": "[parameters('Tags')]",
                                                      "properties": {
                                                        "description": "[parameters('alertRuleDescription')]",
                                                        "ruleResolveConfiguration": {},
                                                        "displayName": "[parameters('alertRuleDisplayName')]",
                                                        "enabled": true,
                                                        "scopes": [
                                                          "[parameters('scope')]"
                                                        ],
                                                        "targetResourceTypes": [
                                                          "Microsoft.OperationalInsights/workspaces"
                                                        ],
                                                        "windowSize": "[parameters('windowSize')]",
                                                        "evaluationFrequency": "[parameters('evaluationFrequency')]",
                                                        "severity": "[parameters('alertRuleSeverity')]",
                                                        "criteria": {
                                                          "allOf": [
                                                            {
                                                              "query": "[parameters('query')]",
                                                              "timeAggregation": "Count",
                                                              "dimensions": "[parameters('dimensions')]",
                                                              "resourceIdColumn": "[if(empty(parameters('dimensions')), '_ResourceId', null())]",
                                                              "operator": "GreaterThan",
                                                              "threshold": 0,
                                                              "failingPeriods": {
                                                                "numberOfEvaluationPeriods": 1,
                                                                "minFailingPeriodsToAlert": 1
                                                              }
                                                            }
                                                          ]
                                                        },
                                                        "autoMitigate": "[parameters('autoMitigate')]",
                                                        "actions": {
                                                          "actionGroups": [
                                                            "[parameters('actionGroupResourceId')]"
                                                          ],
                                                          "customProperties": {}
                                                        }
                                                      }
                                                    }
                                                  ]
                                                }
                                              }
                                            },
                                            {
                                              "condition": "[equals(parameters('alertType'), 'Aggregated')]",
                                              "type": "Microsoft.Resources/deployments",
                                              "apiVersion": "2022-09-01",
                                              "name": "[parameters('alertRuleName')]",
                                              "properties": {
                                                "expressionEvaluationOptions": {
                                                  "scope": "inner"
                                                },
                                                "mode": "Incremental",
                                                "parameters": {
                                                  "alertRuleName": {
                                                    "value": "[parameters('alertRuleName')]"
                                                  },
                                                  "alertRuleDisplayName": {
                                                    "value": "[parameters('alertRuleDisplayName')]"
                                                  },
                                                  "alertRuleDescription": {
                                                    "value": "[parameters('alertRuleDescription')]"
                                                  },
                                                  "scope": {
                                                    "value": "[parameters('scope')]"
                                                  },
                                                  "dimensions": {
                                                    "value": "[parameters('dimensions')]"
                                                  },
                                                  "actionGroupResourceId": {
                                                    "value": "[parameters('actionGroupResourceId')]"
                                                  },
                                                  "alertRuleSeverity": {
                                                    "value": "[parameters('alertRuleSeverity')]"
                                                  },
                                                  "location": {
                                                    "value": "[parameters('location')]"
                                                  },
                                                  "windowSize": {
                                                    "value": "[parameters('windowSize')]"
                                                  },
                                                  "evaluationFrequency": {
                                                    "value": "[parameters('evaluationFrequency')]"
                                                  },
                                                  "autoMitigate": {
                                                    "value": "[parameters('autoMitigate')]"
                                                  },
                                                  "query": {
                                                    "value": "[parameters('query')]"
                                                  },
                                                  "Tags": {
                                                    "value": "[parameters('Tags')]"
                                                  },
                                                  "threshold": {
                                                    "value": "[parameters('threshold')]"
                                                  },
                                                  "metricMeasureColumn": {
                                                    "value": "[parameters('metricMeasureColumn')]"
                                                  },
                                                  "operator": {
                                                    "value": "[parameters('operator')]"
                                                  }
                                                },
                                                "template": {
                                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                                  "contentVersion": "1.0.0.0",
                                                  "metadata": {
                                                    "_generator": {
                                                      "name": "bicep",
                                                      "version": "0.32.4.45862",
                                                      "templateHash": "18444959286864838274"
                                                    }
                                                  },
                                                  "parameters": {
                                                    "alertRuleName": {
                                                      "type": "string"
                                                    },
                                                    "alertRuleDisplayName": {
                                                      "type": "string"
                                                    },
                                                    "alertRuleDescription": {
                                                      "type": "string"
                                                    },
                                                    "scope": {
                                                      "type": "string"
                                                    },
                                                    "actionGroupResourceId": {
                                                      "type": "string"
                                                    },
                                                    "alertRuleSeverity": {
                                                      "type": "int"
                                                    },
                                                    "location": {
                                                      "type": "string"
                                                    },
                                                    "windowSize": {
                                                      "type": "string",
                                                      "defaultValue": "PT15M"
                                                    },
                                                    "evaluationFrequency": {
                                                      "type": "string",
                                                      "defaultValue": "PT15M"
                                                    },
                                                    "autoMitigate": {
                                                      "type": "bool",
                                                      "defaultValue": false
                                                    },
                                                    "query": {
                                                      "type": "string"
                                                    },
                                                    "dimensions": {
                                                      "type": "array"
                                                    },
                                                    "threshold": {
                                                      "type": "int"
                                                    },
                                                    "metricMeasureColumn": {
                                                      "type": "string"
                                                    },
                                                    "Tags": {
                                                      "type": "object"
                                                    },
                                                    "operator": {
                                                      "type": "string",
                                                      "allowedValues": [
                                                        "GreaterThan",
                                                        "GreaterThanOrEqual",
                                                        "LessThan",
                                                        "LessThanOrEqual",
                                                        "Equal",
                                                        "NotEqual"
                                                      ]
                                                    }
                                                  },
                                                  "resources": [
                                                    {
                                                      "type": "Microsoft.Insights/scheduledQueryRules",
                                                      "apiVersion": "2023-03-15-preview",
                                                      "name": "[parameters('alertRuleName')]",
                                                      "location": "[parameters('location')]",
                                                      "tags": "[parameters('Tags')]",
                                                      "properties": {
                                                        "description": "[parameters('alertRuleDescription')]",
                                                        "ruleResolveConfiguration": {},
                                                        "displayName": "[parameters('alertRuleDisplayName')]",
                                                        "enabled": true,
                                                        "scopes": [
                                                          "[parameters('scope')]"
                                                        ],
                                                        "targetResourceTypes": [
                                                          "Microsoft.OperationalInsights/workspaces"
                                                        ],
                                                        "windowSize": "[parameters('windowSize')]",
                                                        "evaluationFrequency": "[parameters('evaluationFrequency')]",
                                                        "severity": "[parameters('alertRuleSeverity')]",
                                                        "criteria": {
                                                          "allOf": [
                                                            {
                                                              "query": "[parameters('query')]",
                                                              "timeAggregation": "Average",
                                                              "metricMeasureColumn": "[parameters('metricMeasureColumn')]",
                                                              "dimensions": "[parameters('dimensions')]",
                                                              "resourceIdColumn": "[if(empty(parameters('dimensions')), '_ResourceId', null())]",
                                                              "operator": "[parameters('operator')]",
                                                              "threshold": "[parameters('threshold')]",
                                                              "failingPeriods": {
                                                                "numberOfEvaluationPeriods": 1,
                                                                "minFailingPeriodsToAlert": 1
                                                              }
                                                            }
                                                          ]
                                                        },
                                                        "autoMitigate": "[parameters('autoMitigate')]",
                                                        "actions": {
                                                          "actionGroups": [
                                                            "[parameters('actionGroupResourceId')]"
                                                          ],
                                                          "customProperties": {}
                                                        }
                                                      }
                                                    }
                                                  ]
                                                }
                                              }
                                            }
                                          ]
                                        }
                                      }
                                    }
                                  ]
                                }
                              }
                            }
                          ]
                        }
                      }
                    },
                    {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2022-09-01",
                      "name": "[format('dcrPerformance-{0}', parameters('packtag'))]",
                      "subscriptionId": "[parameters('subscriptionId')]",
                      "resourceGroup": "[variables('resourceGroupName')]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "location": {
                            "value": "[parameters('location')]"
                          },
                          "rulename": {
                            "value": "[variables('rulename')]"
                          },
                          "workspaceId": {
                            "value": "[parameters('workspaceId')]"
                          },
                          "wsfriendlyname": {
                            "value": "[variables('workspaceFriendlyName')]"
                          },
                          "kind": {
                            "value": "[variables('kind')]"
                          },
                          "xPathQueries": {
                            "value": "[variables('xPathQueries')]"
                          },
                          "counterSpecifiers": {
                            "value": "[variables('performanceCounters')]"
                          },
                          "Tags": {
                            "value": "[variables('Tags')]"
                          },
                          "dceId": {
                            "value": "[parameters('dceId')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.32.4.45862",
                              "templateHash": "15691414683408659274"
                            }
                          },
                          "parameters": {
                            "location": {
                              "type": "string"
                            },
                            "rulename": {
                              "type": "string"
                            },
                            "workspaceId": {
                              "type": "string"
                            },
                            "kind": {
                              "type": "string",
                              "defaultValue": "Windows"
                            },
                            "wsfriendlyname": {
                              "type": "string",
                              "defaultValue": "TBD"
                            },
                            "xPathQueries": {
                              "type": "array",
                              "defaultValue": []
                            },
                            "counterSpecifiers": {
                              "type": "array",
                              "defaultValue": []
                            },
                            "samplingFrequencyInSeconds": {
                              "type": "int",
                              "defaultValue": 300
                            },
                            "Tags": {
                              "type": "object"
                            },
                            "dceId": {
                              "type": "string"
                            }
                          },
                          "resources": [
                            {
                              "type": "Microsoft.Insights/dataCollectionRules",
                              "apiVersion": "2022-06-01",
                              "name": "[parameters('rulename')]",
                              "location": "[parameters('location')]",
                              "tags": "[parameters('Tags')]",
                              "kind": "[parameters('kind')]",
                              "properties": {
                                "dataCollectionEndpointId": "[parameters('dceId')]",
                                "description": "[format('Data Collection Rule for {0}}} - {1}}}', parameters('kind'), parameters('rulename'))]",
                                "destinations": {
                                  "logAnalytics": [
                                    {
                                      "workspaceResourceId": "[parameters('workspaceId')]",
                                      "name": "[parameters('wsfriendlyname')]"
                                    }
                                  ]
                                },
                                "dataSources": {
                                  "windowsEventLogs": "[if(empty(parameters('xPathQueries')), null(), createArray(createObject('streams', createArray('Microsoft-Event'), 'xPathQueries', parameters('xPathQueries'), 'name', 'EventLogsDataSource')))]",
                                  "performanceCounters": [
                                    {
                                      "streams": [
                                        "Microsoft-Perf"
                                      ],
                                      "samplingFrequencyInSeconds": "[parameters('samplingFrequencyInSeconds')]",
                                      "counterSpecifiers": "[parameters('counterSpecifiers')]",
                                      "name": "PerfCountersDataSource"
                                    }
                                  ]
                                },
                                "dataFlows": [
                                  {
                                    "streams": [
                                      "Microsoft-Event",
                                      "Microsoft-Perf"
                                    ],
                                    "destinations": [
                                      "[parameters('wsfriendlyname')]"
                                    ]
                                  }
                                ]
                              }
                            }
                          ],
                          "outputs": {
                            "dcrId": {
                              "type": "string",
                              "value": "[resourceId('Microsoft.Insights/dataCollectionRules', parameters('rulename'))]"
                            }
                          }
                        }
                      }
                    }
                  ]
                }
              }
            },
            {
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2022-09-01",
              "name": "[format('PS2016-deployment-{0}-{1}', parameters('instanceName'), parameters('location'))]",
              "location": "[deployment().location]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "dceId": {
                    "value": "[parameters('dceId')]"
                  },
                  "location": {
                    "value": "[parameters('location')]"
                  },
                  "resourceGroupId": {
                    "value": "[parameters('resourceGroupId')]"
                  },
                  "solutionTag": {
                    "value": "[parameters('solutionTag')]"
                  },
                  "solutionVersion": {
                    "value": "[parameters('solutionVersion')]"
                  },
                  "subscriptionId": {
                    "value": "[parameters('subscriptionId')]"
                  },
                  "userManagedIdentityResourceId": {
                    "value": "[parameters('userManagedIdentityResourceId')]"
                  },
                  "workspaceId": {
                    "value": "[parameters('workspaceId')]"
                  },
                  "customerTags": {
                    "value": "[parameters('customerTags')]"
                  },
                  "actionGroupResourceId": {
                    "value": "[parameters('actionGroupResourceId')]"
                  },
                  "instanceName": {
                    "value": "[parameters('instanceName')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2018-05-01/subscriptionDeploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.32.4.45862",
                      "templateHash": "14932330406794107409"
                    }
                  },
                  "parameters": {
                    "packtag": {
                      "type": "string",
                      "defaultValue": "PS2016",
                      "metadata": {
                        "description": "The tag to be used for the solution."
                      }
                    },
                    "actionGroupResourceId": {
                      "type": "string"
                    },
                    "location": {
                      "type": "string",
                      "metadata": {
                        "description": "location for the deployment."
                      }
                    },
                    "workspaceId": {
                      "type": "string",
                      "metadata": {
                        "description": "Full resource ID of the log analytics workspace to be used for the deployment."
                      }
                    },
                    "solutionTag": {
                      "type": "string"
                    },
                    "solutionVersion": {
                      "type": "string"
                    },
                    "dceId": {
                      "type": "string",
                      "metadata": {
                        "description": "Full resource ID of the data collection endpoint to be used for the deployment."
                      }
                    },
                    "userManagedIdentityResourceId": {
                      "type": "string",
                      "metadata": {
                        "description": "Full resource ID of the user managed identity to be used for the deployment"
                      }
                    },
                    "subscriptionId": {
                      "type": "string"
                    },
                    "resourceGroupId": {
                      "type": "string"
                    },
                    "customerTags": {
                      "type": "object"
                    },
                    "instanceName": {
                      "type": "string"
                    }
                  },
                  "variables": {
                    "rulename": "[format('AMP-{0}-{1}', parameters('instanceName'), parameters('packtag'))]",
                    "ruleshortname": "[format('AMP-{0}-{1}', parameters('instanceName'), parameters('packtag'))]",
                    "tempTags": {
                      "[format('{0}', parameters('solutionTag'))]": "[parameters('packtag')]",
                      "MonitoringPackType": "IaaS",
                      "solutionVersion": "[parameters('solutionVersion')]"
                    },
                    "Tags": "[if(equals(parameters('customerTags'), createObject()), variables('tempTags'), union(variables('tempTags'), parameters('customerTags').All))]",
                    "workspaceFriendlyName": "[split(parameters('workspaceId'), '/')[8]]",
                    "resourceGroupName": "[split(parameters('resourceGroupId'), '/')[4]]",
                    "kind": "Windows",
                    "xPathQueries": [
                      "Microsoft-Windows-PrintService/Admin!*[System[(EventID=83) and (Provider[@Name='Microsoft-Windows-PrintBRM' or @Name='PrintBrm'])]]",
                      "Microsoft-Windows-PrintService/Admin!*[System[(EventID=360) and (Provider[@Name='Microsoft-Windows-PrintService'])]]",
                      "Microsoft-Windows-PrintService/Operational!*[System[(EventID=701 or EventID=702 or EventID=703 or EventID=704) and (Provider[@Name='Microsoft-Windows-PrintService'])]]",
                      "Microsoft-Windows-PrintService/Admin!*[System[(EventID=364 or EventID=365 or EventID=367) and (Provider[@Name='Microsoft-Windows-PrintService'])]]",
                      "Microsoft-Windows-PrintService/Admin!*[System[(EventID=315) and (Provider[@Name='Microsoft-Windows-PrintService'])]]",
                      "Microsoft-Windows-PrintService/Admin!*[System[(EventID=371) and (Provider[@Name='Microsoft-Windows-PrintService'])]]",
                      "Microsoft-Windows-PrintService/Admin!*[System[(EventID=356) and (Provider[@Name='Microsoft-Windows-PrintService'])]]",
                      "Microsoft-Windows-PrintService/Admin!*[System[(EventID=513 or EventID=514) and (Provider[@Name='Microsoft-Windows-PrintService'])]]",
                      "Microsoft-Windows-PrintService/Admin!*[System[(EventID=600 or EventID=601) and (Provider[@Name='Microsoft-Windows-PrintService'])]]",
                      "Microsoft-Windows-PrintService/Admin!*[System[(EventID=515 or EventID=516 or EventID=517 or EventID=518 or EventID=519 or EventID=520) and (Provider[@Name='Microsoft-Windows-PrintService'])]]",
                      "Microsoft-Windows-PrintService/Admin!*[System[(EventID=502 or EventID=503 or EventID=504 or EventID=505 or EventID=506 or EventID=507 or EventID=508 or EventID=509 or EventID=510 or EventID=511 or EventID=512) and (Provider[@Name='Microsoft-Windows-PrintService'])]]"
                    ],
                    "performanceCounters": [
                      "\\Print Queue(_Total)\\Jobs",
                      "\\Print Queue(_Total)\\Jobs Spooling",
                      "\\Print Queue(_Total)\\Total Jobs Printed",
                      "\\Print Queue(_Total)\\Total Pages Printed"
                    ]
                  },
                  "resources": [
                    {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2022-09-01",
                      "name": "[format('dcrPerformance-{0}', parameters('packtag'))]",
                      "subscriptionId": "[parameters('subscriptionId')]",
                      "resourceGroup": "[variables('resourceGroupName')]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "location": {
                            "value": "[parameters('location')]"
                          },
                          "rulename": {
                            "value": "[variables('rulename')]"
                          },
                          "workspaceId": {
                            "value": "[parameters('workspaceId')]"
                          },
                          "wsfriendlyname": {
                            "value": "[variables('workspaceFriendlyName')]"
                          },
                          "kind": {
                            "value": "[variables('kind')]"
                          },
                          "xPathQueries": {
                            "value": "[variables('xPathQueries')]"
                          },
                          "counterSpecifiers": {
                            "value": "[variables('performanceCounters')]"
                          },
                          "Tags": {
                            "value": "[variables('Tags')]"
                          },
                          "dceId": {
                            "value": "[parameters('dceId')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.32.4.45862",
                              "templateHash": "15691414683408659274"
                            }
                          },
                          "parameters": {
                            "location": {
                              "type": "string"
                            },
                            "rulename": {
                              "type": "string"
                            },
                            "workspaceId": {
                              "type": "string"
                            },
                            "kind": {
                              "type": "string",
                              "defaultValue": "Windows"
                            },
                            "wsfriendlyname": {
                              "type": "string",
                              "defaultValue": "TBD"
                            },
                            "xPathQueries": {
                              "type": "array",
                              "defaultValue": []
                            },
                            "counterSpecifiers": {
                              "type": "array",
                              "defaultValue": []
                            },
                            "samplingFrequencyInSeconds": {
                              "type": "int",
                              "defaultValue": 300
                            },
                            "Tags": {
                              "type": "object"
                            },
                            "dceId": {
                              "type": "string"
                            }
                          },
                          "resources": [
                            {
                              "type": "Microsoft.Insights/dataCollectionRules",
                              "apiVersion": "2022-06-01",
                              "name": "[parameters('rulename')]",
                              "location": "[parameters('location')]",
                              "tags": "[parameters('Tags')]",
                              "kind": "[parameters('kind')]",
                              "properties": {
                                "dataCollectionEndpointId": "[parameters('dceId')]",
                                "description": "[format('Data Collection Rule for {0}}} - {1}}}', parameters('kind'), parameters('rulename'))]",
                                "destinations": {
                                  "logAnalytics": [
                                    {
                                      "workspaceResourceId": "[parameters('workspaceId')]",
                                      "name": "[parameters('wsfriendlyname')]"
                                    }
                                  ]
                                },
                                "dataSources": {
                                  "windowsEventLogs": "[if(empty(parameters('xPathQueries')), null(), createArray(createObject('streams', createArray('Microsoft-Event'), 'xPathQueries', parameters('xPathQueries'), 'name', 'EventLogsDataSource')))]",
                                  "performanceCounters": [
                                    {
                                      "streams": [
                                        "Microsoft-Perf"
                                      ],
                                      "samplingFrequencyInSeconds": "[parameters('samplingFrequencyInSeconds')]",
                                      "counterSpecifiers": "[parameters('counterSpecifiers')]",
                                      "name": "PerfCountersDataSource"
                                    }
                                  ]
                                },
                                "dataFlows": [
                                  {
                                    "streams": [
                                      "Microsoft-Event",
                                      "Microsoft-Perf"
                                    ],
                                    "destinations": [
                                      "[parameters('wsfriendlyname')]"
                                    ]
                                  }
                                ]
                              }
                            }
                          ],
                          "outputs": {
                            "dcrId": {
                              "type": "string",
                              "value": "[resourceId('Microsoft.Insights/dataCollectionRules', parameters('rulename'))]"
                            }
                          }
                        }
                      }
                    },
                    {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2022-09-01",
                      "name": "[format('Alerts-{0}', parameters('packtag'))]",
                      "subscriptionId": "[parameters('subscriptionId')]",
                      "resourceGroup": "[variables('resourceGroupName')]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "location": {
                            "value": "[parameters('location')]"
                          },
                          "workspaceId": {
                            "value": "[parameters('workspaceId')]"
                          },
                          "AGId": {
                            "value": "[parameters('actionGroupResourceId')]"
                          },
                          "packtag": {
                            "value": "[parameters('packtag')]"
                          },
                          "Tags": {
                            "value": "[variables('Tags')]"
                          },
                          "instanceName": {
                            "value": "[parameters('instanceName')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.32.4.45862",
                              "templateHash": "5768752023116223663"
                            }
                          },
                          "parameters": {
                            "location": {
                              "type": "string"
                            },
                            "workspaceId": {
                              "type": "string"
                            },
                            "AGId": {
                              "type": "string"
                            },
                            "packtag": {
                              "type": "string"
                            },
                            "Tags": {
                              "type": "object"
                            },
                            "instanceName": {
                              "type": "string"
                            }
                          },
                          "variables": {
                            "moduleprefix": "[format('AMP-{0}-{1}', parameters('instanceName'), parameters('packtag'))]",
                            "alertlist": [
                              {
                                "alertRuleDescription": "Ensure the server is accessible.",
                                "alertRuleDisplayName": "Ensure the server is accessible.",
                                "alertRuleName": "AlertRule-PS-2016-1",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (83) and EventLog == 'Microsoft-Windows-PrintService/Admin' and (Source == 'Microsoft-Windows-PrintBRM' or Source == 'PrintBrm')"
                              },
                              {
                                "alertRuleDescription": "Manually install the color profile.",
                                "alertRuleDisplayName": "Manually install the color profile.",
                                "alertRuleName": "AlertRule-PS-2016-2",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (360) and EventLog == 'Microsoft-Windows-PrintService/Admin' and Source == 'Microsoft-Windows-PrintService'"
                              },
                              {
                                "alertRuleDescription": "Retry printing or restart the print server.",
                                "alertRuleDisplayName": "Retry printing or restart the print server.",
                                "alertRuleName": "AlertRule-PS-2016-3",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (701,702,703,704) and EventLog == 'Microsoft-Windows-PrintService/Operational!*' and Source == 'Microsoft-Windows-PrintService'"
                              },
                              {
                                "alertRuleDescription": "Install the Printer Driver.",
                                "alertRuleDisplayName": "Install the Printer Driver.",
                                "alertRuleName": "AlertRule-PS-2016-4",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (364,365,367) and EventLog == 'Microsoft-Windows-PrintService/Admin' and Source == 'Microsoft-Windows-PrintService'"
                              },
                              {
                                "alertRuleDescription": "Restart the print spooler fix sharing problems and check Group Policy.",
                                "alertRuleDisplayName": "Restart the print spooler fix sharing problems and check Group Policy.",
                                "alertRuleName": "AlertRule-PS-2016-5",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (315) and EventLog == 'Microsoft-Windows-PrintService/Admin' and Source == 'Microsoft-Windows-PrintService'"
                              },
                              {
                                "alertRuleDescription": "Restart the print spooler and unshare the printer.",
                                "alertRuleDisplayName": "Restart the print spooler and unshare the printer.",
                                "alertRuleName": "AlertRule-PS-2016-6",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (371) and EventLog == 'Microsoft-Windows-PrintService/Admin' and Source == 'Microsoft-Windows-PrintService'"
                              },
                              {
                                "alertRuleDescription": "Update the printer driver.",
                                "alertRuleDisplayName": "Update the printer driver.",
                                "alertRuleName": "AlertRule-PS-2016-7",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (356) and EventLog == 'Microsoft-Windows-PrintService/Admin' and Source == 'Microsoft-Windows-PrintService'"
                              },
                              {
                                "alertRuleDescription": "Check Group Policy and network connectivity.",
                                "alertRuleDisplayName": "Check Group Policy and network connectivity.",
                                "alertRuleName": "AlertRule-PS-2016-8",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (513,514) and EventLog == 'Microsoft-Windows-PrintService/Admin' and Source == 'Microsoft-Windows-PrintService'"
                              },
                              {
                                "alertRuleDescription": "Try again or install an updated printer driver.",
                                "alertRuleDisplayName": "Try again or install an updated printer driver.",
                                "alertRuleName": "AlertRule-PS-2016-9",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (600,601) and EventLog == 'Microsoft-Windows-PrintService/Admin' and Source == 'Microsoft-Windows-PrintService'"
                              },
                              {
                                "alertRuleDescription": "Check network connectivity and Group Policy.",
                                "alertRuleDisplayName": "Check network connectivity and Group Policy.",
                                "alertRuleName": "AlertRule-PS-2016-10",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (515,516,517,518,519,520) and EventLog == 'Microsoft-Windows-PrintService/Admin' and Source == 'Microsoft-Windows-PrintService'"
                              },
                              {
                                "alertRuleDescription": "Check resource availability.",
                                "alertRuleDisplayName": "Check resource availability.",
                                "alertRuleName": "AlertRule-PS-2016-11",
                                "alertRuleSeverity": 2,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Event | where  EventID in (502,503,504,505,506,507,508,509,510,511,512) and EventLog == 'Microsoft-Windows-PrintService/Admin' and Source == 'Microsoft-Windows-PrintService'"
                              }
                            ]
                          },
                          "resources": [
                            {
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "[format('{0}-Alerts', variables('moduleprefix'))]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "alertlist": {
                                    "value": "[variables('alertlist')]"
                                  },
                                  "AGId": {
                                    "value": "[parameters('AGId')]"
                                  },
                                  "location": {
                                    "value": "[parameters('location')]"
                                  },
                                  "moduleprefix": {
                                    "value": "[variables('moduleprefix')]"
                                  },
                                  "packtag": {
                                    "value": "[parameters('packtag')]"
                                  },
                                  "Tags": {
                                    "value": "[parameters('Tags')]"
                                  },
                                  "workspaceId": {
                                    "value": "[parameters('workspaceId')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.32.4.45862",
                                      "templateHash": "17858688129795365440"
                                    }
                                  },
                                  "parameters": {
                                    "alertlist": {
                                      "type": "array"
                                    },
                                    "location": {
                                      "type": "string"
                                    },
                                    "workspaceId": {
                                      "type": "string"
                                    },
                                    "AGId": {
                                      "type": "string"
                                    },
                                    "packtag": {
                                      "type": "string"
                                    },
                                    "Tags": {
                                      "type": "object"
                                    },
                                    "moduleprefix": {
                                      "type": "string"
                                    }
                                  },
                                  "resources": [
                                    {
                                      "copy": {
                                        "name": "Alerts",
                                        "count": "[length(parameters('alertlist'))]"
                                      },
                                      "type": "Microsoft.Resources/deployments",
                                      "apiVersion": "2022-09-01",
                                      "name": "[format('{0}-Alert-{1}', parameters('packtag'), copyIndex())]",
                                      "properties": {
                                        "expressionEvaluationOptions": {
                                          "scope": "inner"
                                        },
                                        "mode": "Incremental",
                                        "parameters": {
                                          "location": {
                                            "value": "[parameters('location')]"
                                          },
                                          "actionGroupResourceId": {
                                            "value": "[parameters('AGId')]"
                                          },
                                          "alertRuleDescription": {
                                            "value": "[parameters('alertlist')[copyIndex()].alertRuleDescription]"
                                          },
                                          "alertRuleDisplayName": {
                                            "value": "[format('{0}-{1}', parameters('moduleprefix'), parameters('alertlist')[copyIndex()].alertRuleDisplayName)]"
                                          },
                                          "alertRuleName": {
                                            "value": "[format('{0}-{1}', parameters('moduleprefix'), parameters('alertlist')[copyIndex()].alertRuleName)]"
                                          },
                                          "alertRuleSeverity": {
                                            "value": "[parameters('alertlist')[copyIndex()].alertRuleSeverity]"
                                          },
                                          "autoMitigate": {
                                            "value": "[parameters('alertlist')[copyIndex()].autoMitigate]"
                                          },
                                          "evaluationFrequency": {
                                            "value": "[parameters('alertlist')[copyIndex()].evaluationFrequency]"
                                          },
                                          "windowSize": {
                                            "value": "[parameters('alertlist')[copyIndex()].windowSize]"
                                          },
                                          "scope": {
                                            "value": "[parameters('workspaceId')]"
                                          },
                                          "query": {
                                            "value": "[parameters('alertlist')[copyIndex()].query]"
                                          },
                                          "dimensions": "[if(contains(parameters('alertlist')[copyIndex()], 'dimensions'), createObject('value', parameters('alertlist')[copyIndex()].dimensions), createObject('value', null()))]",
                                          "packtag": {
                                            "value": "[parameters('packtag')]"
                                          },
                                          "Tags": {
                                            "value": "[parameters('Tags')]"
                                          },
                                          "alertType": {
                                            "value": "[parameters('alertlist')[copyIndex()].alertType]"
                                          },
                                          "metricMeasureColumn": "[if(equals(parameters('alertlist')[copyIndex()].alertType, 'Aggregated'), createObject('value', parameters('alertlist')[copyIndex()].metricMeasureColumn), createObject('value', null()))]",
                                          "operator": "[if(equals(parameters('alertlist')[copyIndex()].alertType, 'Aggregated'), createObject('value', parameters('alertlist')[copyIndex()].operator), createObject('value', null()))]",
                                          "threshold": "[if(equals(parameters('alertlist')[copyIndex()].alertType, 'Aggregated'), createObject('value', parameters('alertlist')[copyIndex()].threshold), createObject('value', null()))]"
                                        },
                                        "template": {
                                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                          "contentVersion": "1.0.0.0",
                                          "metadata": {
                                            "_generator": {
                                              "name": "bicep",
                                              "version": "0.32.4.45862",
                                              "templateHash": "10159755056440989647"
                                            }
                                          },
                                          "parameters": {
                                            "alertType": {
                                              "type": "string",
                                              "allowedValues": [
                                                "rows",
                                                "Aggregated"
                                              ]
                                            },
                                            "alertRuleName": {
                                              "type": "string"
                                            },
                                            "alertRuleDisplayName": {
                                              "type": "string"
                                            },
                                            "alertRuleDescription": {
                                              "type": "string"
                                            },
                                            "scope": {
                                              "type": "string"
                                            },
                                            "actionGroupResourceId": {
                                              "type": "string"
                                            },
                                            "alertRuleSeverity": {
                                              "type": "int"
                                            },
                                            "location": {
                                              "type": "string"
                                            },
                                            "windowSize": {
                                              "type": "string",
                                              "defaultValue": "PT15M"
                                            },
                                            "evaluationFrequency": {
                                              "type": "string",
                                              "defaultValue": "PT15M"
                                            },
                                            "autoMitigate": {
                                              "type": "bool",
                                              "defaultValue": false
                                            },
                                            "query": {
                                              "type": "string"
                                            },
                                            "packtag": {
                                              "type": "string"
                                            },
                                            "Tags": {
                                              "type": "object"
                                            },
                                            "threshold": {
                                              "type": "int",
                                              "defaultValue": 0
                                            },
                                            "metricMeasureColumn": {
                                              "type": "string",
                                              "defaultValue": ""
                                            },
                                            "dimensions": {
                                              "type": "array",
                                              "defaultValue": [
                                                {
                                                  "name": "Computer",
                                                  "operator": "Include",
                                                  "values": [
                                                    "*"
                                                  ]
                                                }
                                              ]
                                            },
                                            "operator": {
                                              "type": "string",
                                              "defaultValue": "GreaterThan",
                                              "allowedValues": [
                                                "GreaterThan",
                                                "GreaterThanOrEqual",
                                                "LessThan",
                                                "LessThanOrEqual",
                                                "Equal",
                                                "NotEqual"
                                              ]
                                            }
                                          },
                                          "resources": [
                                            {
                                              "condition": "[equals(parameters('alertType'), 'rows')]",
                                              "type": "Microsoft.Resources/deployments",
                                              "apiVersion": "2022-09-01",
                                              "name": "[parameters('alertRuleName')]",
                                              "properties": {
                                                "expressionEvaluationOptions": {
                                                  "scope": "inner"
                                                },
                                                "mode": "Incremental",
                                                "parameters": {
                                                  "alertRuleName": {
                                                    "value": "[parameters('alertRuleName')]"
                                                  },
                                                  "alertRuleDisplayName": {
                                                    "value": "[parameters('alertRuleDisplayName')]"
                                                  },
                                                  "alertRuleDescription": {
                                                    "value": "[parameters('alertRuleDescription')]"
                                                  },
                                                  "scope": {
                                                    "value": "[parameters('scope')]"
                                                  },
                                                  "dimensions": {
                                                    "value": "[parameters('dimensions')]"
                                                  },
                                                  "actionGroupResourceId": {
                                                    "value": "[parameters('actionGroupResourceId')]"
                                                  },
                                                  "alertRuleSeverity": {
                                                    "value": "[parameters('alertRuleSeverity')]"
                                                  },
                                                  "location": {
                                                    "value": "[parameters('location')]"
                                                  },
                                                  "windowSize": {
                                                    "value": "[parameters('windowSize')]"
                                                  },
                                                  "evaluationFrequency": {
                                                    "value": "[parameters('evaluationFrequency')]"
                                                  },
                                                  "autoMitigate": {
                                                    "value": "[parameters('autoMitigate')]"
                                                  },
                                                  "query": {
                                                    "value": "[parameters('query')]"
                                                  },
                                                  "Tags": {
                                                    "value": "[parameters('Tags')]"
                                                  }
                                                },
                                                "template": {
                                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                                  "contentVersion": "1.0.0.0",
                                                  "metadata": {
                                                    "_generator": {
                                                      "name": "bicep",
                                                      "version": "0.32.4.45862",
                                                      "templateHash": "16566470716356207302"
                                                    }
                                                  },
                                                  "parameters": {
                                                    "alertRuleName": {
                                                      "type": "string"
                                                    },
                                                    "alertRuleDisplayName": {
                                                      "type": "string"
                                                    },
                                                    "alertRuleDescription": {
                                                      "type": "string"
                                                    },
                                                    "scope": {
                                                      "type": "string"
                                                    },
                                                    "actionGroupResourceId": {
                                                      "type": "string"
                                                    },
                                                    "alertRuleSeverity": {
                                                      "type": "int"
                                                    },
                                                    "location": {
                                                      "type": "string"
                                                    },
                                                    "windowSize": {
                                                      "type": "string",
                                                      "defaultValue": "PT15M"
                                                    },
                                                    "evaluationFrequency": {
                                                      "type": "string",
                                                      "defaultValue": "PT15M"
                                                    },
                                                    "autoMitigate": {
                                                      "type": "bool",
                                                      "defaultValue": false
                                                    },
                                                    "query": {
                                                      "type": "string"
                                                    },
                                                    "dimensions": {
                                                      "type": "array"
                                                    },
                                                    "Tags": {
                                                      "type": "object"
                                                    }
                                                  },
                                                  "resources": [
                                                    {
                                                      "type": "Microsoft.Insights/scheduledQueryRules",
                                                      "apiVersion": "2023-03-15-preview",
                                                      "name": "[parameters('alertRuleName')]",
                                                      "location": "[parameters('location')]",
                                                      "tags": "[parameters('Tags')]",
                                                      "properties": {
                                                        "description": "[parameters('alertRuleDescription')]",
                                                        "ruleResolveConfiguration": {},
                                                        "displayName": "[parameters('alertRuleDisplayName')]",
                                                        "enabled": true,
                                                        "scopes": [
                                                          "[parameters('scope')]"
                                                        ],
                                                        "targetResourceTypes": [
                                                          "Microsoft.OperationalInsights/workspaces"
                                                        ],
                                                        "windowSize": "[parameters('windowSize')]",
                                                        "evaluationFrequency": "[parameters('evaluationFrequency')]",
                                                        "severity": "[parameters('alertRuleSeverity')]",
                                                        "criteria": {
                                                          "allOf": [
                                                            {
                                                              "query": "[parameters('query')]",
                                                              "timeAggregation": "Count",
                                                              "dimensions": "[parameters('dimensions')]",
                                                              "resourceIdColumn": "[if(empty(parameters('dimensions')), '_ResourceId', null())]",
                                                              "operator": "GreaterThan",
                                                              "threshold": 0,
                                                              "failingPeriods": {
                                                                "numberOfEvaluationPeriods": 1,
                                                                "minFailingPeriodsToAlert": 1
                                                              }
                                                            }
                                                          ]
                                                        },
                                                        "autoMitigate": "[parameters('autoMitigate')]",
                                                        "actions": {
                                                          "actionGroups": [
                                                            "[parameters('actionGroupResourceId')]"
                                                          ],
                                                          "customProperties": {}
                                                        }
                                                      }
                                                    }
                                                  ]
                                                }
                                              }
                                            },
                                            {
                                              "condition": "[equals(parameters('alertType'), 'Aggregated')]",
                                              "type": "Microsoft.Resources/deployments",
                                              "apiVersion": "2022-09-01",
                                              "name": "[parameters('alertRuleName')]",
                                              "properties": {
                                                "expressionEvaluationOptions": {
                                                  "scope": "inner"
                                                },
                                                "mode": "Incremental",
                                                "parameters": {
                                                  "alertRuleName": {
                                                    "value": "[parameters('alertRuleName')]"
                                                  },
                                                  "alertRuleDisplayName": {
                                                    "value": "[parameters('alertRuleDisplayName')]"
                                                  },
                                                  "alertRuleDescription": {
                                                    "value": "[parameters('alertRuleDescription')]"
                                                  },
                                                  "scope": {
                                                    "value": "[parameters('scope')]"
                                                  },
                                                  "dimensions": {
                                                    "value": "[parameters('dimensions')]"
                                                  },
                                                  "actionGroupResourceId": {
                                                    "value": "[parameters('actionGroupResourceId')]"
                                                  },
                                                  "alertRuleSeverity": {
                                                    "value": "[parameters('alertRuleSeverity')]"
                                                  },
                                                  "location": {
                                                    "value": "[parameters('location')]"
                                                  },
                                                  "windowSize": {
                                                    "value": "[parameters('windowSize')]"
                                                  },
                                                  "evaluationFrequency": {
                                                    "value": "[parameters('evaluationFrequency')]"
                                                  },
                                                  "autoMitigate": {
                                                    "value": "[parameters('autoMitigate')]"
                                                  },
                                                  "query": {
                                                    "value": "[parameters('query')]"
                                                  },
                                                  "Tags": {
                                                    "value": "[parameters('Tags')]"
                                                  },
                                                  "threshold": {
                                                    "value": "[parameters('threshold')]"
                                                  },
                                                  "metricMeasureColumn": {
                                                    "value": "[parameters('metricMeasureColumn')]"
                                                  },
                                                  "operator": {
                                                    "value": "[parameters('operator')]"
                                                  }
                                                },
                                                "template": {
                                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                                  "contentVersion": "1.0.0.0",
                                                  "metadata": {
                                                    "_generator": {
                                                      "name": "bicep",
                                                      "version": "0.32.4.45862",
                                                      "templateHash": "18444959286864838274"
                                                    }
                                                  },
                                                  "parameters": {
                                                    "alertRuleName": {
                                                      "type": "string"
                                                    },
                                                    "alertRuleDisplayName": {
                                                      "type": "string"
                                                    },
                                                    "alertRuleDescription": {
                                                      "type": "string"
                                                    },
                                                    "scope": {
                                                      "type": "string"
                                                    },
                                                    "actionGroupResourceId": {
                                                      "type": "string"
                                                    },
                                                    "alertRuleSeverity": {
                                                      "type": "int"
                                                    },
                                                    "location": {
                                                      "type": "string"
                                                    },
                                                    "windowSize": {
                                                      "type": "string",
                                                      "defaultValue": "PT15M"
                                                    },
                                                    "evaluationFrequency": {
                                                      "type": "string",
                                                      "defaultValue": "PT15M"
                                                    },
                                                    "autoMitigate": {
                                                      "type": "bool",
                                                      "defaultValue": false
                                                    },
                                                    "query": {
                                                      "type": "string"
                                                    },
                                                    "dimensions": {
                                                      "type": "array"
                                                    },
                                                    "threshold": {
                                                      "type": "int"
                                                    },
                                                    "metricMeasureColumn": {
                                                      "type": "string"
                                                    },
                                                    "Tags": {
                                                      "type": "object"
                                                    },
                                                    "operator": {
                                                      "type": "string",
                                                      "allowedValues": [
                                                        "GreaterThan",
                                                        "GreaterThanOrEqual",
                                                        "LessThan",
                                                        "LessThanOrEqual",
                                                        "Equal",
                                                        "NotEqual"
                                                      ]
                                                    }
                                                  },
                                                  "resources": [
                                                    {
                                                      "type": "Microsoft.Insights/scheduledQueryRules",
                                                      "apiVersion": "2023-03-15-preview",
                                                      "name": "[parameters('alertRuleName')]",
                                                      "location": "[parameters('location')]",
                                                      "tags": "[parameters('Tags')]",
                                                      "properties": {
                                                        "description": "[parameters('alertRuleDescription')]",
                                                        "ruleResolveConfiguration": {},
                                                        "displayName": "[parameters('alertRuleDisplayName')]",
                                                        "enabled": true,
                                                        "scopes": [
                                                          "[parameters('scope')]"
                                                        ],
                                                        "targetResourceTypes": [
                                                          "Microsoft.OperationalInsights/workspaces"
                                                        ],
                                                        "windowSize": "[parameters('windowSize')]",
                                                        "evaluationFrequency": "[parameters('evaluationFrequency')]",
                                                        "severity": "[parameters('alertRuleSeverity')]",
                                                        "criteria": {
                                                          "allOf": [
                                                            {
                                                              "query": "[parameters('query')]",
                                                              "timeAggregation": "Average",
                                                              "metricMeasureColumn": "[parameters('metricMeasureColumn')]",
                                                              "dimensions": "[parameters('dimensions')]",
                                                              "resourceIdColumn": "[if(empty(parameters('dimensions')), '_ResourceId', null())]",
                                                              "operator": "[parameters('operator')]",
                                                              "threshold": "[parameters('threshold')]",
                                                              "failingPeriods": {
                                                                "numberOfEvaluationPeriods": 1,
                                                                "minFailingPeriodsToAlert": 1
                                                              }
                                                            }
                                                          ]
                                                        },
                                                        "autoMitigate": "[parameters('autoMitigate')]",
                                                        "actions": {
                                                          "actionGroups": [
                                                            "[parameters('actionGroupResourceId')]"
                                                          ],
                                                          "customProperties": {}
                                                        }
                                                      }
                                                    }
                                                  ]
                                                }
                                              }
                                            }
                                          ]
                                        }
                                      }
                                    }
                                  ]
                                }
                              }
                            }
                          ]
                        }
                      }
                    }
                  ]
                }
              }
            },
            {
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2022-09-01",
              "name": "[format('Nginx-deployment-{0}-{1}', parameters('instanceName'), parameters('location'))]",
              "location": "[deployment().location]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "dceId": {
                    "value": "[parameters('dceId')]"
                  },
                  "location": {
                    "value": "[parameters('location')]"
                  },
                  "resourceGroupId": {
                    "value": "[parameters('resourceGroupId')]"
                  },
                  "solutionTag": {
                    "value": "[parameters('solutionTag')]"
                  },
                  "solutionVersion": {
                    "value": "[parameters('solutionVersion')]"
                  },
                  "subscriptionId": {
                    "value": "[parameters('subscriptionId')]"
                  },
                  "userManagedIdentityResourceId": {
                    "value": "[parameters('userManagedIdentityResourceId')]"
                  },
                  "workspaceId": {
                    "value": "[parameters('workspaceId')]"
                  },
                  "customerTags": {
                    "value": "[parameters('customerTags')]"
                  },
                  "actionGroupResourceId": {
                    "value": "[parameters('actionGroupResourceId')]"
                  },
                  "instanceName": {
                    "value": "[parameters('instanceName')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2018-05-01/subscriptionDeploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.32.4.45862",
                      "templateHash": "15723327484299479063"
                    }
                  },
                  "parameters": {
                    "actionGroupResourceId": {
                      "type": "string"
                    },
                    "location": {
                      "type": "string",
                      "metadata": {
                        "description": "location for the deployment."
                      }
                    },
                    "workspaceId": {
                      "type": "string",
                      "metadata": {
                        "description": "Full resource ID of the log analytics workspace to be used for the deployment."
                      }
                    },
                    "packtag": {
                      "type": "string",
                      "defaultValue": "Nginx"
                    },
                    "solutionTag": {
                      "type": "string"
                    },
                    "solutionVersion": {
                      "type": "string"
                    },
                    "dceId": {
                      "type": "string",
                      "metadata": {
                        "description": "Full resource ID of the data collection endpoint to be used for the deployment."
                      }
                    },
                    "userManagedIdentityResourceId": {
                      "type": "string",
                      "metadata": {
                        "description": "Full resource ID of the user managed identity to be used for the deployment"
                      }
                    },
                    "subscriptionId": {
                      "type": "string"
                    },
                    "resourceGroupId": {
                      "type": "string"
                    },
                    "customerTags": {
                      "type": "object"
                    },
                    "instanceName": {
                      "type": "string"
                    }
                  },
                  "variables": {
                    "tableName": "NginxLogs",
                    "tableNameToUse": "[format('{0}_CL', variables('tableName'))]",
                    "lawFriendlyName": "[split(parameters('workspaceId'), '/')[8]]",
                    "rulename": "[format('AMP-{0}-{1}', parameters('instanceName'), parameters('packtag'))]",
                    "ruleshortname": "[format('AMP-{0}-{1}', parameters('instanceName'), parameters('packtag'))]",
                    "tempTags": {
                      "[format('{0}', parameters('solutionTag'))]": "[parameters('packtag')]",
                      "MonitoringPackType": "IaaS",
                      "solutionVersion": "[parameters('solutionVersion')]"
                    },
                    "filePatterns": [
                      "/var/log/nginx/access.log",
                      "/var/log/nginx/error.log"
                    ],
                    "Tags": "[if(equals(parameters('customerTags'), createObject()), variables('tempTags'), union(variables('tempTags'), parameters('customerTags').All))]",
                    "resourceGroupName": "[split(parameters('resourceGroupId'), '/')[4]]",
                    "lawResourceGroup": "[split(parameters('workspaceId'), '/')[4]]",
                    "facilityNames": [
                      "daemon"
                    ],
                    "logLevels": [
                      "Debug",
                      "Info",
                      "Notice",
                      "Warning",
                      "Error",
                      "Critical",
                      "Alert",
                      "Emergency"
                    ]
                  },
                  "resources": [
                    {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2022-09-01",
                      "name": "[variables('tableName')]",
                      "subscriptionId": "[parameters('subscriptionId')]",
                      "resourceGroup": "[variables('lawResourceGroup')]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "parentname": {
                            "value": "[variables('lawFriendlyName')]"
                          },
                          "tableName": {
                            "value": "[variables('tableNameToUse')]"
                          },
                          "retentionDays": {
                            "value": 31
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.32.4.45862",
                              "templateHash": "2081426938105913058"
                            }
                          },
                          "parameters": {
                            "parentname": {
                              "type": "string"
                            },
                            "tableName": {
                              "type": "string"
                            },
                            "retentionDays": {
                              "type": "int",
                              "defaultValue": 31
                            }
                          },
                          "resources": [
                            {
                              "type": "Microsoft.OperationalInsights/workspaces/tables",
                              "apiVersion": "2022-10-01",
                              "name": "[format('{0}/{1}', parameters('parentname'), parameters('tableName'))]",
                              "properties": {
                                "totalRetentionInDays": "[parameters('retentionDays')]",
                                "plan": "Analytics",
                                "schema": {
                                  "name": "[parameters('tableName')]",
                                  "columns": [
                                    {
                                      "name": "TimeGenerated",
                                      "type": "datetime"
                                    },
                                    {
                                      "name": "RawData",
                                      "type": "string"
                                    }
                                  ]
                                },
                                "retentionInDays": "[parameters('retentionDays')]"
                              }
                            }
                          ]
                        }
                      }
                    },
                    {
                      "copy": {
                        "name": "fileCollectionRule",
                        "count": "[length(variables('filePatterns'))]"
                      },
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2022-09-01",
                      "name": "[format('filecollectionrule-{0}-{1}', parameters('packtag'), copyIndex())]",
                      "subscriptionId": "[parameters('subscriptionId')]",
                      "resourceGroup": "[variables('resourceGroupName')]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "location": {
                            "value": "[parameters('location')]"
                          },
                          "endpointResourceId": {
                            "value": "[parameters('dceId')]"
                          },
                          "Tags": {
                            "value": "[variables('Tags')]"
                          },
                          "ruleName": {
                            "value": "[format('{0}-{1}', variables('rulename'), copyIndex())]"
                          },
                          "filepatterns": {
                            "value": [
                              "[variables('filePatterns')[copyIndex()]]"
                            ]
                          },
                          "lawResourceId": {
                            "value": "[parameters('workspaceId')]"
                          },
                          "tableName": {
                            "value": "[variables('tableNameToUse')]"
                          },
                          "facilityNames": {
                            "value": "[variables('facilityNames')]"
                          },
                          "logLevels": {
                            "value": "[variables('logLevels')]"
                          },
                          "syslogDataSourceName": {
                            "value": "NginxLogs-1238219"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.32.4.45862",
                              "templateHash": "1791385127478685010"
                            }
                          },
                          "parameters": {
                            "ruleName": {
                              "type": "string",
                              "metadata": {
                                "description": "Specifies the name of the data collection rule to create."
                              }
                            },
                            "endpointResourceId": {
                              "type": "string",
                              "metadata": {
                                "description": "Specifies the resource id of the data collection endpoint."
                              }
                            },
                            "tableName": {
                              "type": "string",
                              "metadata": {
                                "description": "Name of the table."
                              }
                            },
                            "location": {
                              "type": "string",
                              "metadata": {
                                "description": "Specifies the location in which to create the data collection rule."
                              }
                            },
                            "filepatterns": {
                              "type": "array"
                            },
                            "lawResourceId": {
                              "type": "string"
                            },
                            "Tags": {
                              "type": "object"
                            },
                            "facilityNames": {
                              "type": "array"
                            },
                            "logLevels": {
                              "type": "array"
                            },
                            "syslogDataSourceName": {
                              "type": "string",
                              "defaultValue": "sysLogsDataSource-1688419672"
                            }
                          },
                          "variables": {
                            "streamName": "[format('Custom-{0}', parameters('tableName'))]",
                            "lawFriendlyName": "[split(parameters('lawResourceId'), '/')[8]]"
                          },
                          "resources": [
                            {
                              "type": "Microsoft.Insights/dataCollectionRules",
                              "apiVersion": "2022-06-01",
                              "name": "[parameters('ruleName')]",
                              "location": "[parameters('location')]",
                              "tags": "[parameters('Tags')]",
                              "kind": "Linux",
                              "properties": {
                                "dataSources": {
                                  "syslog": [
                                    {
                                      "streams": [
                                        "Microsoft-Syslog"
                                      ],
                                      "facilityNames": "[parameters('facilityNames')]",
                                      "logLevels": "[parameters('logLevels')]",
                                      "name": "[parameters('syslogDataSourceName')]"
                                    }
                                  ],
                                  "logFiles": [
                                    {
                                      "streams": [
                                        "[variables('streamName')]"
                                      ],
                                      "filePatterns": "[parameters('filepatterns')]",
                                      "format": "text",
                                      "settings": {
                                        "text": {
                                          "recordStartTimestampFormat": "ISO 8601"
                                        }
                                      },
                                      "name": "[parameters('tableName')]"
                                    }
                                  ]
                                },
                                "destinations": {
                                  "logAnalytics": [
                                    {
                                      "workspaceResourceId": "[parameters('lawResourceId')]",
                                      "name": "[variables('lawFriendlyName')]"
                                    }
                                  ]
                                },
                                "dataFlows": [
                                  {
                                    "streams": [
                                      "Microsoft-Syslog"
                                    ],
                                    "destinations": [
                                      "[variables('lawFriendlyName')]"
                                    ],
                                    "transformKql": "source | where SyslogMessage == \"Stopped A high performance web server and a reverse proxy server.\" or SyslogMessage == \"Started A high performance web server and a reverse proxy server.\"",
                                    "outputStream": "Microsoft-Syslog"
                                  },
                                  {
                                    "streams": [
                                      "[variables('streamName')]"
                                    ],
                                    "destinations": [
                                      "[variables('lawFriendlyName')]"
                                    ],
                                    "transformKql": "source",
                                    "outputStream": "[variables('streamName')]"
                                  }
                                ],
                                "dataCollectionEndpointId": "[parameters('endpointResourceId')]",
                                "streamDeclarations": {
                                  "[format('{0}', variables('streamName'))]": {
                                    "columns": [
                                      {
                                        "name": "TimeGenerated",
                                        "type": "datetime"
                                      },
                                      {
                                        "name": "RawData",
                                        "type": "string"
                                      }
                                    ]
                                  }
                                }
                              }
                            }
                          ],
                          "outputs": {
                            "ruleId": {
                              "type": "string",
                              "value": "[resourceId('Microsoft.Insights/dataCollectionRules', parameters('ruleName'))]"
                            }
                          }
                        }
                      },
                      "dependsOn": [
                        "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', parameters('subscriptionId'), variables('lawResourceGroup')), 'Microsoft.Resources/deployments', variables('tableName'))]"
                      ]
                    },
                    {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2022-09-01",
                      "name": "[format('Alerts-{0}', parameters('packtag'))]",
                      "subscriptionId": "[parameters('subscriptionId')]",
                      "resourceGroup": "[variables('resourceGroupName')]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "location": {
                            "value": "[parameters('location')]"
                          },
                          "workspaceId": {
                            "value": "[parameters('workspaceId')]"
                          },
                          "AGId": {
                            "value": "[parameters('actionGroupResourceId')]"
                          },
                          "packtag": {
                            "value": "[parameters('packtag')]"
                          },
                          "Tags": {
                            "value": "[variables('Tags')]"
                          },
                          "instanceName": {
                            "value": "[parameters('instanceName')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.32.4.45862",
                              "templateHash": "17575300843145168501"
                            }
                          },
                          "parameters": {
                            "location": {
                              "type": "string"
                            },
                            "workspaceId": {
                              "type": "string"
                            },
                            "AGId": {
                              "type": "string"
                            },
                            "packtag": {
                              "type": "string"
                            },
                            "Tags": {
                              "type": "object"
                            },
                            "instanceName": {
                              "type": "string"
                            }
                          },
                          "variables": {
                            "moduleprefix": "[format('AMP-{0}-{1}', parameters('instanceName'), parameters('packtag'))]",
                            "alertlist": [
                              {
                                "alertRuleDescription": "Nginx stopped.",
                                "alertRuleDisplayName": "Nginx service stopped.",
                                "alertRuleName": "AlertRule-Nginx-1",
                                "alertRuleSeverity": 1,
                                "autoMitigate": true,
                                "evaluationFrequency": "PT15M",
                                "windowSize": "PT15M",
                                "alertType": "rows",
                                "query": "Syslog | where SyslogMessage == \"Stopped A high performance web server and a reverse proxy server.\""
                              }
                            ]
                          },
                          "resources": [
                            {
                              "type": "Microsoft.Resources/deployments",
                              "apiVersion": "2022-09-01",
                              "name": "[format('{0}-Alerts', variables('moduleprefix'))]",
                              "properties": {
                                "expressionEvaluationOptions": {
                                  "scope": "inner"
                                },
                                "mode": "Incremental",
                                "parameters": {
                                  "alertlist": {
                                    "value": "[variables('alertlist')]"
                                  },
                                  "AGId": {
                                    "value": "[parameters('AGId')]"
                                  },
                                  "location": {
                                    "value": "[parameters('location')]"
                                  },
                                  "moduleprefix": {
                                    "value": "[variables('moduleprefix')]"
                                  },
                                  "packtag": {
                                    "value": "[parameters('packtag')]"
                                  },
                                  "Tags": {
                                    "value": "[parameters('Tags')]"
                                  },
                                  "workspaceId": {
                                    "value": "[parameters('workspaceId')]"
                                  }
                                },
                                "template": {
                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                  "contentVersion": "1.0.0.0",
                                  "metadata": {
                                    "_generator": {
                                      "name": "bicep",
                                      "version": "0.32.4.45862",
                                      "templateHash": "17858688129795365440"
                                    }
                                  },
                                  "parameters": {
                                    "alertlist": {
                                      "type": "array"
                                    },
                                    "location": {
                                      "type": "string"
                                    },
                                    "workspaceId": {
                                      "type": "string"
                                    },
                                    "AGId": {
                                      "type": "string"
                                    },
                                    "packtag": {
                                      "type": "string"
                                    },
                                    "Tags": {
                                      "type": "object"
                                    },
                                    "moduleprefix": {
                                      "type": "string"
                                    }
                                  },
                                  "resources": [
                                    {
                                      "copy": {
                                        "name": "Alerts",
                                        "count": "[length(parameters('alertlist'))]"
                                      },
                                      "type": "Microsoft.Resources/deployments",
                                      "apiVersion": "2022-09-01",
                                      "name": "[format('{0}-Alert-{1}', parameters('packtag'), copyIndex())]",
                                      "properties": {
                                        "expressionEvaluationOptions": {
                                          "scope": "inner"
                                        },
                                        "mode": "Incremental",
                                        "parameters": {
                                          "location": {
                                            "value": "[parameters('location')]"
                                          },
                                          "actionGroupResourceId": {
                                            "value": "[parameters('AGId')]"
                                          },
                                          "alertRuleDescription": {
                                            "value": "[parameters('alertlist')[copyIndex()].alertRuleDescription]"
                                          },
                                          "alertRuleDisplayName": {
                                            "value": "[format('{0}-{1}', parameters('moduleprefix'), parameters('alertlist')[copyIndex()].alertRuleDisplayName)]"
                                          },
                                          "alertRuleName": {
                                            "value": "[format('{0}-{1}', parameters('moduleprefix'), parameters('alertlist')[copyIndex()].alertRuleName)]"
                                          },
                                          "alertRuleSeverity": {
                                            "value": "[parameters('alertlist')[copyIndex()].alertRuleSeverity]"
                                          },
                                          "autoMitigate": {
                                            "value": "[parameters('alertlist')[copyIndex()].autoMitigate]"
                                          },
                                          "evaluationFrequency": {
                                            "value": "[parameters('alertlist')[copyIndex()].evaluationFrequency]"
                                          },
                                          "windowSize": {
                                            "value": "[parameters('alertlist')[copyIndex()].windowSize]"
                                          },
                                          "scope": {
                                            "value": "[parameters('workspaceId')]"
                                          },
                                          "query": {
                                            "value": "[parameters('alertlist')[copyIndex()].query]"
                                          },
                                          "dimensions": "[if(contains(parameters('alertlist')[copyIndex()], 'dimensions'), createObject('value', parameters('alertlist')[copyIndex()].dimensions), createObject('value', null()))]",
                                          "packtag": {
                                            "value": "[parameters('packtag')]"
                                          },
                                          "Tags": {
                                            "value": "[parameters('Tags')]"
                                          },
                                          "alertType": {
                                            "value": "[parameters('alertlist')[copyIndex()].alertType]"
                                          },
                                          "metricMeasureColumn": "[if(equals(parameters('alertlist')[copyIndex()].alertType, 'Aggregated'), createObject('value', parameters('alertlist')[copyIndex()].metricMeasureColumn), createObject('value', null()))]",
                                          "operator": "[if(equals(parameters('alertlist')[copyIndex()].alertType, 'Aggregated'), createObject('value', parameters('alertlist')[copyIndex()].operator), createObject('value', null()))]",
                                          "threshold": "[if(equals(parameters('alertlist')[copyIndex()].alertType, 'Aggregated'), createObject('value', parameters('alertlist')[copyIndex()].threshold), createObject('value', null()))]"
                                        },
                                        "template": {
                                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                          "contentVersion": "1.0.0.0",
                                          "metadata": {
                                            "_generator": {
                                              "name": "bicep",
                                              "version": "0.32.4.45862",
                                              "templateHash": "10159755056440989647"
                                            }
                                          },
                                          "parameters": {
                                            "alertType": {
                                              "type": "string",
                                              "allowedValues": [
                                                "rows",
                                                "Aggregated"
                                              ]
                                            },
                                            "alertRuleName": {
                                              "type": "string"
                                            },
                                            "alertRuleDisplayName": {
                                              "type": "string"
                                            },
                                            "alertRuleDescription": {
                                              "type": "string"
                                            },
                                            "scope": {
                                              "type": "string"
                                            },
                                            "actionGroupResourceId": {
                                              "type": "string"
                                            },
                                            "alertRuleSeverity": {
                                              "type": "int"
                                            },
                                            "location": {
                                              "type": "string"
                                            },
                                            "windowSize": {
                                              "type": "string",
                                              "defaultValue": "PT15M"
                                            },
                                            "evaluationFrequency": {
                                              "type": "string",
                                              "defaultValue": "PT15M"
                                            },
                                            "autoMitigate": {
                                              "type": "bool",
                                              "defaultValue": false
                                            },
                                            "query": {
                                              "type": "string"
                                            },
                                            "packtag": {
                                              "type": "string"
                                            },
                                            "Tags": {
                                              "type": "object"
                                            },
                                            "threshold": {
                                              "type": "int",
                                              "defaultValue": 0
                                            },
                                            "metricMeasureColumn": {
                                              "type": "string",
                                              "defaultValue": ""
                                            },
                                            "dimensions": {
                                              "type": "array",
                                              "defaultValue": [
                                                {
                                                  "name": "Computer",
                                                  "operator": "Include",
                                                  "values": [
                                                    "*"
                                                  ]
                                                }
                                              ]
                                            },
                                            "operator": {
                                              "type": "string",
                                              "defaultValue": "GreaterThan",
                                              "allowedValues": [
                                                "GreaterThan",
                                                "GreaterThanOrEqual",
                                                "LessThan",
                                                "LessThanOrEqual",
                                                "Equal",
                                                "NotEqual"
                                              ]
                                            }
                                          },
                                          "resources": [
                                            {
                                              "condition": "[equals(parameters('alertType'), 'rows')]",
                                              "type": "Microsoft.Resources/deployments",
                                              "apiVersion": "2022-09-01",
                                              "name": "[parameters('alertRuleName')]",
                                              "properties": {
                                                "expressionEvaluationOptions": {
                                                  "scope": "inner"
                                                },
                                                "mode": "Incremental",
                                                "parameters": {
                                                  "alertRuleName": {
                                                    "value": "[parameters('alertRuleName')]"
                                                  },
                                                  "alertRuleDisplayName": {
                                                    "value": "[parameters('alertRuleDisplayName')]"
                                                  },
                                                  "alertRuleDescription": {
                                                    "value": "[parameters('alertRuleDescription')]"
                                                  },
                                                  "scope": {
                                                    "value": "[parameters('scope')]"
                                                  },
                                                  "dimensions": {
                                                    "value": "[parameters('dimensions')]"
                                                  },
                                                  "actionGroupResourceId": {
                                                    "value": "[parameters('actionGroupResourceId')]"
                                                  },
                                                  "alertRuleSeverity": {
                                                    "value": "[parameters('alertRuleSeverity')]"
                                                  },
                                                  "location": {
                                                    "value": "[parameters('location')]"
                                                  },
                                                  "windowSize": {
                                                    "value": "[parameters('windowSize')]"
                                                  },
                                                  "evaluationFrequency": {
                                                    "value": "[parameters('evaluationFrequency')]"
                                                  },
                                                  "autoMitigate": {
                                                    "value": "[parameters('autoMitigate')]"
                                                  },
                                                  "query": {
                                                    "value": "[parameters('query')]"
                                                  },
                                                  "Tags": {
                                                    "value": "[parameters('Tags')]"
                                                  }
                                                },
                                                "template": {
                                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                                  "contentVersion": "1.0.0.0",
                                                  "metadata": {
                                                    "_generator": {
                                                      "name": "bicep",
                                                      "version": "0.32.4.45862",
                                                      "templateHash": "16566470716356207302"
                                                    }
                                                  },
                                                  "parameters": {
                                                    "alertRuleName": {
                                                      "type": "string"
                                                    },
                                                    "alertRuleDisplayName": {
                                                      "type": "string"
                                                    },
                                                    "alertRuleDescription": {
                                                      "type": "string"
                                                    },
                                                    "scope": {
                                                      "type": "string"
                                                    },
                                                    "actionGroupResourceId": {
                                                      "type": "string"
                                                    },
                                                    "alertRuleSeverity": {
                                                      "type": "int"
                                                    },
                                                    "location": {
                                                      "type": "string"
                                                    },
                                                    "windowSize": {
                                                      "type": "string",
                                                      "defaultValue": "PT15M"
                                                    },
                                                    "evaluationFrequency": {
                                                      "type": "string",
                                                      "defaultValue": "PT15M"
                                                    },
                                                    "autoMitigate": {
                                                      "type": "bool",
                                                      "defaultValue": false
                                                    },
                                                    "query": {
                                                      "type": "string"
                                                    },
                                                    "dimensions": {
                                                      "type": "array"
                                                    },
                                                    "Tags": {
                                                      "type": "object"
                                                    }
                                                  },
                                                  "resources": [
                                                    {
                                                      "type": "Microsoft.Insights/scheduledQueryRules",
                                                      "apiVersion": "2023-03-15-preview",
                                                      "name": "[parameters('alertRuleName')]",
                                                      "location": "[parameters('location')]",
                                                      "tags": "[parameters('Tags')]",
                                                      "properties": {
                                                        "description": "[parameters('alertRuleDescription')]",
                                                        "ruleResolveConfiguration": {},
                                                        "displayName": "[parameters('alertRuleDisplayName')]",
                                                        "enabled": true,
                                                        "scopes": [
                                                          "[parameters('scope')]"
                                                        ],
                                                        "targetResourceTypes": [
                                                          "Microsoft.OperationalInsights/workspaces"
                                                        ],
                                                        "windowSize": "[parameters('windowSize')]",
                                                        "evaluationFrequency": "[parameters('evaluationFrequency')]",
                                                        "severity": "[parameters('alertRuleSeverity')]",
                                                        "criteria": {
                                                          "allOf": [
                                                            {
                                                              "query": "[parameters('query')]",
                                                              "timeAggregation": "Count",
                                                              "dimensions": "[parameters('dimensions')]",
                                                              "resourceIdColumn": "[if(empty(parameters('dimensions')), '_ResourceId', null())]",
                                                              "operator": "GreaterThan",
                                                              "threshold": 0,
                                                              "failingPeriods": {
                                                                "numberOfEvaluationPeriods": 1,
                                                                "minFailingPeriodsToAlert": 1
                                                              }
                                                            }
                                                          ]
                                                        },
                                                        "autoMitigate": "[parameters('autoMitigate')]",
                                                        "actions": {
                                                          "actionGroups": [
                                                            "[parameters('actionGroupResourceId')]"
                                                          ],
                                                          "customProperties": {}
                                                        }
                                                      }
                                                    }
                                                  ]
                                                }
                                              }
                                            },
                                            {
                                              "condition": "[equals(parameters('alertType'), 'Aggregated')]",
                                              "type": "Microsoft.Resources/deployments",
                                              "apiVersion": "2022-09-01",
                                              "name": "[parameters('alertRuleName')]",
                                              "properties": {
                                                "expressionEvaluationOptions": {
                                                  "scope": "inner"
                                                },
                                                "mode": "Incremental",
                                                "parameters": {
                                                  "alertRuleName": {
                                                    "value": "[parameters('alertRuleName')]"
                                                  },
                                                  "alertRuleDisplayName": {
                                                    "value": "[parameters('alertRuleDisplayName')]"
                                                  },
                                                  "alertRuleDescription": {
                                                    "value": "[parameters('alertRuleDescription')]"
                                                  },
                                                  "scope": {
                                                    "value": "[parameters('scope')]"
                                                  },
                                                  "dimensions": {
                                                    "value": "[parameters('dimensions')]"
                                                  },
                                                  "actionGroupResourceId": {
                                                    "value": "[parameters('actionGroupResourceId')]"
                                                  },
                                                  "alertRuleSeverity": {
                                                    "value": "[parameters('alertRuleSeverity')]"
                                                  },
                                                  "location": {
                                                    "value": "[parameters('location')]"
                                                  },
                                                  "windowSize": {
                                                    "value": "[parameters('windowSize')]"
                                                  },
                                                  "evaluationFrequency": {
                                                    "value": "[parameters('evaluationFrequency')]"
                                                  },
                                                  "autoMitigate": {
                                                    "value": "[parameters('autoMitigate')]"
                                                  },
                                                  "query": {
                                                    "value": "[parameters('query')]"
                                                  },
                                                  "Tags": {
                                                    "value": "[parameters('Tags')]"
                                                  },
                                                  "threshold": {
                                                    "value": "[parameters('threshold')]"
                                                  },
                                                  "metricMeasureColumn": {
                                                    "value": "[parameters('metricMeasureColumn')]"
                                                  },
                                                  "operator": {
                                                    "value": "[parameters('operator')]"
                                                  }
                                                },
                                                "template": {
                                                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                                  "contentVersion": "1.0.0.0",
                                                  "metadata": {
                                                    "_generator": {
                                                      "name": "bicep",
                                                      "version": "0.32.4.45862",
                                                      "templateHash": "18444959286864838274"
                                                    }
                                                  },
                                                  "parameters": {
                                                    "alertRuleName": {
                                                      "type": "string"
                                                    },
                                                    "alertRuleDisplayName": {
                                                      "type": "string"
                                                    },
                                                    "alertRuleDescription": {
                                                      "type": "string"
                                                    },
                                                    "scope": {
                                                      "type": "string"
                                                    },
                                                    "actionGroupResourceId": {
                                                      "type": "string"
                                                    },
                                                    "alertRuleSeverity": {
                                                      "type": "int"
                                                    },
                                                    "location": {
                                                      "type": "string"
                                                    },
                                                    "windowSize": {
                                                      "type": "string",
                                                      "defaultValue": "PT15M"
                                                    },
                                                    "evaluationFrequency": {
                                                      "type": "string",
                                                      "defaultValue": "PT15M"
                                                    },
                                                    "autoMitigate": {
                                                      "type": "bool",
                                                      "defaultValue": false
                                                    },
                                                    "query": {
                                                      "type": "string"
                                                    },
                                                    "dimensions": {
                                                      "type": "array"
                                                    },
                                                    "threshold": {
                                                      "type": "int"
                                                    },
                                                    "metricMeasureColumn": {
                                                      "type": "string"
                                                    },
                                                    "Tags": {
                                                      "type": "object"
                                                    },
                                                    "operator": {
                                                      "type": "string",
                                                      "allowedValues": [
                                                        "GreaterThan",
                                                        "GreaterThanOrEqual",
                                                        "LessThan",
                                                        "LessThanOrEqual",
                                                        "Equal",
                                                        "NotEqual"
                                                      ]
                                                    }
                                                  },
                                                  "resources": [
                                                    {
                                                      "type": "Microsoft.Insights/scheduledQueryRules",
                                                      "apiVersion": "2023-03-15-preview",
                                                      "name": "[parameters('alertRuleName')]",
                                                      "location": "[parameters('location')]",
                                                      "tags": "[parameters('Tags')]",
                                                      "properties": {
                                                        "description": "[parameters('alertRuleDescription')]",
                                                        "ruleResolveConfiguration": {},
                                                        "displayName": "[parameters('alertRuleDisplayName')]",
                                                        "enabled": true,
                                                        "scopes": [
                                                          "[parameters('scope')]"
                                                        ],
                                                        "targetResourceTypes": [
                                                          "Microsoft.OperationalInsights/workspaces"
                                                        ],
                                                        "windowSize": "[parameters('windowSize')]",
                                                        "evaluationFrequency": "[parameters('evaluationFrequency')]",
                                                        "severity": "[parameters('alertRuleSeverity')]",
                                                        "criteria": {
                                                          "allOf": [
                                                            {
                                                              "query": "[parameters('query')]",
                                                              "timeAggregation": "Average",
                                                              "metricMeasureColumn": "[parameters('metricMeasureColumn')]",
                                                              "dimensions": "[parameters('dimensions')]",
                                                              "resourceIdColumn": "[if(empty(parameters('dimensions')), '_ResourceId', null())]",
                                                              "operator": "[parameters('operator')]",
                                                              "threshold": "[parameters('threshold')]",
                                                              "failingPeriods": {
                                                                "numberOfEvaluationPeriods": 1,
                                                                "minFailingPeriodsToAlert": 1
                                                              }
                                                            }
                                                          ]
                                                        },
                                                        "autoMitigate": "[parameters('autoMitigate')]",
                                                        "actions": {
                                                          "actionGroups": [
                                                            "[parameters('actionGroupResourceId')]"
                                                          ],
                                                          "customProperties": {}
                                                        }
                                                      }
                                                    }
                                                  ]
                                                }
                                              }
                                            }
                                          ]
                                        }
                                      }
                                    }
                                  ]
                                }
                              }
                            }
                          ]
                        }
                      }
                    }
                  ]
                }
              }
            },
            {
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2022-09-01",
              "name": "VMInsightsDependencyPack",
              "location": "[deployment().location]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "dceId": {
                    "value": "[parameters('dceId')]"
                  },
                  "location": {
                    "value": "[parameters('location')]"
                  },
                  "resourceGroupId": {
                    "value": "[parameters('resourceGroupId')]"
                  },
                  "solutionTag": {
                    "value": "[parameters('solutionTag')]"
                  },
                  "solutionVersion": {
                    "value": "[parameters('solutionVersion')]"
                  },
                  "subscriptionId": {
                    "value": "[parameters('subscriptionId')]"
                  },
                  "workspaceId": {
                    "value": "[parameters('workspaceId')]"
                  },
                  "customerTags": {
                    "value": "[parameters('customerTags')]"
                  },
                  "instanceName": {
                    "value": "[parameters('instanceName')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2018-05-01/subscriptionDeploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.32.4.45862",
                      "templateHash": "8958640379218679332"
                    }
                  },
                  "parameters": {
                    "packtag": {
                      "type": "string",
                      "defaultValue": "InsightsDep",
                      "metadata": {
                        "description": "The Tag value for this pack"
                      }
                    },
                    "location": {
                      "type": "string",
                      "metadata": {
                        "description": "location for the deployment."
                      }
                    },
                    "workspaceId": {
                      "type": "string",
                      "metadata": {
                        "description": "Full resource ID of the log analytics workspace to be used for the deployment."
                      }
                    },
                    "solutionTag": {
                      "type": "string"
                    },
                    "solutionVersion": {
                      "type": "string"
                    },
                    "dceId": {
                      "type": "string"
                    },
                    "subscriptionId": {
                      "type": "string"
                    },
                    "resourceGroupId": {
                      "type": "string"
                    },
                    "customerTags": {
                      "type": "object"
                    },
                    "instanceName": {
                      "type": "string"
                    }
                  },
                  "variables": {
                    "rulename": "[format('AMP-{0}-{1}', parameters('instanceName'), parameters('packtag'))]",
                    "ruleshortname": "[format('AMP-{0}-{1}', parameters('instanceName'), parameters('packtag'))]",
                    "tempTags": {
                      "[format('{0}', parameters('solutionTag'))]": "[parameters('packtag')]",
                      "MonitoringPackType": "IaaS",
                      "solutionVersion": "[parameters('solutionVersion')]"
                    },
                    "Tags": "[if(equals(parameters('customerTags'), createObject()), variables('tempTags'), union(variables('tempTags'), parameters('customerTags').All))]",
                    "resourceGroupName": "[split(parameters('resourceGroupId'), '/')[4]]"
                  },
                  "resources": [
                    {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2022-09-01",
                      "name": "[format('vmInsightsDCR-{0}', parameters('packtag'))]",
                      "subscriptionId": "[parameters('subscriptionId')]",
                      "resourceGroup": "[variables('resourceGroupName')]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "location": {
                            "value": "[parameters('location')]"
                          },
                          "workspaceResourceId": {
                            "value": "[parameters('workspaceId')]"
                          },
                          "Tags": {
                            "value": "[variables('Tags')]"
                          },
                          "ruleName": {
                            "value": "[variables('rulename')]"
                          },
                          "dceId": {
                            "value": "[parameters('dceId')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.32.4.45862",
                              "templateHash": "13954368441826719999"
                            }
                          },
                          "parameters": {
                            "location": {
                              "type": "string"
                            },
                            "workspaceResourceId": {
                              "type": "string"
                            },
                            "Tags": {
                              "type": "object"
                            },
                            "ruleName": {
                              "type": "string"
                            },
                            "dceId": {
                              "type": "string"
                            }
                          },
                          "variables": {
                            "wsfriendlyname": "[split(parameters('workspaceResourceId'), '/')[8]]"
                          },
                          "resources": [
                            {
                              "type": "Microsoft.Insights/dataCollectionRules",
                              "apiVersion": "2021-09-01-preview",
                              "name": "[format('{0}-VMI', parameters('ruleName'))]",
                              "location": "[parameters('location')]",
                              "tags": "[parameters('Tags')]",
                              "properties": {
                                "description": "Data collection rule for VM Insights.",
                                "dataCollectionEndpointId": "[parameters('dceId')]",
                                "dataSources": {
                                  "performanceCounters": [
                                    {
                                      "name": "VMInsightsPerfCounters",
                                      "streams": [
                                        "Microsoft-InsightsMetrics"
                                      ],
                                      "samplingFrequencyInSeconds": 60,
                                      "counterSpecifiers": [
                                        "\\VmInsights\\DetailedMetrics"
                                      ]
                                    }
                                  ]
                                },
                                "destinations": {
                                  "logAnalytics": [
                                    {
                                      "workspaceResourceId": "[parameters('workspaceResourceId')]",
                                      "name": "[variables('wsfriendlyname')]"
                                    }
                                  ]
                                },
                                "dataFlows": [
                                  {
                                    "streams": [
                                      "Microsoft-InsightsMetrics"
                                    ],
                                    "destinations": [
                                      "[variables('wsfriendlyname')]"
                                    ]
                                  }
                                ]
                              }
                            }
                          ],
                          "outputs": {
                            "VMIRuleId": {
                              "type": "string",
                              "value": "[resourceId('Microsoft.Insights/dataCollectionRules', format('{0}-VMI', parameters('ruleName')))]"
                            }
                          }
                        }
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      },
      "dependsOn": [
        "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', parameters('subscriptionId'), variables('resourceGroupName')), 'Microsoft.Resources/deployments', format('deployAG-new-{0}-{1}', parameters('actionGroupName'), parameters('location')))]"
      ]
    },
    {
      "condition": "[parameters('deployGrafana')]",
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2022-09-01",
      "name": "grafana",
      "subscriptionId": "[parameters('subscriptionId')]",
      "resourceGroup": "[variables('resourceGroupName')]",
      "properties": {
        "expressionEvaluationOptions": {
          "scope": "inner"
        },
        "mode": "Incremental",
        "parameters": {
          "fileName": {
            "value": "grafana.zip"
          },
          "grafanaResourceId": {
            "value": "[parameters('grafanaResourceId')]"
          },
          "location": {
            "value": "[parameters('location')]"
          },
          "resourceGroupName": {
            "value": "[variables('resourceGroupName')]"
          },
          "customerTags": {
            "value": "[parameters('customerTags')]"
          },
          "packsManagedIdentityResourceId": {
            "value": "[parameters('userManagedIdentityResourceId')]"
          },
          "solutionTag": {
            "value": "[parameters('solutionTag')]"
          },
          "solutionVersion": {
            "value": "[parameters('solutionVersion')]"
          },
          "instanceName": {
            "value": "[parameters('instanceName')]"
          },
          "subscriptionId": {
            "value": "[parameters('subscriptionId')]"
          }
        },
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0.0.0",
          "metadata": {
            "_generator": {
              "name": "bicep",
              "version": "0.32.4.45862",
              "templateHash": "8858171580267209258"
            }
          },
          "parameters": {
            "location": {
              "type": "string"
            },
            "resourceGroupName": {
              "type": "string"
            },
            "grafanaResourceId": {
              "type": "string"
            },
            "fileName": {
              "type": "string"
            },
            "packsManagedIdentityResourceId": {
              "type": "string"
            },
            "customerTags": {
              "type": "object"
            },
            "solutionTag": {
              "type": "string"
            },
            "solutionVersion": {
              "type": "string"
            },
            "instanceName": {
              "type": "string"
            },
            "subscriptionId": {
              "type": "string"
            }
          },
          "variables": {
            "$fxv#0": "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",
            "grafanaName": "[split(parameters('grafanaResourceId'), '/')[8]]",
            "tempfilename": "[format('{0}.tmp', parameters('fileName'))]",
            "Tags": "[if(equals(parameters('customerTags'), createObject()), createObject(format('{0}', parameters('solutionTag')), parameters('solutionTag'), 'solutionVersion', parameters('solutionVersion')), union(createObject(format('{0}', parameters('solutionTag')), parameters('solutionTag'), 'solutionVersion', parameters('solutionVersion'), 'instanceName', parameters('instanceName')), parameters('customerTags').All))]"
          },
          "resources": [
            {
              "type": "Microsoft.Resources/deploymentScripts",
              "apiVersion": "2020-10-01",
              "name": "deployscript-Grafana",
              "tags": "[variables('Tags')]",
              "location": "[parameters('location')]",
              "identity": {
                "type": "userAssigned",
                "userAssignedIdentities": {
                  "[format('{0}', parameters('packsManagedIdentityResourceId'))]": {}
                }
              },
              "kind": "AzureCLI",
              "properties": {
                "azCliVersion": "2.42.0",
                "timeout": "PT5M",
                "retentionInterval": "PT1H",
                "environmentVariables": [
                  {
                    "name": "CONTENT",
                    "value": "[variables('$fxv#0')]"
                  }
                ],
                "scriptContent": "[format('echo \"$CONTENT\" > {0} && cat {1} | base64 -d > {2} && az extension add --name amg && az login --identity && unzip {3} && for file in *.json; do az grafana dashboard import -g {4} -n {5} --subscription {6} --definition \"$file\" --overwrite true;done', variables('tempfilename'), variables('tempfilename'), parameters('fileName'), parameters('fileName'), parameters('resourceGroupName'), variables('grafanaName'), parameters('subscriptionId'))]"
              }
            }
          ]
        }
      }
    }
  ]
}